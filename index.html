<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÆ∞‰∫ãÊú¨</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --bg-tertiary: #e8e8e8;
            --text-primary: #000000;
            --text-secondary: #666666;
            --border-color: #d0d0d0;
            --accent-color: #0078d4;
            --hover-bg: #e5f3ff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --toolbar-height: 50px;
            --settings-height: 45px;
            --settings-panel-height: 280px;
        }

        [data-theme="dark"] {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3e3e3e;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #555555;
            --accent-color: #4080d0;
            --hover-bg: #2d4a7c;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            height: 100dvh;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.4;
            -webkit-tap-highlight-color: transparent;
        }

        /* È°∂ÈÉ®Â∑•ÂÖ∑Ê†è */
        .toolbar {
            height: var(--toolbar-height);
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
            flex-shrink: 0;
            box-shadow: 0 1px 3px var(--shadow-color);
            z-index: 100;
        }

        .toolbar-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
            margin-right: auto;
        }

        .toolbar-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            transition: background-color 0.2s;
            min-width: 38px;
            height: 38px;
            position: relative;
        }

        .toolbar-btn:hover {
            background-color: var(--hover-bg);
        }

        .toolbar-btn:active {
            transform: scale(0.95);
        }

        .toolbar-btn svg {
            width: 18px;
            height: 18px;
        }

        .toolbar-btn span {
            display: none;
            margin-left: 5px;
        }

        /* ÂàÜÈöîÁ∫ø */
        .toolbar-separator {
            width: 1px;
            height: 24px;
            background-color: var(--border-color);
            margin: 0 5px;
        }

        /* ‰∏ªÁºñËæëÂå∫Âüü */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            margin-right: 0;
            transition: margin-right 0.3s ease;
            padding-bottom: 0; /* Áî±JavaScriptÂä®ÊÄÅËÆæÁΩÆ */
            margin-bottom: 174px; /* ‰∏∫Âõ∫ÂÆöÂÆö‰ΩçÁöÑÁä∂ÊÄÅÊ†èÈ¢ÑÁïôÁ©∫Èó¥ */
        }

        body:not(.fullscreen) .editor-container {
            margin-right: 0;
        }

        body:not(.fullscreen).markdown-visible .editor-container {
            margin-right: 40px;
        }

        body.fullscreen .editor-container {
            padding-bottom: 0;
            margin-bottom: 0; /* ÂÖ®Â±èÊ®°Âºè‰∏ã‰∏çÈúÄË¶ÅÈ¢ÑÁïôÁ©∫Èó¥ */
        }

        .status-bar {
            height: var(--settings-height);
            min-height: 45px;
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
            cursor: pointer;
            transition: background-color 0.2s;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }

        body.fullscreen .status-bar {
            position: fixed; /* ÊÅ¢Â§çÂõ∫ÂÆöÂÆö‰Ωç */
        }

        .status-bar:hover {
            background-color: var(--bg-tertiary);
        }

        .status-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-icon {
            width: 16px;
            height: 16px;
            transition: transform 0.3s;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .help-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 4px;
            margin-left: 8px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .help-btn svg {
            width: 16px;
            height: 16px;
        }

        .help-btn:hover {
            color: var(--accent-color);
            background-color: var(--hover-bg);
        }

        .help-btn:active {
            transform: scale(0.95);
        }

        /* ÁºñËæëÂô® - GridÂ∏ÉÂ±Ä */
        .editor {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 15px;
            resize: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            /* GridÂ∏ÉÂ±ÄÂ≠êÈ°π */
            grid-area: editor;
            /* Á°Æ‰øùÊªöÂä®Ë°å‰∏∫‰∏ÄËá¥ */
            scrollbar-width: auto;
            border-radius: 0 8px 8px 0;
            /* ÂûÇÁõ¥ÂØπÈΩê‰ºòÂåñ */
            vertical-align: top;
            /* Èò≤Ê≠¢Â≠ó‰ΩìÊ∏≤ÊüìÂ∑ÆÂºÇ */
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ÁºñËæëÂô®ÂåÖË£ÖÂô® - ÁÆÄÂåñÂ∏ÉÂ±Ä */
        .editor-wrapper {
            display: block;
            width: 100%;
            height: 100%;
        }

    
        /* ÁΩëÊ†ºËÉåÊôØÊ†∑Âºè */
        .editor-wrapper.show-grid .editor {
            background-image:
                linear-gradient(to right, rgba(128, 128, 128, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(128, 128, 128, 0.1) 1px, transparent 1px);
            background-size: 21px 21px;
            background-position: 0 15px;
            background-origin: padding-box; /* Á°Æ‰øùËÉåÊôØ‰ªépaddingÂå∫ÂüüÂºÄÂßã */
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢ò‰∏ãÁöÑÁΩëÊ†ºÊ†∑Âºè */
        [data-theme="dark"] .editor-wrapper.show-grid .editor {
            background-image:
                linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 21px 21px;
            background-position: 0 15px;
            background-origin: padding-box;
        }

        /* ÁΩëÊ†ºÂºÄÂÖ≥ÊéßÂà∂ */
        .editor-wrapper:not(.show-grid) .editor {
            background-image: none;
        }

        /* Âº∫Âà∂ÁΩëÊ†ºÊ†∑Âºè - ÊèêÈ´ò‰ºòÂÖàÁ∫ß */
        .editor-wrapper.show-grid .editor {
            background-image:
                linear-gradient(to right, rgba(128, 128, 128, 0.2) 1px, transparent 1px) !important,
                linear-gradient(to bottom, rgba(128, 128, 128, 0.2) 1px, transparent 1px) !important;
            background-size: 21px 21px !important;
            background-position: 0 15px !important;
            background-repeat: repeat !important;
        }

        /* ËÆæÁΩÆÈù¢Êùø */
        .settings-panel {
            position: absolute;
            bottom: var(--settings-height);
            top: auto;
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px var(--shadow-color);
            transition: transform 0.3s ease;
            z-index: 90;
            width: 100%;
            max-height: var(--settings-panel-height);
            overflow-y: auto;
        }

        .settings-panel.top {
            top: 0;
            border-top: none;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .settings-panel.bottom {
            /* ÁªßÊâøÈªòËÆ§Ê†∑Âºè */
        }

        body.fullscreen .settings-panel.bottom {
            bottom: 0;
        }

        .settings-panel.collapsed {
            transform: translateY(100%);
        }

        .settings-panel.top.collapsed {
            transform: translateY(-100%);
        }

        .settings-content {
            padding: 15px;
        }

        .settings-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .settings-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .settings-row:last-child {
            margin-bottom: 0;
        }

        .settings-input {
            flex: 1;
            min-width: 120px;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .settings-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        .settings-btn {
            padding: 6px 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
        }

        .settings-btn:hover {
            background-color: var(--hover-bg);
        }

        .settings-btn:active {
            transform: scale(0.95);
        }

        
        /* Êñá‰ª∂ÈÄâÊã©Âô® */
        .file-input {
            display: none;
        }

        /* ÈöêËóèÂ∑•ÂÖ∑Á±ª */
        .hidden {
            display: none !important;
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.2s;
        }

        #messageModal {
            z-index: 4000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: var(--bg-primary);
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.2s;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: var(--bg-tertiary);
        }

        .modal-body {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 14px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .modal-btn.primary {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .modal-btn.secondary {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-1px);
        }

        /* Êâ©Â±ïÂêçÊåâÈíÆÊ†∑Âºè */
        .extension-btn {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 35px;
        }

        .extension-btn:hover {
            background-color: var(--hover-bg);
            border-color: var(--accent-color);
            transform: translateY(-1px);
        }

        .extension-btn:active,
        .extension-btn.active {
            transform: translateY(0);
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* Êó†Êâ©Â±ïÂêçÊåâÈíÆÁâπÊÆäÊ†∑Âºè */
        .extension-btn[data-ext=""].active {
            background-color: #28a745;
            border-color: #28a745;
        }

        .extension-btn[data-ext=""].active::after {
            content: ' ‚úì';
            font-weight: bold;
        }

        /* Â∏ÆÂä©Ê®°ÊÄÅÊ°ÜÁâπÊÆäÊ†∑Âºè */
        .help-modal-content {
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
        }

        .help-modal-body {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.6;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .help-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .help-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .help-section h3 {
            color: var(--accent-color);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section h4 {
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 600;
            margin: 15px 0 8px 0;
        }

        .help-section p {
            margin-bottom: 12px;
        }

        .help-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .help-section li {
            margin-bottom: 6px;
        }

        .feature-list {
            list-style: none;
            padding-left: 0;
        }

        .feature-list li {
            padding: 4px 0;
            position: relative;
            padding-left: 20px;
        }

        .feature-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--accent-color);
            font-weight: bold;
        }

        .guide-subsection {
            margin: 15px 0;
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 4px;
            border-left: 3px solid var(--accent-color);
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background-color: var(--bg-secondary);
            border-radius: 4px;
            font-size: 13px;
        }

        .shortcut-item kbd {
            background-color: var(--accent-color);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid var(--accent-color);
            white-space: nowrap;
        }

        .shortcut-item span {
            color: var(--text-primary);
            flex: 1;
        }

        /* Â∏ÆÂä©Ê®°ÊÄÅÊ°ÜÊªöÂä®Êù°Ê†∑Âºè */
        .help-modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .help-modal-body::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .help-modal-body::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .help-modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* EmojiÈÄâÊã©Âô®Ê†∑Âºè */
        .emoji-modal-content {
            max-width: 600px;
            width: 95%;
            max-height: 85vh;
        }

        .emoji-search-container {
            margin-bottom: 15px;
        }

        .emoji-search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .emoji-search-input:focus {
            border-color: var(--accent-color);
        }

        .emoji-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .emoji-category {
            padding: 6px 10px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .emoji-category:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .emoji-category.active {
            background-color: var(--accent-color);
            color: white;
        }

        .emoji-grid-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-secondary);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 2px;
            padding: 8px;
        }

        .emoji-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            border: 1px solid transparent;
        }

        .emoji-item:hover {
            background-color: var(--hover-bg);
            border-color: var(--accent-color);
            transform: scale(1.1);
        }

        .emoji-item:active {
            transform: scale(0.95);
        }

        .emoji-recent-section {
            margin-top: 15px;
        }

        .emoji-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }

        .emoji-recent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 2px;
            min-height: 50px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-secondary);
        }

        .emoji-recent-grid:empty::before {
            content: "ÊöÇÊó†ÊúÄËøë‰ΩøÁî®ÁöÑË°®ÊÉÖÁ¨¶Âè∑";
            color: var(--text-secondary);
            font-size: 12px;
            grid-column: 1 / -1;
            text-align: center;
            align-self: center;
            opacity: 0.6;
        }

        /* EmojiÈÄâÊã©Âô®ÊªöÂä®Êù°Ê†∑Âºè */
        .emoji-grid-container::-webkit-scrollbar {
            width: 6px;
        }

        .emoji-grid-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .emoji-grid-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .emoji-grid-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* ÁßªÂä®Á´ØemojiÈÄâÊã©Âô®ÈÄÇÈÖç */
        @media (max-width: 768px) {
            .emoji-modal-content {
                width: 98%;
                max-height: 90vh;
            }

            .emoji-categories {
                justify-content: space-between;
                gap: 2px;
            }

            .emoji-category {
                padding: 4px 6px;
                font-size: 10px;
            }

            .emoji-grid {
                grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
            }

            .emoji-item {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }

            .emoji-recent-grid {
                grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
            }
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .toolbar {
                padding: 0 10px;
                gap: 5px;
            }

            .settings-panel {
                max-height: 50vh; /* ÁßªÂä®Á´ØÈôêÂà∂È´òÂ∫¶ */
            }

            .toolbar-title {
                font-size: 15px;
            }

            .toolbar-btn {
                padding: 6px 8px;
                min-width: 34px;
                height: 34px;
            }

            .toolbar-btn span {
                display: none;
            }

            .toolbar-separator {
                display: none;
            }

            .status-bar {
                padding: 0 10px;
                min-height: 45px;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 10;
            }

            .status-left {
                font-size: 11px;
                gap: 10px;
            }

            .editor {
                font-size: 13px;
                padding: 10px;
                padding-bottom: 55px;
            }

            .settings-content {
                padding: 12px;
            }

            .settings-row {
                flex-direction: column;
                align-items: stretch;
            }

            .settings-input {
                min-width: auto;
            }

            /* ÁßªÂä®Á´Ø Markdown Â∑•ÂÖ∑Ê†è‰ºòÂåñ */
            .markdown-toolbar {
                width: 45px;
                padding: 6px 1px;
                gap: 1px;
            }

            .markdown-btn {
                width: 43px;
                height: 32px;
                padding: 4px 1px;
                font-size: 8px;
            }

            .markdown-row {
                gap: 1px;
                margin-bottom: 1px;
            }

            .markdown-row:not(:last-child) {
                padding-bottom: 1px;
            }
        }

        @media (max-width: 480px) {
            .toolbar {
                height: 45px;
            }

            .toolbar-btn {
                min-width: 32px;
                height: 32px;
            }

            .toolbar-btn svg {
                width: 16px;
                height: 16px;
            }

            .status-bar {
                min-height: 45px;
                padding: 0 8px;
                font-size: 11px;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
            }

            .status-left {
                font-size: 10px;
                gap: 8px;
            }

            .settings-panel {
                max-height: 260px;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
            }

            /* Â∞èÂ±èÂπï Markdown Â∑•ÂÖ∑Ê†èËøõ‰∏ÄÊ≠•‰ºòÂåñ */
            .markdown-toolbar {
                width: 42px;
                padding: 4px 1px;
                gap: 1px;
            }

            .markdown-btn {
                width: 40px;
                height: 28px;
                padding: 3px 1px;
                font-size: 7px;
            }

            .markdown-row {
                gap: 1px;
                margin-bottom: 1px;
            }

            .markdown-row:not(:last-child) {
                padding-bottom: 1px;
            }

            /* ‰ºòÂåñÂ∞èÂ±èÂπïÊªöÂä®Êù° */
            .markdown-toolbar::-webkit-scrollbar {
                width: 3px;
            }

            .markdown-toolbar::-webkit-scrollbar-thumb {
                background: var(--border-color);
                border-radius: 2px;
            }
        }

        /* Ëß¶Êë∏‰ºòÂåñ */
        @media (hover: none) {
            .toolbar-btn:active {
                background-color: var(--hover-bg);
            }

            .editor {
                -webkit-user-select: text;
                user-select: text;
                -webkit-touch-callout: default;
            }

            /* ‰ºòÂåñÁßªÂä®Á´ØÈïøÊåâÈÄâÊã© */
            .settings-btn {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }

            .toolbar-btn {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
        }

        /* ÊªöÂä®Êù°Ê†∑Âºè */
        .editor::-webkit-scrollbar,
        .settings-panel::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .editor::-webkit-scrollbar-track,
        .settings-panel::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .editor::-webkit-scrollbar-thumb,
        .settings-panel::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .editor::-webkit-scrollbar-thumb:hover,
        .settings-panel::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Markdown Â∑•ÂÖ∑Ê†èÊ†∑Âºè */
        .markdown-toolbar {
            position: fixed;
            right: 0;
            top: var(--toolbar-height);
            bottom: var(--settings-height);
            background: var(--bg-tertiary);
            border-left: 1px solid var(--border-color);
            border-radius: 0;
            box-shadow: -2px 0 10px var(--shadow-color);
            overflow-y: auto;
            overflow-x: hidden;
            transition: transform 0.3s ease;
            z-index: 80;
            width: 50px;
            display: flex;
            flex-direction: column;
            padding: 8px 2px;
            gap: 2px;
            /* ‰ºòÂåñÊªöÂä®ÊÄßËÉΩ */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .markdown-toolbar.collapsed {
            transform: translateX(100%);
        }

        .markdown-toolbar:not(.collapsed) {
            transform: translateX(0);
        }

        .markdown-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 0;
            min-height: 100%;
        }

        .markdown-row {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-bottom: 2px;
        }

        .markdown-row:not(:last-child) {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 2px;
        }

        .markdown-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 6px 2px;
            cursor: pointer;
            font-size: 9px;
            color: var(--text-primary);
            transition: all 0.2s ease;
            width: 46px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* Èò≤Ê≠¢ÊåâÈíÆÂéãÁº© */
            /* ‰ºòÂåñËß¶Êë∏‰ΩìÈ™å */
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            touch-action: manipulation;
        }

        .markdown-btn:hover {
            background: var(--hover-bg);
            border-color: var(--accent-color);
            transform: scale(1.05);
        }

        .markdown-btn:active {
            transform: scale(0.95);
        }

        .markdown-btn strong,
        .markdown-btn em,
        .markdown-btn s,
        .markdown-btn mark {
            writing-mode: horizontal-tb;
            transform: rotate(90deg);
        }

        /* Ëá™Âä®Êç¢Ë°åÊ†∑Âºè */
        body.auto-word-wrap .editor {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* ÂÖ®Â±èÊ®°ÂºèÊ†∑Âºè */
        body.fullscreen {
            overflow: hidden;
        }

        body.fullscreen .toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        body.fullscreen .editor-container {
            position: fixed;
            top: var(--toolbar-height);
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
        }

        body.fullscreen .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        body.fullscreen .settings-panel {
            position: fixed;
            z-index: 1001;
        }

        body.fullscreen .markdown-toolbar {
            position: fixed;
            z-index: 1002;
        }

        body.fullscreen .modal {
            z-index: 2000;
        }

    
        /* Áä∂ÊÄÅÊ†èÈ°πÁõÆÊ†∑Âºè */
        .status-item {
            padding: 2px 6px;
            border-radius: 3px;
            background: var(--bg-secondary);
            font-size: 11px;
            transition: background 0.2s ease;
        }

        .status-item.hidden {
            display: none;
        }

        
        .modal-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
            transition: all 0.2s ease;
            margin: 0 5px;
        }

        .modal-btn:hover {
            background: var(--hover-bg);
            border-color: var(--accent-color);
        }

        .modal-btn.primary {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .modal-btn.primary:hover {
            background: #005a9e;
        }

        @media (max-width: 768px) {
            .markdown-toolbar {
                width: 50px;
            }

            .markdown-btn {
                width: 42px;
                height: 36px;
                font-size: 11px;
            }

            body:not(.fullscreen).markdown-visible .editor-container {
                margin-right: 50px;
            }
        }

        @media (max-width: 600px) {
            .preferences-row {
                flex-direction: column;
                gap: 10px;
            }

            .markdown-toolbar {
                width: 45px;
            }

            .markdown-btn {
                width: 37px;
                height: 32px;
                font-size: 10px;
            }

            body:not(.fullscreen).markdown-visible .editor-container {
                margin-right: 45px;
            }
        }

        /* Êü•ÊâæÊõøÊç¢ÂºπÁ™óÊ†∑Âºè */
        .find-replace-modal-content {
            max-width: 500px;
            width: 90%;
        }

        .find-replace-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .find-replace-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .find-replace-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }

        .find-replace-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .find-replace-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        .find-replace-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .find-replace-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .find-replace-btn {
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-family: inherit;
            transition: background-color 0.2s, transform 0.1s;
            min-width: 80px;
        }

        .find-replace-btn:hover {
            background-color: var(--hover-bg);
        }

        .find-replace-btn:active {
            transform: scale(0.95);
        }

        .find-replace-btn:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* ÊñáÊú¨Ê∏ÖÁêÜÂäüËÉΩÊ†∑Âºè */
        .text-clean-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .clean-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .clean-btn {
            padding: 10px 12px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-family: inherit;
            transition: all 0.2s;
            text-align: center;
        }

        .clean-btn:hover {
            background-color: var(--hover-bg);
            border-color: var(--accent-color);
        }

        .clean-btn:active {
            transform: scale(0.95);
        }

        .clean-btn-danger {
            background-color: #d32f2f;
            color: white;
            border-color: #d32f2f;
        }

        .clean-btn-danger:hover {
            background-color: #f44336;
            border-color: #f44336;
        }

        #findReplaceReplaceAllBtn {
            background-color: #e74c3c;
        }

        #findReplaceReplaceAllBtn:hover {
            background-color: #c0392b;
        }

        @media (max-width: 480px) {
            .find-replace-options {
                flex-direction: column;
                gap: 10px;
            }

            .find-replace-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .find-replace-btn {
                width: 100%;
                min-width: auto;
            }
        }

        /* ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .settings-modal-content {
            max-width: 600px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-info {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .settings-info p {
            color: var(--text-secondary);
            font-size: 13px;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* Êõ¥Êñ∞Áé∞ÊúâÁöÑËÆæÁΩÆÊ†∑Âºè‰ª•ÂåπÈÖçÊñ∞ÁöÑÊ®°ÊÄÅÊ°Ü */
        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 15px;
        }

        .settings-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .settings-row:last-child {
            margin-bottom: 0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-primary);
            min-width: 0;
            flex: 1;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            user-select: none;
            line-height: 1.3;
        }

        @media (max-width: 480px) {
            .settings-row {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .checkbox-group {
                width: 100%;
            }
        }

        /* Ë°®Ê†ºÊèíÂÖ•ÂØπËØùÊ°ÜÊ†∑Âºè */
        .table-modal-content {
            max-width: 450px;
            width: 90%;
        }

        .table-config-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .table-config-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .table-config-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
            min-width: 60px;
        }

        .table-config-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .table-config-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        .table-config-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            user-select: none;
        }

        .table-config-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .table-preview-container {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-secondary);
            padding: 15px;
        }

        .table-preview-title {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .table-preview {
            font-family: monospace;
            font-size: 12px;
            color: var(--text-secondary);
            white-space: pre;
            overflow-x: auto;
            max-height: 150px;
            overflow-y: auto;
            line-height: 1.4;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
        }

        .modal-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            font-family: inherit;
        }

        .modal-btn-cancel {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .modal-btn-cancel:hover {
            background-color: var(--bg-tertiary);
        }

        .modal-btn-confirm {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .modal-btn-confirm:hover {
            background-color: #005a9e;
            border-color: #005a9e;
        }

        @media (max-width: 480px) {
            .table-config-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .table-config-label {
                min-width: auto;
            }

            .table-config-input {
                width: 100%;
            }

            .modal-footer {
                flex-direction: column;
                gap: 8px;
            }

            .modal-btn {
                width: 100%;
            }
        }

        /* Âü∫Á°ÄÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-primary);
            border-radius: 8px;
            box-shadow: 0 4px 20px var(--shadow-color);
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: var(--bg-tertiary);
        }

        .modal-body {
            padding: 20px;
            color: var(--text-primary);
        }

        /* EmojiÊ®°ÊÄÅÊ°ÜÁâπÂÆöÊ†∑Âºè */
        .emoji-modal-content {
            width: 600px;
            height: 500px;
        }

        .emoji-search-container {
            margin-bottom: 15px;
        }

        .emoji-search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .emoji-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .emoji-category {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .emoji-category.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .emoji-grid-container {
            height: 250px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 8px;
        }

        .emoji-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 20px;
            transition: background-color 0.2s;
        }

        .emoji-item:hover {
            background-color: var(--bg-tertiary);
        }

        .emoji-recent-section {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .emoji-section-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .emoji-recent-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        /* Â∏ÆÂä©Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .help-modal-content {
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
        }

        .help-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .help-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .help-section h3 {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section p {
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .help-section ul {
            color: var(--text-secondary);
            margin: 0;
            padding-left: 20px;
        }

        .help-section li {
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .markdown-help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .markdown-help-item {
            background-color: var(--bg-secondary);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .markdown-help-item strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .markdown-help-item ul {
            margin: 0;
            padding-left: 15px;
        }

        .markdown-help-item li {
            margin-bottom: 4px;
            font-size: 13px;
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background-color: var(--bg-secondary);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .shortcut-item kbd {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            border: 1px solid var(--border-color);
            min-width: 60px;
            text-align: center;
        }

        .shortcut-item span {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .help-section code {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        /* Áä∂ÊÄÅÊ†èÊ†∑ÂºèÂ¢ûÂº∫ */
        .status-item {
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            position: relative;
        }

        .status-item:hover {
            color: var(--accent-color);
        }

        .status-item::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 1px;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }

        .status-item:hover::after {
            background-color: var(--accent-color);
        }

        /* ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .settings-modal-content {
            max-width: 600px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 15px;
        }

        .settings-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .settings-row:last-child {
            margin-bottom: 0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-primary);
            min-width: 0;
            flex: 1;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            user-select: none;
            line-height: 1.3;
        }

        .settings-info {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .settings-info p {
            color: var(--text-secondary);
            font-size: 13px;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        @media (max-width: 600px) {
            .help-modal-content {
                width: 98%;
                margin: 10px;
            }

            .markdown-help-grid {
                grid-template-columns: 1fr;
            }

            .shortcut-grid {
                grid-template-columns: 1fr;
            }

            .shortcut-item {
                justify-content: space-between;
            }

            .help-section h3 {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
    <div class="toolbar">
        <div class="toolbar-title">ËÆ∞‰∫ãÊú¨</div>

        <button class="toolbar-btn" id="newBtn" title="Êñ∞Âª∫">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span>Êñ∞Âª∫</span>
        </button>

        <button class="toolbar-btn" id="openBtn" title="ÊâìÂºÄ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span>ÊâìÂºÄ</span>
        </button>

        <button class="toolbar-btn" id="saveBtn" title="‰øùÂ≠ò">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span>‰øùÂ≠ò</span>
        </button>

        <div class="toolbar-separator"></div>

        <button class="toolbar-btn" id="undoBtn" title="Êí§ÈîÄ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 7v6h6"></path>
                <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
            </svg>
            <span>Êí§ÈîÄ</span>
        </button>

        <button class="toolbar-btn" id="redoBtn" title="ÈáçÂÅö">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 7v6h-6"></path>
                <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"></path>
            </svg>
            <span>ÈáçÂÅö</span>
        </button>

        <div class="toolbar-separator"></div>

        <button class="toolbar-btn" id="findBtn" title="Êü•Êâæ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <span>Êü•Êâæ</span>
        </button>

        <button class="toolbar-btn" id="themeBtn" title="ÂàáÊç¢‰∏ªÈ¢ò">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <span>‰∏ªÈ¢ò</span>
        </button>

        <button class="toolbar-btn" id="preferencesBtn" title="ÂÅèÂ•ΩËÆæÁΩÆ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M18.36 18.36l4.24 4.24M1 12h6m6 0h6"></path>
            </svg>
            <span>ÂÅèÂ•Ω</span>
        </button>
    </div>

    <!-- ‰∏ªÁºñËæëÂå∫Âüü -->
    <div class="editor-container">
        <div class="editor-wrapper show-grid">
            <textarea class="editor" id="editor" placeholder="ÂºÄÂßãËæìÂÖ•ÊñáÊú¨..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="background-image: linear-gradient(to right, rgba(128, 128, 128, 0.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(128, 128, 128, 0.15) 1px, transparent 1px); background-size: 21px 21px; background-position: 0 15px; background-repeat: repeat;"></textarea>
        </div>

        <!-- Áä∂ÊÄÅÊ†è -->
        <div class="status-bar" id="statusBar">
            <div class="status-left">
                <span id="charCount" class="status-item" style="display: inline-block !important; visibility: visible !important;">0 Â≠ó</span>
                <span id="wordCount" class="status-item" style="display: inline-block !important; visibility: visible !important;">0 ËØç</span>
                <span id="lineCount" class="status-item" style="display: inline-block !important; visibility: visible !important;">0 Ë°å</span>
                <span id="selectedCount" class="status-item" style="display: inline-block !important; visibility: visible !important;">Â∑≤ÈÄâ 0 Â≠óÁ¨¶</span>
		<span id="colCount" class="status-item" style="display: inline-block !important; visibility: visible !important;">1|1</span> 
                <span id="positionPercent" class="status-item" style="display: inline-block !important; visibility: visible !important;">0%</span>
            </div>
            <div class="status-right">
                <span id="dateTimeDisplay" class="status-item" style="display: inline-block !important; visibility: visible !important;" data-initial-time="true">--/-- --:--</span>
                <button class="help-btn" id="helpBtn" title="Â∏ÆÂä©‰∏é‰ªãÁªç">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.5 10a1.5 1.5 0 0 1 3 0v1.5a1.5 1.5 0 0 1-3 0z"></path>
                        <path d="M12 17h.01"></path>
                    </svg>
                </button>
            </div>
        </div>

    </div>

    <!-- MarkdownÂ∑•ÂÖ∑Ê†è -->
    <div class="markdown-toolbar collapsed" id="markdownToolbar">
        <div class="markdown-content">
            <!-- Á¨¨‰∏ÄË°åÔºöÁâπÊÆäÂäüËÉΩ -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="emoji" title="Ë°®ÊÉÖÁ¨¶Âè∑">
                    üôÇ
                </button>
            </div>

            <!-- Á¨¨‰∫åË°åÔºöÂü∫Á°ÄÊ†ºÂºè -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="bold" title="Á≤ó‰Ωì">
                    <strong>B</strong>
                </button>
                <button class="markdown-btn" data-action="italic" title="Êñú‰Ωì">
                    <em>I</em>
                </button>
                <button class="markdown-btn" data-action="strikethrough" title="Âà†Èô§Á∫ø">
                    <s>S</s>
                </button>
            </div>

            <!-- Á¨¨‰∏âË°åÔºöÊ†áÈ¢ò -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="h1" title="‰∏ÄÁ∫ßÊ†áÈ¢ò">
                    H1
                </button>
                <button class="markdown-btn" data-action="h2" title="‰∫åÁ∫ßÊ†áÈ¢ò">
                    H2
                </button>
                <button class="markdown-btn" data-action="h3" title="‰∏âÁ∫ßÊ†áÈ¢ò">
                    H3
                </button>
                <button class="markdown-btn" data-action="h4" title="ÂõõÁ∫ßÊ†áÈ¢ò">
                    H4
                </button>
                <button class="markdown-btn" data-action="h5" title="‰∫îÁ∫ßÊ†áÈ¢ò">
                    H5
                </button>
                <button class="markdown-btn" data-action="h6" title="ÂÖ≠Á∫ßÊ†áÈ¢ò">
                    H6
                </button>
            </div>

            <!-- Á¨¨ÂõõË°åÔºöÂºïÁî®Âíå‰ª£Á†Å -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="quote" title="ÂºïÁî®">
                    "
                </button>
                <button class="markdown-btn" data-action="code" title="Ë°åÂÜÖ‰ª£Á†Å">
                    &lt;/&gt;
                </button>
                <button class="markdown-btn" data-action="codeblock" title="‰ª£Á†ÅÂùó">
                    { }
                </button>
            </div>

            <!-- Á¨¨‰∫îË°åÔºöÂàóË°® -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="ul" title="Êó†Â∫èÂàóË°®">
                    ‚Ä¢
                </button>
                <button class="markdown-btn" data-action="ol" title="ÊúâÂ∫èÂàóË°®">
                    1.
                </button>
                <button class="markdown-btn" data-action="indent" title="Áº©Ëøõ">
                    ‚Üí
                </button>
                <button class="markdown-btn" data-action="outdent" title="ÂèñÊ∂àÁº©Ëøõ">
                    ‚Üê
                </button>
            </div>

            <!-- Á¨¨ÂÖ≠Ë°åÔºöÈìæÊé•ÂíåÂ™í‰Ωì -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="link" title="ÈìæÊé•">
                    üîó
                </button>
                <button class="markdown-btn" data-action="image" title="ÂõæÁâá">
                    üñº
                </button>
            </div>

            <!-- Á¨¨‰∏ÉË°åÔºöË°®Ê†ºÂíåÂàÜÈöî -->
            <div class="markdown-row">
                <button class="markdown-btn" data-action="table" title="Ë°®Ê†º">
                    ‚äû
                </button>
                <button class="markdown-btn" data-action="hr" title="ÂàÜÂâ≤Á∫ø">
                    ---
                </button>
                <button class="markdown-btn" data-action="footnote" title="ËÑöÊ≥®">
                    ‚Äª
                </button>
            </div>
        </div>
    </div>

    <!-- EmojiÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="emojiModal">
        <div class="modal-content emoji-modal-content">
            <div class="modal-header">
                <div class="modal-title">ÈÄâÊã©Ë°®ÊÉÖÁ¨¶Âè∑</div>
                <button class="modal-close" id="emojiModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div class="emoji-search-container">
                    <input type="text" id="emojiSearchInput" placeholder="ÊêúÁ¥¢Ë°®ÊÉÖÁ¨¶Âè∑..." class="emoji-search-input">
                </div>

                <!-- ÂàÜÁ±ªÊ†áÁ≠æ -->
                <div class="emoji-categories">
                    <button class="emoji-category active" data-category="smileys">üòÄ Â∏∏Áî®</button>
                    <button class="emoji-category" data-category="people">üë• ‰∫∫Áâ©</button>
                    <button class="emoji-category" data-category="animals">üêª Âä®Áâ©</button>
                    <button class="emoji-category" data-category="food">üçî È£üÁâ©</button>
                    <button class="emoji-category" data-category="activities">‚öΩ Ê¥ªÂä®</button>
                    <button class="emoji-category" data-category="travel">üöÄ ÊóÖË°å</button>
                    <button class="emoji-category" data-category="objects">üíé Áâ©ÂìÅ</button>
                    <button class="emoji-category" data-category="symbols">‚ù§Ô∏è Á¨¶Âè∑</button>
                    <button class="emoji-category" data-category="flags">üè≥Ô∏è ÂõΩÊóó</button>
                </div>

                <!-- EmojiÁΩëÊ†º -->
                <div class="emoji-grid-container">
                    <div class="emoji-grid" id="emojiGrid">
                        <!-- EmojiÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                    </div>
                </div>

                <!-- ÊúÄËøë‰ΩøÁî® -->
                <div class="emoji-recent-section">
                    <div class="emoji-section-title">ÊúÄËøë‰ΩøÁî®</div>
                    <div class="emoji-recent-grid" id="emojiRecentGrid">
                        <!-- ÊúÄËøë‰ΩøÁî®ÁöÑemojiÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ë°®Ê†ºÊèíÂÖ•ÂØπËØùÊ°Ü -->
    <div class="modal" id="tableModal">
        <div class="modal-content table-modal-content">
            <div class="modal-header">
                <div class="modal-title">ÊèíÂÖ•Ë°®Ê†º</div>
                <button class="modal-close" id="tableModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-config-container">
                    <div class="table-config-row">
                        <label for="tableRows" class="table-config-label">Ë°åÊï∞Ôºö</label>
                        <input type="number" id="tableRows" class="table-config-input" min="1" max="20" value="3">
                    </div>
                    <div class="table-config-row">
                        <label for="tableCols" class="table-config-label">ÂàóÊï∞Ôºö</label>
                        <input type="number" id="tableCols" class="table-config-input" min="1" max="10" value="3">
                    </div>
                    <div class="table-config-row">
                        <label for="tableHeader" class="table-config-checkbox">
                            <input type="checkbox" id="tableHeader" checked>
                            ÂåÖÂê´Ê†áÈ¢òË°å
                        </label>
                    </div>
                </div>

                <!-- Ë°®Ê†ºÈ¢ÑËßà -->
                <div class="table-preview-container">
                    <div class="table-preview-title">È¢ÑËßàÔºö</div>
                    <div class="table-preview" id="tablePreview">
                        <!-- Ë°®Ê†ºÈ¢ÑËßàÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="tableModalCancel">ÂèñÊ∂à</button>
                <button class="modal-btn modal-btn-confirm" id="tableModalConfirm">ÊèíÂÖ•Ë°®Ê†º</button>
            </div>
        </div>
    </div>

    <!-- Â∏ÆÂä©Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="helpModal">
        <div class="modal-content help-modal-content">
            <div class="modal-header">
                <div class="modal-title">Â∏ÆÂä©‰∏é‰ΩøÁî®ÊåáÂçó</div>
                <button class="modal-close" id="helpModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>üöÄ Âø´ÈÄüÂºÄÂßã</h3>
                    <p>‰∏≠ÊñáËÆ∞‰∫ãÊú¨ÊòØ‰∏Ä‰∏™Áé∞‰ª£ÂåñÁöÑÊñáÊú¨ÁºñËæëÂô®Ôºå‰∏ì‰∏∫‰∏≠ÊñáÁî®Êà∑‰ºòÂåñ„ÄÇ</p>
                    <ul>
                        <li><strong>Êñ∞Âª∫ÊñáÊ°£</strong>ÔºöÁÇπÂáªÂ∑•ÂÖ∑Ê†è"Êñ∞Âª∫"ÊåâÈíÆÊàñÊåâ Ctrl+N</li>
                        <li><strong>ÊâìÂºÄÊñá‰ª∂</strong>ÔºöÁÇπÂáª"ÊâìÂºÄ"ÊåâÈíÆÈÄâÊã©Êú¨Âú∞Êñá‰ª∂ÔºåÊàñÊåâ Ctrl+O</li>
                        <li><strong>‰øùÂ≠òÊñá‰ª∂</strong>ÔºöÁÇπÂáª"‰øùÂ≠ò"ÊåâÈíÆËá™ÂÆö‰πâÊñá‰ª∂Âêç‰øùÂ≠òÔºåÊàñÊåâ Ctrl+S</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üîç Êü•ÊâæÊõøÊç¢ÂäüËÉΩ</h3>
                    <p>ÁÇπÂáªÂ∑•ÂÖ∑Ê†è"Êü•Êâæ"ÊåâÈíÆÊàñÊåâ Ctrl+F ÊâìÂºÄÊü•ÊâæÈù¢ÊùøÔºö</p>
                    <ul>
                        <li>ÊîØÊåÅÂå∫ÂàÜÂ§ßÂ∞èÂÜôÊêúÁ¥¢</li>
                        <li>ÊîØÊåÅÂÖ®ËØçÂåπÈÖçÔºàÂåÖÊã¨‰∏≠ÊñáÔºâ</li>
                        <li>ÊîØÊåÅÊ≠£ÂàôË°®ËææÂºè</li>
                        <li>ÂèØËøõË°åÂçï‰∏™ÊõøÊç¢ÊàñÂÖ®ÈÉ®ÊõøÊç¢</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üé® MarkdownÁºñËæë</h3>
                    <p>Âè≥‰æßÊµÆÂä®Â∑•ÂÖ∑Ê†èÊèê‰æõÂÆåÊï¥ÁöÑMarkdownÊ†ºÂºèÂåñÂäüËÉΩÔºö</p>
                    <div class="markdown-help-grid">
                        <div class="markdown-help-item">
                            <strong>Âü∫Á°ÄÊ†ºÂºè</strong>
                            <ul>
                                <li>Á≤ó‰ΩìÔºö<code>**ÊñáÊú¨**</code></li>
                                <li>Êñú‰ΩìÔºö<code>*ÊñáÊú¨*</code></li>
                                <li>Âà†Èô§Á∫øÔºö<code>~~ÊñáÊú¨~~</code></li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>Ê†áÈ¢ò</strong>
                            <ul>
                                <li>‰∏ÄÁ∫ßÊ†áÈ¢òÔºö<code># Ê†áÈ¢ò</code></li>
                                <li>‰∫åÁ∫ßÊ†áÈ¢òÔºö<code>## Ê†áÈ¢ò</code></li>
                                <li>ÊîØÊåÅ1-6Á∫ßÊ†áÈ¢ò</li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>ÂàóË°®</strong>
                            <ul>
                                <li>Êó†Â∫èÂàóË°®Ôºö<code>- È°πÁõÆ</code></li>
                                <li>ÊúâÂ∫èÂàóË°®Ôºö<code>1. È°πÁõÆ</code></li>
                                <li>ÊîØÊåÅÁº©ËøõÊéßÂà∂</li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>‰ª£Á†Å</strong>
                            <ul>
                                <li>Ë°åÂÜÖ‰ª£Á†ÅÔºö<code>`‰ª£Á†Å`</code></li>
                                <li>‰ª£Á†ÅÂùóÔºö<code>```‰ª£Á†Å```</code></li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>ÈìæÊé•ÂíåÂõæÁâá</strong>
                            <ul>
                                <li>ÈìæÊé•Ôºö<code>[ÊñáÊú¨](URL)</code></li>
                                <li>ÂõæÁâáÔºö<code>![ÊèèËø∞](URL)</code></li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>Êô∫ËÉΩË°®Ê†º</strong>
                            <p>ÁÇπÂáªË°®Ê†ºÊåâÈíÆÊâìÂºÄÈÖçÁΩÆÂØπËØùÊ°ÜÔºö</p>
                            <ul>
                                <li>ËÆæÁΩÆË°åÊï∞(1-20)ÂíåÂàóÊï∞(1-10)</li>
                                <li>ÈÄâÊã©ÊòØÂê¶ÂåÖÂê´Ê†áÈ¢òË°å</li>
                                <li>ÂÆûÊó∂È¢ÑËßàË°®Ê†ºÁªìÊûÑ</li>
                                <li>ÊîØÊåÅEnterÁ°ÆËÆ§„ÄÅESCÂÖ≥Èó≠</li>
                            </ul>
                        </div>
                        <div class="markdown-help-item">
                            <strong>ÂÖ∂‰ªñÂäüËÉΩ</strong>
                            <ul>
                                <li>ÂºïÁî®Ôºö<code>&gt; ÊñáÊú¨</code></li>
                                <li>ÂàÜÂâ≤Á∫øÔºö<code>---</code></li>
                                <li>ËÑöÊ≥®Ôºö<code>[^1]</code></li>
                                <li>EmojiË°®ÊÉÖÔºöÂÜÖÁΩÆÈÄâÊã©Âô®</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚å®Ô∏è Âø´Êç∑ÈîÆ</h3>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <kbd>Ctrl+N</kbd>
                            <span>Êñ∞Âª∫ÊñáÊ°£</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+O</kbd>
                            <span>ÊâìÂºÄÊñá‰ª∂</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+S</kbd>
                            <span>‰øùÂ≠òÊñá‰ª∂</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+F</kbd>
                            <span>Êü•Êâæ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+Z</kbd>
                            <span>Êí§ÈîÄ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+Y</kbd>
                            <span>ÈáçÂÅö</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+A</kbd>
                            <span>ÂÖ®ÈÄâ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>ÂÖ≥Èó≠ÂØπËØùÊ°Ü</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üéØ È´òÁ∫ßÂäüËÉΩ</h3>
                    <ul>
                        <li><strong>Ëá™Âä®‰øùÂ≠ò</strong>ÔºöÂÜÖÂÆπËá™Âä®‰øùÂ≠òÂà∞ÊµèËßàÂô®Êú¨Âú∞Â≠òÂÇ®</li>
                        <li><strong>‰∏ªÈ¢òÂàáÊç¢</strong>ÔºöÊîØÊåÅÊµÖËâ≤/Ê∑±Ëâ≤‰∏ªÈ¢ò</li>
                        <li><strong>ÂÖ®Â±èÊ®°Âºè</strong>Ôºö‰∏ìÊ≥®ÂÜô‰ΩúÁéØÂ¢É</li>
                        <li><strong>ÂÆûÊó∂ÁªüËÆ°</strong>ÔºöÊòæÁ§∫Â≠óÊï∞„ÄÅË°åÊï∞„ÄÅÂÖâÊ†á‰ΩçÁΩÆ</li>
                        <li><strong>ÁßªÂä®ÈÄÇÈÖç</strong>ÔºöÂÆåÁæéÊîØÊåÅÊâãÊú∫ÂíåÂπ≥ÊùøËÆæÂ§á</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üìÅ Êñá‰ª∂Ê†ºÂºèÊîØÊåÅ</h3>
                    <p>ÊîØÊåÅ‰øùÂ≠ò‰∏∫Â§öÁßçÊ†ºÂºèÔºöTXT, MD, HTML, CSS, JS, JSON, XML, CSV</p>
                </div>

                <div class="help-section">
                    <h3>üí° ‰ΩøÁî®ÊäÄÂ∑ß</h3>
                    <ul>
                        <li>ÂèåÂáªÁä∂ÊÄÅÊ†è‰∏≠ÁöÑ‰ªªÊÑèÁªüËÆ°È°πÁõÆÂèØ‰ª•ÈöêËóèËØ•‰ø°ÊÅØ</li>
                        <li>ÁßªÂä®Á´ØÂ∫ïÈÉ®ÊªëÂùóÂèØ‰ª•Ë∞ÉËäÇËæìÂÖ•Âå∫ÂüüÈ´òÂ∫¶</li>
                        <li>ÊñáÊú¨Ê∏ÖÁêÜÂ∑•ÂÖ∑ÂèØ‰ª•Âø´ÈÄüÊï¥ÁêÜÊ†ºÂºè</li>
                        <li>ÊâÄÊúâËÆæÁΩÆÈÉΩ‰ºöËá™Âä®‰øùÂ≠òÂπ∂Á´ãÂç≥ÁîüÊïà</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-confirm" id="helpModalOkBtn">Áü•ÈÅì‰∫Ü</button>
            </div>
        </div>
    </div>

    <!-- Êñá‰ª∂ËæìÂÖ• -->
    <input type="file" class="file-input" id="fileInput" accept=".txt,.md,.js,.html,.css,.json,.xml,.csv">

    <!-- ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="preferencesModal">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <div class="modal-title">ËÆæÁΩÆ</div>
                <button class="modal-close" id="preferencesModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <div class="settings-title">ÊòæÁ§∫ËÆæÁΩÆ</div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showLineCount" checked>
                            <label for="showLineCount">ÊÄªË°åÊï∞</label>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showCharCount" checked>
                            <label for="showCharCount">Â≠óÁ¨¶Êï∞</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showWordCount" checked>
                            <label for="showWordCount">ËØçÊï∞ÁªüËÆ°</label>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showColCount" checked>
                            <label for="showColCount">ÂÖâÊ†á‰ΩçÁΩÆ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showSelectedCount" checked>
                            <label for="showSelectedCount">ÈÄâ‰∏≠Â≠óÁ¨¶</label>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showPositionPercent" checked>
                            <label for="showPositionPercent">‰ΩçÁΩÆÁôæÂàÜÊØî</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showDateTime" checked>
                            <label for="showDateTime">ÊòæÁ§∫Êó∂Èó¥Êó•Êúü</label>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">ÁºñËæëËÆæÁΩÆ</div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="markdownMode">
                            <label for="markdownMode">Markdown Â∑•ÂÖ∑Ê†è</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoWordWrap">
                            <label for="autoWordWrap">Ëá™Âä®Êç¢Ë°å</label>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">ÁïåÈù¢ËÆæÁΩÆ</div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableFullscreen">
                            <label for="enableFullscreen">ÂÖ®Â±èÊ®°Âºè</label>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="checkbox-group" style="flex: 0 0 100%;">
                            <label for="bottomMarginSlider" style="display: block; margin-bottom: 8px; width: 100%;">Â∫ïÈÉ®ËæπË∑ù: <span id="bottomMarginValue">175</span>px</label>
                            <input type="range" id="bottomMarginSlider" min="20" max="300" value="175" style="width: 100%;">
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">ËæÖÂä©Â∑•ÂÖ∑</div>
                    <div class="settings-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showGrid" checked>
                            <label for="showGrid">ÁΩëÊ†ºËÉåÊôØ</label>
                        </div>
                    </div>
                </div>
                <div class="settings-info">
                    <p>‚úì ËÆæÁΩÆÂ∞ÜËá™Âä®‰øùÂ≠òÂπ∂Á´ãÂç≥ÁîüÊïà</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="messageModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">ÊèêÁ§∫</div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalMessage">
                Ê∂àÊÅØÂÜÖÂÆπ
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" id="modalOkBtn">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- ‰øùÂ≠òÊñá‰ª∂Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="saveModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‰øùÂ≠òÊñá‰ª∂</div>
                <button class="modal-close" id="saveModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <label for="fileNameInput" style="display: block; margin-bottom: 8px; font-size: 14px;">Êñá‰ª∂Âêç:</label>
                <input type="text" id="fileNameInput" class="settings-input" placeholder="ËØ∑ËæìÂÖ•ÂÆåÊï¥Êñá‰ª∂ÂêçÔºàÂåÖÂê´Êâ©Â±ïÂêçÔºâ" style="width: 100%; margin-bottom: 12px;">

                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 6px; font-size: 13px; color: var(--text-secondary);">Â∏∏Áî®Êâ©Â±ïÂêçÔºö</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                        <button type="button" class="extension-btn" data-ext=".txt">.txt</button>
                        <button type="button" class="extension-btn" data-ext=".md">.md</button>
                        <button type="button" class="extension-btn" data-ext=".html">.html</button>
                        <button type="button" class="extension-btn" data-ext=".css">.css</button>
                        <button type="button" class="extension-btn" data-ext=".js">.js</button>
                        <button type="button" class="extension-btn" data-ext=".json">.json</button>
                        <button type="button" class="extension-btn" data-ext=".xml">.xml</button>
                        <button type="button" class="extension-btn" data-ext=".csv">.csv</button>
                        <button type="button" class="extension-btn" data-ext="">Êó†Êâ©Â±ïÂêç</button>
                    </div>
                </div>

                <div style="font-size: 12px; color: var(--text-secondary);">
                    ÊèêÁ§∫ÔºöÂèØ‰ª•ËæìÂÖ•ÂÆåÊï¥Êñá‰ª∂ÂêçÔºàÂ¶Ç document.mdÔºâÊàñ‰ΩøÁî®‰∏äÊñπÂø´Êç∑ÊåâÈíÆÊ∑ªÂä†Êâ©Â±ïÂêç
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="saveModalCancelBtn">ÂèñÊ∂à</button>
                <button class="modal-btn primary" id="saveModalConfirmBtn">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâæÊõøÊç¢ÂºπÁ™ó -->
    <div class="modal" id="findReplaceModal">
        <div class="modal-content find-replace-modal-content">
            <div class="modal-header">
                <div class="modal-title">Êü•Êâæ‰∏éÊõøÊç¢</div>
                <button class="modal-close" id="findReplaceModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="find-replace-section">
                    <div class="find-replace-row">
                        <label class="find-replace-label">Êü•ÊâæÂÜÖÂÆπ:</label>
                        <input type="text" class="find-replace-input" id="findReplaceSearchInput" placeholder="ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÊñáÊú¨">
                    </div>
                    <div class="find-replace-row">
                        <label class="find-replace-label">ÊõøÊç¢ÂÜÖÂÆπ:</label>
                        <input type="text" class="find-replace-input" id="findReplaceReplaceInput" placeholder="ËæìÂÖ•ÊõøÊç¢ÊñáÊú¨ÔºàÂèØÈÄâÔºâ">
                    </div>
                    <div class="find-replace-options">
                        <div class="checkbox-group">
                            <input type="checkbox" id="findReplaceCaseSensitive">
                            <label for="findReplaceCaseSensitive">Âå∫ÂàÜÂ§ßÂ∞èÂÜô</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="findReplaceWholeWord">
                            <label for="findReplaceWholeWord">ÂÖ®ËØçÂåπÈÖç</label>
                        </div>
                    </div>
                    <div class="find-replace-buttons">
                        <button class="find-replace-btn" id="findReplaceFindPrevBtn">Êü•Êâæ‰∏ä‰∏Ä‰∏™</button>
                        <button class="find-replace-btn" id="findReplaceFindBtn">Êü•Êâæ‰∏ã‰∏Ä‰∏™</button>
                        <button class="find-replace-btn" id="findReplaceReplaceBtn">ÊõøÊç¢</button>
                        <button class="find-replace-btn" id="findReplaceReplaceAllBtn">ÂÖ®ÈÉ®ÊõøÊç¢</button>
                    </div>
                </div>

                <!-- Âø´Êç∑Êìç‰Ωú -->
                <div class="text-clean-section">
                    <div class="section-title">Âø´Êç∑Êìç‰Ωú</div>
                    <div class="clean-buttons-grid">
                        <button class="clean-btn" id="copyAllBtn">Â§çÂà∂ÂÖ®ÈÉ®</button>
                        <button class="clean-btn clean-btn-danger" id="clearBtn">Ê∏ÖÁ©∫ÊñáÊ°£</button>
                    </div>
                </div>

                <!-- ÊñáÊú¨Ê∏ÖÁêÜÂäüËÉΩ -->
                <div class="text-clean-section">
                    <div class="section-title">ÊñáÊú¨Ê∏ÖÁêÜÂ∑•ÂÖ∑</div>
                    <div class="clean-buttons-grid">
                        <button class="clean-btn" id="removeEmptyLinesBtn">Âà†Èô§Á©∫Ë°å</button>
                        <button class="clean-btn" id="removeSpacesBtn">Âà†Èô§Â§ö‰ΩôÁ©∫Ê†º</button>
                        <button class="clean-btn" id="removeBlankCharsBtn">Âà†Èô§Á©∫ÁôΩÂ≠óÁ¨¶</button>
                        <button class="clean-btn" id="removeTabsBtn">Âà†Èô§Âà∂Ë°®Á¨¶</button>
                        <button class="clean-btn" id="normalizeLinesBtn">ËßÑËåÉÂåñÊç¢Ë°å</button>
                        <button class="clean-btn clean-btn-danger" id="cleanAllBtn">ÂÖ®ÈÉ®Ê∏ÖÁêÜ</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="findReplaceCloseBtn">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- Â∏ÆÂä©Âíå‰ªãÁªçÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="helpModal">
        <div class="modal-content help-modal-content">
            <div class="modal-header">
                <div class="modal-title">ËÆ∞‰∫ãÊú¨ - Â∏ÆÂä©‰∏é‰ªãÁªç</div>
                <button class="modal-close" id="helpModalClose">&times;</button>
            </div>
            <div class="modal-body help-modal-body">
                <div class="help-section">
                    <h3>üìù ËΩØ‰ª∂‰ªãÁªç</h3>
                    <p><strong>ËÆ∞‰∫ãÊú¨ v0.1.2</strong>ÊòØ‰∏ÄÊ¨æÁé∞‰ª£ÂåñÁöÑÁΩëÈ°µÊñáÊú¨ÁºñËæëÂô®Ôºå‰∏ì‰∏∫ÊèêÂçáÊÇ®ÁöÑÊñáÊú¨ÁºñËæë‰ΩìÈ™åËÄåËÆæËÆ°„ÄÇÊú¨ËΩØ‰ª∂ÈááÁî®Á∫ØÂâçÁ´ØÊäÄÊúØÂÆûÁé∞ÔºåÊó†ÈúÄÊúçÂä°Âô®ÊîØÊåÅÔºåÊâÄÊúâÊï∞ÊçÆÂÆåÂÖ®‰øùÂ≠òÂú®ÊÇ®ÁöÑÊú¨Âú∞ËÆæÂ§á‰∏≠ÔºåÁ°Æ‰øùÈöêÁßÅÂÆâÂÖ®„ÄÇ</p>
                    <p>‰Ωú‰∏∫‰∏ÄÊ¨æËΩªÈáèÁ∫ß‰ΩÜÂäüËÉΩÂº∫Â§ßÁöÑÊñáÊú¨ÁºñËæëÂ∑•ÂÖ∑ÔºåÂÆÉÈÄÇÂêàÊó•Â∏∏ÁöÑÊñáÊú¨ËÆ∞ÂΩï„ÄÅÊñáÊ°£ÁºñÂÜô„ÄÅ‰ª£Á†ÅÁºñËæë„ÄÅMarkdownÂÜô‰ΩúÁ≠âÂ§öÁßçÂú∫ÊôØÔºåÊîØÊåÅÊ°åÈù¢ÂíåÁßªÂä®ËÆæÂ§áÁöÑÂÆåÁæé‰ΩìÈ™å„ÄÇ</p>
                </div>

                <div class="help-section">
                    <h3>‚ú® ‰∏ªË¶ÅÁâπÊÄß</h3>
                    <ul class="feature-list">
                        <li><strong>Áé∞‰ª£ÂåñÁïåÈù¢</strong>ÔºöÁÆÄÊ¥Å‰ºòÈõÖÁöÑÁî®Êà∑ÁïåÈù¢ÔºåÊîØÊåÅÊòéÊöó‰∏ªÈ¢òÂàáÊç¢</li>
                        <li><strong>ÂÆåÊï¥ÁöÑÁºñËæëÂäüËÉΩ</strong>ÔºöÊí§ÈîÄ/ÈáçÂÅö„ÄÅÊü•ÊâæÊõøÊç¢„ÄÅÊñáÊú¨Ê∏ÖÁêÜ</li>
                        <li><strong>ÂèåÂêëÊü•Êâæ</strong>ÔºöÊîØÊåÅÂêëÂâçÂíåÂêëÂêéÊü•ÊâæÊñáÊú¨ÂÜÖÂÆπ</li>
                        <li><strong>MarkdownÊîØÊåÅ</strong>ÔºöÂÜÖÁΩÆ30+‰∏™MarkdownÊ†ºÂºèÂåñÂ∑•ÂÖ∑ÔºåÊñπ‰æøÂÜô‰Ωú</li>
                        <li><strong>Êô∫ËÉΩÁªüËÆ°</strong>ÔºöÂÆûÊó∂ÊòæÁ§∫Â≠óÊï∞„ÄÅËØçÊï∞„ÄÅË°åÊï∞„ÄÅÂÖâÊ†á‰ΩçÁΩÆÁ≠â‰ø°ÊÅØ</li>
                        <li><strong>ÂìçÂ∫îÂºèËÆæËÆ°</strong>ÔºöÂÆåÁæéÈÄÇÈÖçÊ°åÈù¢„ÄÅÂπ≥Êùø„ÄÅÊâãÊú∫Á≠âËÆæÂ§á</li>
                        <li><strong>Êú¨Âú∞Â≠òÂÇ®</strong>ÔºöËá™Âä®‰øùÂ≠òÁî®Êà∑ÂÅèÂ•ΩËÆæÁΩÆÔºå‰øùÊä§ÈöêÁßÅÂÆâÂÖ®</li>
                        <li><strong>Êñá‰ª∂Êìç‰Ωú</strong>ÔºöÊîØÊåÅÂ§öÁßçÊ†ºÂºèÁöÑÊñá‰ª∂ÊâìÂºÄÂíå‰øùÂ≠ò</li>
                        <li><strong>ÂÖ®Â±èÊ®°Âºè</strong>Ôºö‰∏ìÊ≥®ÂÜô‰ΩúÊ®°ÂºèÔºåÊéíÈô§Âπ≤Êâ∞</li>
                        <li><strong>Ëá™Âä®Êç¢Ë°å</strong>ÔºöÊô∫ËÉΩÊ†πÊçÆÂ±èÂπïÂ∞∫ÂØ∏Ë∞ÉÊï¥ÊñáÊú¨ÊòæÁ§∫</li>
                        <li><strong>Êó∂Èó¥ÊòæÁ§∫</strong>ÔºöÁä∂ÊÄÅÊ†èÂÆûÊó∂ÊòæÁ§∫ÂΩìÂâçÊó∂Èó¥Êó•Êúü</li>
                        <li><strong>ÂèØË∞ÉËäÇÂ∫ïÈÉ®ËæπË∑ù</strong>ÔºöÁî®Êà∑ÂèØÂú®ËÆæÁΩÆ‰∏≠Ë∞ÉÊï¥ÁºñËæëÂå∫Â∫ïÈÉ®ËæπË∑ù</li>
                        <li><strong>ÂèñÊ∂àÁº©Ëøõ‰øÆÂ§ç</strong>ÔºöÊîπËøõÁöÑÂèñÊ∂àÁº©ËøõÂäüËÉΩÔºåÊîØÊåÅÂçïË°åÂíåÂ§öË°åÊìç‰Ωú</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üéØ Âø´ÈÄü‰∏äÊâã</h3>
                    <div class="guide-subsection">
                        <h4>Âü∫Á°ÄÊìç‰Ωú</h4>
                        <ul>
                            <li><strong>Êñ∞Âª∫ÊñáÊ°£</strong>ÔºöÁÇπÂáªÂ∑•ÂÖ∑Ê†è"Êñ∞Âª∫"ÊåâÈíÆÊàñ‰ΩøÁî®Âø´Êç∑ÈîÆ Ctrl+N</li>
                            <li><strong>ÊâìÂºÄÊñá‰ª∂</strong>ÔºöÁÇπÂáª"ÊâìÂºÄ"ÊåâÈíÆÈÄâÊã©Êú¨Âú∞Êñá‰ª∂ÔºåÊàñ‰ΩøÁî® Ctrl+O</li>
                            <li><strong>‰øùÂ≠òÊñá‰ª∂</strong>ÔºöÁÇπÂáª"‰øùÂ≠ò"ÊåâÈíÆËá™ÂÆö‰πâÊñá‰ª∂Âêç‰øùÂ≠òÔºåÊàñ‰ΩøÁî® Ctrl+S</li>
                            <li><strong>Êí§ÈîÄ/ÈáçÂÅö</strong>ÔºöÊîØÊåÅÊúÄÂ§ö50Ê≠•Êìç‰ΩúÂéÜÂè≤ÔºåÂø´Êç∑ÈîÆ Ctrl+Z/Ctrl+Y</li>
                            <li><strong>ÂÖ®ÈÄâÊñáÊú¨</strong>Ôºö‰ΩøÁî® Ctrl+A Âø´Êç∑ÈîÆÈÄâÊã©ÂÖ®ÈÉ®ÊñáÊ°£ÂÜÖÂÆπ</li>
                        </ul>
                    </div>

                    <div class="guide-subsection">
                        <h4>ÁïåÈù¢ÂØºËà™</h4>
                        <ul>
                            <li><strong>È°∂ÈÉ®Â∑•ÂÖ∑Ê†è</strong>ÔºöÂåÖÂê´Êñ∞Âª∫„ÄÅÊâìÂºÄ„ÄÅ‰øùÂ≠ò„ÄÅÊí§ÈîÄ„ÄÅÈáçÂÅö„ÄÅÊü•Êâæ„ÄÅ‰∏ªÈ¢òÂàáÊç¢Á≠âÂäüËÉΩ</li>
                            <li><strong>ÁºñËæëÂå∫Âüü</strong>Ôºö‰∏ªË¶ÅÊñáÊú¨ÁºñËæëÁ©∫Èó¥ÔºåÊîØÊåÅÊâÄÊúâÁºñËæëÊìç‰Ωú</li>
                            <li><strong>Áä∂ÊÄÅÊ†è</strong>ÔºöÂ∫ïÈÉ®ÊòæÁ§∫ÊñáÊ°£ÁªüËÆ°„ÄÅÊó∂Èó¥„ÄÅÂÅèÂ•ΩËÆæÁΩÆÂÖ•Âè£</li>
                            <li><strong>MarkdownÂ∑•ÂÖ∑Ê†è</strong>ÔºöÂè≥‰æßÊµÆÂä®Èù¢ÊùøÔºåÊèê‰æõÊ†ºÂºèÂåñÂ∑•ÂÖ∑</li>
                            <li><strong>Êü•ÊâæÊõøÊç¢</strong>ÔºöÁÇπÂáªÊü•ÊâæÊåâÈíÆÊâìÂºÄÈù¢ÊùøÔºåÂåÖÂê´Êü•Êâæ„ÄÅÊõøÊç¢ÂíåÊñáÊú¨Ê∏ÖÁêÜÂäüËÉΩ</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üîç ÁºñËæëÂäüËÉΩ</h3>
                    <div class="guide-subsection">
                        <h4>Êü•Êâæ‰∏éÊõøÊç¢</h4>
                        <ul>
                            <li>ÁÇπÂáªÂ∑•ÂÖ∑Ê†è"Êü•Êâæ"ÊåâÈíÆÊàñÊåâ Ctrl+F ÊâìÂºÄÊü•ÊâæÊõøÊç¢Èù¢Êùø</li>
                            <li>ÊîØÊåÅÂå∫ÂàÜÂ§ßÂ∞èÂÜôÊêúÁ¥¢ÂíåÂÖ®ËØçÂåπÈÖçÈÄâÈ°π</li>
                            <li>ÂèØÊâßË°å"Êü•Êâæ‰∏ä‰∏Ä‰∏™"„ÄÅ"Êü•Êâæ‰∏ã‰∏Ä‰∏™"„ÄÅ"ÊõøÊç¢"„ÄÅ"ÂÖ®ÈÉ®ÊõøÊç¢"Êìç‰Ωú</li>
                            <li>Êü•ÊâæÊõøÊç¢Èù¢ÊùøÂÜÖËøòÂåÖÂê´ÊñáÊú¨Ê∏ÖÁêÜÂíåÂø´Êç∑Êìç‰ΩúÂäüËÉΩ</li>
                        </ul>
                    </div>

                    <div class="guide-subsection">
                        <h4>ÊñáÊú¨Ê∏ÖÁêÜÂ∑•ÂÖ∑</h4>
                        <ul>
                            <li><strong>Âà†Èô§Á©∫Ë°å</strong>ÔºöÁßªÈô§ÊñáÊ°£‰∏≠ÊâÄÊúâÁ©∫ÁôΩË°å</li>
                            <li><strong>Âà†Èô§Â§ö‰ΩôÁ©∫Ê†º</strong>ÔºöËßÑËåÉÂåñÁ©∫Ê†º‰ΩøÁî®ÔºåÂà†Èô§Ë°åÈ¶ñË°åÂ∞æÂ§ö‰ΩôÁ©∫Ê†º</li>
                            <li><strong>Âà†Èô§Á©∫ÁôΩÂ≠óÁ¨¶</strong>ÔºöÊ∏ÖÁêÜÂà∂Ë°®Á¨¶„ÄÅÊç¢Ë°åÁ¨¶Á≠â‰∏çÂèØËßÅÁ©∫ÁôΩÂ≠óÁ¨¶</li>
                            <li><strong>Âà†Èô§Âà∂Ë°®Á¨¶</strong>ÔºöÁßªÈô§ÊâÄÊúâÂà∂Ë°®Á¨¶ÔºàTabÂ≠óÁ¨¶Ôºâ</li>
                            <li><strong>ËßÑËåÉÊç¢Ë°å</strong>ÔºöÁªü‰∏ÄÊç¢Ë°åÁ¨¶Ê†ºÂºèÔºåËßÑËåÉÂåñÊñáÊ°£ÁªìÊûÑ</li>
                            <li><strong>ÂÖ®ÈÉ®Ê∏ÖÁêÜ</strong>ÔºöÊâßË°åÊâÄÊúâÊ∏ÖÁêÜÊìç‰ΩúÔºåÊúÄÂ§ßÁ®ãÂ∫¶ÂáÄÂåñÊñáÊ°£</li>
                        </ul>
                    </div>

                    <div class="guide-subsection">
                        <h4>MarkdownÂäüËÉΩ</h4>
                        <ul>
                            <li><strong>Âü∫Á°ÄÊ†ºÂºè</strong>ÔºöÁ≤ó‰Ωì„ÄÅÊñú‰Ωì„ÄÅÂà†Èô§Á∫ø„ÄÅÈ´ò‰∫Æ„ÄÅ‰∏äÊ†á„ÄÅ‰∏ãÊ†á</li>
                            <li><strong>Ê†áÈ¢òÊ†ºÂºè</strong>Ôºö‰∏ÄÁ∫ß„ÄÅ‰∫åÁ∫ß„ÄÅ‰∏âÁ∫ßÊ†áÈ¢ò</li>
                            <li><strong>ÊñáÊú¨ÂÖÉÁ¥†</strong>ÔºöÂºïÁî®„ÄÅË°åÂÜÖ‰ª£Á†Å„ÄÅ‰ª£Á†ÅÂùó</li>
                            <li><strong>ÂàóË°®Ê†ºÂºè</strong>ÔºöÊúâÂ∫èÂàóË°®„ÄÅÊó†Â∫èÂàóË°®„ÄÅ‰ªªÂä°ÂàóË°®</li>
                            <li><strong>ÈìæÊé•ÂõæÁâá</strong>ÔºöÊôÆÈÄöÈìæÊé•„ÄÅÂõæÁâá„ÄÅÈÇÆÁÆ±ÈìæÊé•„ÄÅËßÜÈ¢ëÈìæÊé•„ÄÅÈü≥È¢ëÈìæÊé•</li>
                            <li><strong>ÁªìÊûÑÂÖÉÁ¥†</strong>ÔºöË°®Ê†º„ÄÅÂàÜÂâ≤Á∫ø„ÄÅÁõÆÂΩï„ÄÅËÑöÊ≥®„ÄÅÊï∞Â≠¶ÂÖ¨Âºè</li>
                            <li><strong>Â¢ûÂº∫ÂäüËÉΩ</strong>ÔºöËØ¶ÊÉÖÊäòÂè†„ÄÅÊ†áËÆ∞„ÄÅMermaidÂõæË°®„ÄÅemojiÁ≠â</li>
                            <li><strong>Áº©Ëøõ/ÂèñÊ∂àÁº©Ëøõ</strong>ÔºöÊîØÊåÅ4‰∏™Á©∫Ê†ºÊàñÂà∂Ë°®Á¨¶ÁöÑÁº©ËøõÂíåÂèñÊ∂àÁº©Ëøõ</li>
                        </ul>
                    </div>

                    <div class="guide-subsection">
                        <h4>Âø´Êç∑Êìç‰Ωú</h4>
                        <ul>
                            <li><strong>Â§çÂà∂ÂÖ®ÈÉ®</strong>ÔºöÂø´ÈÄüÂ§çÂà∂ÊñáÊ°£ÊâÄÊúâÂÜÖÂÆπÂà∞Ââ™Ë¥¥Êùø</li>
                            <li><strong>Ê∏ÖÁ©∫ÊñáÊ°£</strong>ÔºöÊ∏ÖÈô§ÊñáÊ°£‰∏≠ÁöÑÂÖ®ÈÉ®ÂÜÖÂÆπ</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚öôÔ∏è ÂÅèÂ•ΩËÆæÁΩÆ</h3>
                    <p>ÁÇπÂáªÂ∑•ÂÖ∑Ê†è"ÂÅèÂ•Ω"ÊåâÈíÆÂèØÊâìÂºÄËÆæÁΩÆÈù¢ÊùøÔºåËá™ÂÆö‰πâÊÇ®ÁöÑÁºñËæë‰ΩìÈ™åÔºö</p>
                    <ul>
                        <li><strong>ÊòæÁ§∫ËÆæÁΩÆ</strong>ÔºöÊéßÂà∂Áä∂ÊÄÅÊ†èÂêÑÈ°πÁªüËÆ°ÁöÑÊòæÁ§∫/ÈöêËóèÔºàËØçÊï∞ÁªüËÆ°„ÄÅÂ≠óÊï∞ÁªüËÆ°„ÄÅÊÄªË°åÊï∞„ÄÅÂÖâÊ†á‰ΩçÁΩÆ„ÄÅÈÄâ‰∏≠Â≠óÁ¨¶Êï∞„ÄÅ‰ΩçÁΩÆÁôæÂàÜÊØîÔºâ</li>
                        <li><strong>ÁºñËæëÊ®°Âºè</strong>ÔºöÂêØÁî®ÊàñÁ¶ÅÁî®MarkdownÂ∑•ÂÖ∑Ê†è</li>
                        <li><strong>Ëá™Âä®Êç¢Ë°å</strong>ÔºöÊ†πÊçÆÂ±èÂπïÂ∞∫ÂØ∏Ëá™Âä®Ë∞ÉÊï¥ÊñáÊú¨Êç¢Ë°å</li>
                        <li><strong>ÂÖ®Â±èÊ®°Âºè</strong>ÔºöÂêØÁî®ÂÖ®Â±èÊ®°Âºè‰ª•Ëé∑Âæó‰∏ìÊ≥®ÁöÑÂÜô‰ΩúÁéØÂ¢É</li>
                        <li><strong>ÁΩëÊ†ºËÉåÊôØ</strong>ÔºöÂêØÁî®ÊàñÁ¶ÅÁî®ÁΩëÊ†ºËÉåÊôØËæÖÂä©ÂØπÈΩê</li>
                        <li><strong>Â∫ïÈÉ®ËæπË∑ù</strong>ÔºöÈÄöËøáÊªëÂùóË∞ÉÊï¥ÁºñËæëÂå∫Â∫ïÈÉ®ËæπË∑ùÈ´òÂ∫¶</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üìà ÁªüËÆ°ÂäüËÉΩËØ¥Êòé</h3>
                    <div class="guide-subsection">
                        <h4>Â≠óÊï∞ÁªüËÆ°</h4>
                        <ul>
                            <li><strong>Â≠ó</strong>ÔºöÊòæÁ§∫ÂΩìÂâçÊñáÊ°£ÁöÑÊÄªÂ≠óÁ¨¶Êï∞ÔºàÂ∑≤ÁÆÄÂåñ‰∏∫"Â≠ó"Ôºâ</li>
                            <li><strong>ËØç</strong>ÔºöÁªüËÆ°Ëã±ÊñáÂçïËØçÊï∞Âíå‰∏≠ÊñáÊ±âÂ≠óÊï∞</li>
                            <li><strong>Ë°å</strong>ÔºöÊòæÁ§∫ÊñáÊ°£ÊÄªË°åÊï∞</li>
                            <li><strong>Â∑≤ÈÄâ</strong>ÔºöÈÄâ‰∏≠ÊñáÂ≠óÊó∂ÊòæÁ§∫ÈÄâ‰∏≠Â≠óÁ¨¶Êï∞</li>
                            <li><strong>‰ΩçÁΩÆÁôæÂàÜÊØî</strong>ÔºöÊòæÁ§∫ÂΩìÂâçÂÖâÊ†áÂú®ÊñáÊ°£‰∏≠ÁöÑ‰ΩçÁΩÆÁôæÂàÜÊØî</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚å®Ô∏è ÈîÆÁõòÂø´Êç∑ÈîÆ</h3>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <kbd>Ctrl+N</kbd>
                            <span>Êñ∞Âª∫ÊñáÊ°£</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+O</kbd>
                            <span>ÊâìÂºÄÊñá‰ª∂</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+S</kbd>
                            <span>‰øùÂ≠òÊñá‰ª∂</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+F</kbd>
                            <span>Êü•Êâæ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+H</kbd>
                            <span>ÊõøÊç¢</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+Z</kbd>
                            <span>Êí§ÈîÄ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+Y</kbd>
                            <span>ÈáçÂÅö</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl+A</kbd>
                            <span>ÂÖ®ÈÄâ</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>F11</kbd>
                            <span>ÂÖ®Â±èÊ®°Âºè</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>ÈÄÄÂá∫ÂÖ®Â±èÊàñÂÖ≥Èó≠Èù¢Êùø</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üìÅ Êñá‰ª∂Êìç‰Ωú</h3>
                    <div class="guide-subsection">
                        <h4>‰øùÂ≠òÊñá‰ª∂</h4>
                        <ul>
                            <li><strong>Êô∫ËÉΩÊâ©Â±ïÂêç</strong>ÔºöÊ†πÊçÆÊñáÊ°£ÂÜÖÂÆπËá™Âä®Êé®ËçêÂêàÈÄÇÁöÑÊâ©Â±ïÂêçÔºàÂ¶Ç.md„ÄÅ.html„ÄÅ.txtÔºâ</li>
                            <li><strong>Â§öÁßçÊ†ºÂºèÊîØÊåÅ</strong>ÔºöÊîØÊåÅ.txt„ÄÅ.md„ÄÅ.html„ÄÅ.css„ÄÅ.js„ÄÅ.json„ÄÅ.xml„ÄÅ.csvÁ≠âÂ§öÁßçÊ†ºÂºè</li>
                            <li><strong>Âø´Êç∑Êâ©Â±ïÂêçÊåâÈíÆ</strong>Ôºö‰øùÂ≠òÊó∂ÂèØÁÇπÂáªÊâ©Â±ïÂêçÊåâÈíÆÂø´ÈÄüÈÄâÊã©Êñá‰ª∂Ê†ºÂºè</li>
                            <li><strong>Ëá™ÂÆö‰πâÊñá‰ª∂Âêç</strong>ÔºöÂèØËæìÂÖ•ÂÆåÊï¥Êñá‰ª∂ÂêçÊàñ‰ΩøÁî®ÈªòËÆ§Âª∫ËÆÆ</li>
                            <li><strong>ÂÜÖÂÆπÊ£ÄÊµã</strong>ÔºöËá™Âä®ËØÜÂà´Markdown„ÄÅHTMLÁ≠âÂÜÖÂÆπÁ±ªÂûãÂπ∂ËÆæÁΩÆÁõ∏Â∫îÁöÑMIMEÁ±ªÂûã</li>
                        </ul>
                    </div>

                    <div class="guide-subsection">
                        <h4>ÊâìÂºÄÊñá‰ª∂</h4>
                        <ul>
                            <li>ÊîØÊåÅÊâìÂºÄUTF-8ÁºñÁ†ÅÁöÑÊñáÊú¨Êñá‰ª∂</li>
                            <li>Ëá™Âä®Âä†ËΩΩÊñá‰ª∂ÂÜÖÂÆπÂà∞ÁºñËæëÂå∫Âüü</li>
                            <li>‰øùÁïôÊñá‰ª∂ÁöÑÂéüÂßãÊ†ºÂºèÂíåÁºñÁ†Å</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üí° ‰ΩøÁî®ÊäÄÂ∑ß</h3>
                    <ul>
                        <li><strong>Âø´ÈÄüÊ†ºÂºèÂåñ</strong>ÔºöÈÄâ‰∏≠ÊñáÊú¨ÂêéÔºåÁõ¥Êé•ÁÇπÂáªMarkdownÂ∑•ÂÖ∑Ê†èÊåâÈíÆËøõË°åÊ†ºÂºèÂåñ</li>
                        <li><strong>Êô∫ËÉΩÂÆö‰Ωç</strong>ÔºöÊ†ºÂºèÂåñÂêéÂÖâÊ†á‰ºöËá™Âä®ÂÆö‰ΩçÂà∞ÂêàÈÄÇ‰ΩçÁΩÆ</li>
                        <li><strong>‰∏ìÊ≥®ÂÜô‰Ωú</strong>Ôºö‰ΩøÁî®ÂÖ®Â±èÊ®°ÂºèËé∑ÂæóÊó†Âπ≤Êâ∞ÁöÑÂÜô‰ΩúÁéØÂ¢É</li>
                        <li><strong>ÂéÜÂè≤ËÆ∞ÂΩï</strong>ÔºöÁºñËæëÂô®Ëá™Âä®‰øùÂ≠òÊìç‰ΩúÂéÜÂè≤ÔºåÈò≤Ê≠¢ÊÑèÂ§ñ‰∏¢Â§±</li>
                        <li><strong>ÂÆûÊó∂ÁªüËÆ°</strong>ÔºöÁä∂ÊÄÅÊ†èÂÆûÊó∂Êõ¥Êñ∞ÊñáÊ°£ÁªüËÆ°‰ø°ÊÅØ</li>
                        <li><strong>ÁßªÂä®Á´Ø‰ºòÂåñ</strong>ÔºöÂú®ÁßªÂä®ËÆæÂ§á‰∏äÊèê‰æõÊúÄ‰Ω≥ÁöÑÁºñËæë‰ΩìÈ™å</li>
                        <li><strong>Â∫ïÈÉ®ËæπË∑ùË∞ÉËäÇ</strong>ÔºöÂèØÈÄöËøáËÆæÁΩÆ‰∏≠ÁöÑÊªëÂùóÂÆûÊó∂Ë∞ÉËäÇÁºñËæëÂå∫Â∫ïÈÉ®ËæπË∑ù</li>
                        <li><strong>ÂèñÊ∂àÁº©ËøõÂäüËÉΩ</strong>ÔºöÊîπËøõÁöÑÂèñÊ∂àÁº©ËøõÊîØÊåÅÂçïË°åÂíåÂ§öË°åÊñáÊú¨</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üîß ÊïÖÈöúÊéíÈô§</h3>
                    <div class="guide-subsection">
                        <h4>Â∏∏ËßÅÈóÆÈ¢ò</h4>
                        <ul>
                            <li><strong>Êñá‰ª∂Êó†Ê≥ï‰øùÂ≠ò</strong>ÔºöËØ∑Á°Æ‰øùÊµèËßàÂô®ÂÖÅËÆ∏‰∏ãËΩΩÊñá‰ª∂ÔºåÊ£ÄÊü•ÊòØÂê¶ÊúâÂºπÂá∫Á™óÂè£ÈòªÊ≠¢Á®ãÂ∫è</li>
                            <li><strong>‰∏≠ÊñáÊòæÁ§∫ÂºÇÂ∏∏</strong>ÔºöÁ°ÆËÆ§Êñá‰ª∂‰ª•UTF-8ÁºñÁ†Å‰øùÂ≠òÔºåËΩØ‰ª∂ÈªòËÆ§ÊîØÊåÅ‰∏≠Êñá</li>
                            <li><strong>È°µÈù¢Âä†ËΩΩÁºìÊÖ¢</strong>ÔºöÁ°Æ‰øùÁΩëÁªúËøûÊé•Ê≠£Â∏∏ÔºåÊ∏ÖÁêÜÊµèËßàÂô®ÁºìÂ≠òÂèØËÉΩÊúâÂä©‰∫éÊîπÂñÑ</li>
                            <li><strong>ËÆæÁΩÆ‰∏çÁîüÊïà</strong>ÔºöÂà∑Êñ∞È°µÈù¢‰ª•Á°Æ‰øùÊñ∞ËÆæÁΩÆÂÆåÂÖ®Âä†ËΩΩ</li>
                            <li><strong>Êü•ÊâæÂäüËÉΩÊó†Êïà</strong>ÔºöÁ°ÆËÆ§ËæìÂÖ•‰∫ÜË¶ÅÊü•ÊâæÁöÑÊñáÊú¨ÂÜÖÂÆπ</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üìã ÁâàÊú¨‰ø°ÊÅØ</h3>
                    <p><strong>ËÆ∞‰∫ãÊú¨ v0.1.2</strong></p>
                    <p>ËøôÊòØ‰∏ÄÊ¨æÁé∞‰ª£ÂåñÁöÑÁΩëÈ°µÊñáÊú¨ÁºñËæëÂô®ÔºåÊåÅÁª≠Êõ¥Êñ∞‰ª•Êèê‰æõÊõ¥Â•ΩÁöÑÁî®Êà∑‰ΩìÈ™å„ÄÇÊúÄÊñ∞Êõ¥Êñ∞ÂåÖÊã¨ÔºöÊô∫ËÉΩË°®Ê†ºÁîüÊàêÂô®„ÄÅÂÆåÊï¥Â∏ÆÂä©Á≥ªÁªü„ÄÅMarkdownÂ∑•ÂÖ∑Ê†è‰ºòÂåñ„ÄÅÂèåÂáªÈöêËóèÂäüËÉΩ‰øÆÂ§çÁ≠â„ÄÇ</p>
                    <p>ÂäüËÉΩÁâπÁÇπÔºöÂçïÊñá‰ª∂ÈÉ®ÁΩ≤„ÄÅÈõ∂‰æùËµñ„ÄÅÁ¶ªÁ∫ø‰ΩøÁî®„ÄÅÊï∞ÊçÆÊú¨Âú∞Â≠òÂÇ®„ÄÅÂìçÂ∫îÂºèËÆæËÆ°„ÄÅÂ§öËÆæÂ§áÂÖºÂÆπ„ÄÇ</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" id="helpModalOkBtn">ÊàëÁü•ÈÅì‰∫Ü</button>
            </div>
        </div>
    </div>

    <script>
        class Notepad {
            constructor() {
                this.editor = document.getElementById('editor');
                this.messageModal = document.getElementById('messageModal');
                this.currentWrapState = false;
                this.userSelectedNoExtension = false;

                // ÂàùÂßãÂåñtimeoutÂèòÈáè
                this.resizeTimeout = null;

                // Êü•ÊâæÊõøÊç¢Áä∂ÊÄÅÂèòÈáè
                this.findReplaceResults = [];
                this.findReplaceIndex = -1;

                this.initElements();
                this.initEventListeners();
                this.initTheme();
                this.initHistory();
                this.initSettings();
                this.loadPreferences();
                this.updateStats();

                // Âú®ÂÅèÂ•ΩËÆæÁΩÆÂä†ËΩΩÂêéÂàùÂßãÂåñÊó∂Èó¥ÊòæÁ§∫
                if (this.dateTimeDisplay) {
                    this.updateDateTime();
                    this.startTimeUpdate();
                }

                // Á°Æ‰øùÂú®ÊâÄÊúâÂàùÂßãÂåñÂÆåÊàêÂêéË∞ÉÊï¥ÁºñËæëÂô®Â∫ïÈÉ®ÂÜÖËæπË∑ù
                setTimeout(() => {
                    // Ë∞ÉÊï¥ÁºñËæëÂô®Â∫ïÈÉ®ÂÜÖËæπË∑ù‰ª•ÈÅøÂºÄÂõ∫ÂÆöÂÆö‰ΩçÁöÑÁä∂ÊÄÅÊ†è
                    this.adjustEditorPadding();
                }, 200);

                // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ
                window.addEventListener('resize', () => {
                    this.checkScreenSize();
                                // Á™óÂè£Â§ßÂ∞èÂèòÂåñÊó∂ÈáçÊñ∞Ë∞ÉÊï¥ÁºñËæëÂô®ÂÜÖËæπË∑ù
                    this.adjustEditorPadding();
                });
                // ÂàùÂßãÊ£ÄÊü•Â±èÂπïÂ§ßÂ∞èÔºàÂú®loadPreferencesÂêéÊâßË°åÔºâ
                setTimeout(() => this.checkScreenSize(), 0);

                // ÊÅ¢Â§çÁä∂ÊÄÅÊ†èÂèØËßÅÊÄßËÆæÁΩÆ
                this.restoreStatusBarVisibility();
            }

            initElements() {
                // Â∑•ÂÖ∑Ê†èÊåâÈíÆ
                this.newBtn = document.getElementById('newBtn');
                this.openBtn = document.getElementById('openBtn');
                this.saveBtn = document.getElementById('saveBtn');
                this.undoBtn = document.getElementById('undoBtn');
                this.redoBtn = document.getElementById('redoBtn');
                this.findBtn = document.getElementById('findBtn');
                this.themeBtn = document.getElementById('themeBtn');
                this.preferencesBtn = document.getElementById('preferencesBtn');

                // Áä∂ÊÄÅÊ†èÂÖÉÁ¥†
                this.charCount = document.getElementById('charCount');
                this.wordCount = document.getElementById('wordCount');
                this.lineCount = document.getElementById('lineCount');
                this.selectedCount = document.getElementById('selectedCount');
                this.colCount = document.getElementById('colCount');
                this.positionPercent = document.getElementById('positionPercent');
                this.dateTimeDisplay = document.getElementById('dateTimeDisplay');
                
      
                // Markdown Â∑•ÂÖ∑Ê†èÂÖÉÁ¥†
                this.markdownToolbar = document.getElementById('markdownToolbar');
                this.markdownBtns = document.querySelectorAll('.markdown-btn');

                // ËÆæÁΩÆÈù¢ÊùøÂÖÉÁ¥†
                this.statusBar = document.getElementById('statusBar');
                this.helpBtn = document.getElementById('helpBtn');
                this.removeEmptyLinesBtn = document.getElementById('removeEmptyLinesBtn');
                this.removeSpacesBtn = document.getElementById('removeSpacesBtn');
                this.removeBlankCharsBtn = document.getElementById('removeBlankCharsBtn');
                this.removeTabsBtn = document.getElementById('removeTabsBtn');
                this.normalizeLinesBtn = document.getElementById('normalizeLinesBtn');
                this.cleanAllBtn = document.getElementById('cleanAllBtn');
                this.copyAllBtn = document.getElementById('copyAllBtn');
                this.clearBtn = document.getElementById('clearBtn');

                // Êñá‰ª∂ËæìÂÖ•
                this.fileInput = document.getElementById('fileInput');

                // Êü•ÊâæÊõøÊç¢ÂºπÁ™óÂÖÉÁ¥†
                this.findReplaceModal = document.getElementById('findReplaceModal');
                this.findReplaceModalClose = document.getElementById('findReplaceModalClose');
                this.findReplaceSearchInput = document.getElementById('findReplaceSearchInput');
                this.findReplaceReplaceInput = document.getElementById('findReplaceReplaceInput');
                this.findReplaceCaseSensitive = document.getElementById('findReplaceCaseSensitive');
                this.findReplaceWholeWord = document.getElementById('findReplaceWholeWord');
                this.findReplaceFindPrevBtn = document.getElementById('findReplaceFindPrevBtn');
                this.findReplaceFindBtn = document.getElementById('findReplaceFindBtn');
                this.findReplaceReplaceBtn = document.getElementById('findReplaceReplaceBtn');
                this.findReplaceReplaceAllBtn = document.getElementById('findReplaceReplaceAllBtn');
                this.findReplaceCloseBtn = document.getElementById('findReplaceCloseBtn');

                // ÂÅèÂ•ΩËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÂÖÉÁ¥†
                this.preferencesModal = document.getElementById('preferencesModal');
                this.preferencesModalClose = document.getElementById('preferencesModalClose');
                this.showWordCount = document.getElementById('showWordCount');
                this.showCharCount = document.getElementById('showCharCount');
                this.showLineCount = document.getElementById('showLineCount');
                this.showColCount = document.getElementById('showColCount');
                this.showSelectedCount = document.getElementById('showSelectedCount');
                this.showPositionPercent = document.getElementById('showPositionPercent');
                this.showDateTime = document.getElementById('showDateTime');
                this.markdownMode = document.getElementById('markdownMode');
                this.autoWordWrap = document.getElementById('autoWordWrap');
                this.enableFullscreen = document.getElementById('enableFullscreen');
                this.showGrid = document.getElementById('showGrid');
                this.bottomMarginSlider = document.getElementById('bottomMarginSlider');
                this.bottomMarginValue = document.getElementById('bottomMarginValue');
                
        
                // Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†
                this.modalTitle = document.getElementById('modalTitle');
                this.modalMessage = document.getElementById('modalMessage');
                this.modalClose = document.getElementById('modalClose');
                this.modalOkBtn = document.getElementById('modalOkBtn');

                // ‰øùÂ≠òÊ®°ÊÄÅÊ°ÜÂÖÉÁ¥†
                this.saveModal = document.getElementById('saveModal');
                this.saveModalClose = document.getElementById('saveModalClose');
                this.saveModalCancelBtn = document.getElementById('saveModalCancelBtn');
                this.saveModalConfirmBtn = document.getElementById('saveModalConfirmBtn');
                this.fileNameInput = document.getElementById('fileNameInput');

                // Â∏ÆÂä©Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†
                this.helpModal = document.getElementById('helpModal');
                this.helpModalClose = document.getElementById('helpModalClose');
                this.helpModalOkBtn = document.getElementById('helpModalOkBtn');

                // EmojiÈÄâÊã©Âô®Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†
                this.emojiModal = document.getElementById('emojiModal');
                this.emojiModalClose = document.getElementById('emojiModalClose');
                this.emojiSearchInput = document.getElementById('emojiSearchInput');
                this.emojiGrid = document.getElementById('emojiGrid');
                this.emojiRecentGrid = document.getElementById('emojiRecentGrid');
            }

            initEventListeners() {
                // Â∑•ÂÖ∑Ê†è‰∫ã‰ª∂
                if (this.newBtn) this.newBtn.addEventListener('click', () => this.newDocument());
                if (this.openBtn) this.openBtn.addEventListener('click', () => this.openFile());
                if (this.saveBtn) this.saveBtn.addEventListener('click', () => this.saveFile());
                if (this.undoBtn) this.undoBtn.addEventListener('click', () => this.undo());
                if (this.redoBtn) this.redoBtn.addEventListener('click', () => this.redo());
                if (this.findBtn) this.findBtn.addEventListener('click', () => this.showFindReplaceModal());
                if (this.themeBtn) this.themeBtn.addEventListener('click', () => this.toggleTheme());
                if (this.preferencesBtn) this.preferencesBtn.addEventListener('click', () => this.openPreferences());

                // Â∏ÆÂä©ÊåâÈíÆ‰∫ã‰ª∂
                const helpBtn = document.getElementById('helpBtn');
                if (helpBtn) helpBtn.addEventListener('click', () => this.showHelpModal());

                // Markdown Â∑•ÂÖ∑Ê†è‰∫ã‰ª∂
                if (this.markdownBtns) {
                    this.markdownBtns.forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const action = e.currentTarget.dataset.action;
                            this.handleMarkdownAction(action);
                        });
                    });
                }

                // Ë°®Ê†ºÂØπËØùÊ°Ü‰∫ã‰ª∂
                const tableModalClose = document.getElementById('tableModalClose');
                const tableModalCancel = document.getElementById('tableModalCancel');
                const tableModalConfirm = document.getElementById('tableModalConfirm');
                const tableRows = document.getElementById('tableRows');
                const tableCols = document.getElementById('tableCols');
                const tableHeader = document.getElementById('tableHeader');

                if (tableModalClose) {
                    tableModalClose.addEventListener('click', () => this.hideTableModal());
                }

                if (tableModalCancel) {
                    tableModalCancel.addEventListener('click', () => this.hideTableModal());
                }

                if (tableModalConfirm) {
                    tableModalConfirm.addEventListener('click', () => this.insertTableFromModal());
                }

                // Â∏ÆÂä©Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                const helpModalClose = document.getElementById('helpModalClose');
                const helpModalOkBtn = document.getElementById('helpModalOkBtn');
                const helpModal = document.getElementById('helpModal');

                if (helpModalClose) {
                    helpModalClose.addEventListener('click', () => this.hideHelpModal());
                }

                if (helpModalOkBtn) {
                    helpModalOkBtn.addEventListener('click', () => this.hideHelpModal());
                }

                if (helpModal) {
                    helpModal.addEventListener('click', (e) => {
                        if (e.target === helpModal) {
                            this.hideHelpModal();
                        }
                    });
                }

                // ËæìÂÖ•Ê°ÜÂèòÂåñÊó∂Êõ¥Êñ∞È¢ÑËßà
                if (tableRows) {
                    tableRows.addEventListener('input', () => this.updateTablePreview());
                }

                if (tableCols) {
                    tableCols.addEventListener('input', () => this.updateTablePreview());
                }

                if (tableHeader) {
                    tableHeader.addEventListener('change', () => this.updateTablePreview());
                }

                // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
                const tableModal = document.getElementById('tableModal');
                if (tableModal) {
                    tableModal.addEventListener('click', (e) => {
                        if (e.target === tableModal) {
                            this.hideTableModal();
                        }
                    });
                }

                // ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const tableModal = document.getElementById('tableModal');
                        const helpModal = document.getElementById('helpModal');

                        if (tableModal && tableModal.classList.contains('active')) {
                            this.hideTableModal();
                        }
                        if (helpModal && helpModal.classList.contains('active')) {
                            this.hideHelpModal();
                        }
                    }
                });

                // EnterÈîÆÁ°ÆËÆ§ÊèíÂÖ•ÔºàÁÑ¶ÁÇπÂú®ËæìÂÖ•Ê°ÜÊó∂Ôºâ
                if (tableRows && tableCols) {
                    [tableRows, tableCols].forEach(input => {
                        input.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                this.insertTableFromModal();
                            }
                        });
                    });
                }

                // ÁºñËæëÂô®‰∫ã‰ª∂
                if (this.editor) {
                    this.editor.addEventListener('input', () => {
                        this.updateStats();
                        this.updateSelectedCount();
                        this.updateColumnPosition();
                        this.updateCursorPosition();
                        this.saveHistory();

                                          });

                    this.editor.addEventListener('click', () => {
                        this.updateColumnPosition();
                        this.updateSelectedCount();
                        this.updateCursorPosition();
                    });

                    this.editor.addEventListener('keyup', () => {
                        this.updateColumnPosition();
                        this.updateSelectedCount();
                        this.updateCursorPosition();
                    });

                    this.editor.addEventListener('selectstart', () => {
                        this.updateSelectedCount();
                    });

                    this.editor.addEventListener('scroll', () => {
                        // ÂêåÊ≠•ÊªöÂä®ÔºàÂ¶ÇÊûúÊúâË°åÂè∑ÊòæÁ§∫Ôºâ
                    });
                }

                // Áä∂ÊÄÅÊ†èÂèåÂáªÂàáÊç¢ÊòæÁ§∫/ÈöêËóèÂäüËÉΩ
                const statusItems = [
                    'charCount', 'wordCount', 'lineCount', 'selectedCount',
                    'colCount', 'positionPercent', 'dateTimeDisplay'
                ];

                statusItems.forEach(itemId => {
                    const element = document.getElementById(itemId);
                    if (element) {
                        element.addEventListener('dblclick', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            this.hideStatusItem(element);
                        });

                        // Ê∑ªÂä†Ê†∑ÂºèÊèêÁ§∫Áî®Êà∑ÂèØ‰ª•ÂèåÂáªÈöêËóè
                        element.style.cursor = 'pointer';
                        element.title = element.title || 'ÂèåÂáªÈöêËóèÊ≠§È°πÁõÆ';
                    }
                });

                // ÂÖ®Â±ÄÈÄâÊã©ÂèòÂåñ‰∫ã‰ª∂
                document.addEventListener('selectionchange', () => {
                    if (document.activeElement === this.editor) {
                        this.updateSelectedCount();
                    }
                });


                // Â∏ÆÂä©ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂ - ÊòæÁ§∫Â∏ÆÂä©
                if (this.helpBtn) this.helpBtn.addEventListener('click', () => this.showHelpModal());

                // ËÆæÁΩÆÈù¢Êùø‰∫ã‰ª∂ - ÁßªÈô§‰∫ÜÊü•ÊâæÊõøÊç¢‰∫ã‰ª∂ÔºåÂõ†‰∏∫Áé∞Âú®‰ΩøÁî®ÂºπÁ™ó

                // Êñá‰ª∂‰∫ã‰ª∂
                if (this.fileInput) this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));

                // Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                if (this.modalClose) this.modalClose.addEventListener('click', () => this.hideModal());
                if (this.modalOkBtn) this.modalOkBtn.addEventListener('click', () => this.hideModal());
                if (this.messageModal) this.messageModal.addEventListener('click', (e) => {
                    if (e.target === this.messageModal) this.hideModal();
                });

                // ‰øùÂ≠òÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                if (this.saveModalClose) this.saveModalClose.addEventListener('click', () => this.hideSaveModal());
                if (this.saveModalCancelBtn) this.saveModalCancelBtn.addEventListener('click', () => this.hideSaveModal());
                if (this.saveModalConfirmBtn) this.saveModalConfirmBtn.addEventListener('click', () => this.confirmSave());
                if (this.saveModal) this.saveModal.addEventListener('click', (e) => {
                    if (e.target === this.saveModal) this.hideSaveModal();
                });

                // Ê∑ªÂä†ÈîÆÁõòESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (this.messageModal && this.messageModal.classList.contains('show')) {
                            this.hideModal();
                        } else if (this.saveModal && this.saveModal.classList.contains('show')) {
                            this.hideSaveModal();
                        } else if (this.findReplaceModal && this.findReplaceModal.classList.contains('show')) {
                            this.hideFindReplaceModal();
                        } else if (this.preferencesModal && this.preferencesModal.classList.contains('show')) {
                            this.hidePreferencesModal();
                        } else if (this.helpModal && this.helpModal.classList.contains('show')) {
                            this.hideHelpModal();
                        } else if (this.emojiModal && this.emojiModal.classList.contains('show')) {
                            this.hideEmojiModal();
                        }
                    }
                });

                // Êâ©Â±ïÂêçÊåâÈíÆ‰∫ã‰ª∂
                if (this.fileNameInput) {
                    document.querySelectorAll('.extension-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const extension = e.currentTarget.dataset.ext;
                            const currentFileName = this.fileNameInput.value.trim();

                            // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
                            document.querySelectorAll('.extension-btn').forEach(b => b.classList.remove('active'));

                            // ÁßªÈô§Áé∞ÊúâÊâ©Â±ïÂêç
                            let baseName = currentFileName;
                            const lastDotIndex = baseName.lastIndexOf('.');
                            if (lastDotIndex > 0) {
                                baseName = baseName.substring(0, lastDotIndex);
                            }

                            // Ê∑ªÂä†Êñ∞Êâ©Â±ïÂêç
                            if (extension) {
                                this.fileNameInput.value = baseName + extension;
                                this.userSelectedNoExtension = false;
                                // ‰∏∫ÂΩìÂâçÊåâÈíÆÊ∑ªÂä†Ê¥ªÂä®Áä∂ÊÄÅ
                                e.currentTarget.classList.add('active');
                            } else {
                                this.fileNameInput.value = baseName;
                                this.userSelectedNoExtension = true; // Áî®Êà∑ÊòéÁ°ÆÈÄâÊã©Êó†Êâ©Â±ïÂêç
                                // ‰∏∫Êó†Êâ©Â±ïÂêçÊåâÈíÆÊ∑ªÂä†ÁâπÊÆäÊ¥ªÂä®Áä∂ÊÄÅ
                                e.currentTarget.classList.add('active');
                            }

                            // ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
                            this.fileNameInput.focus();
                        });
                    });

                    // Êñá‰ª∂ÂêçËæìÂÖ•Êó∂Êô∫ËÉΩÊõ¥Êñ∞Êó†Êâ©Â±ïÂêçÈÄâÊã©Áä∂ÊÄÅ
                    this.fileNameInput.addEventListener('input', () => {
                        const currentFileName = this.fileNameInput.value.trim();

                        // Êõ¥Êñ∞Êâ©Â±ïÂêçÊåâÈíÆÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
                        document.querySelectorAll('.extension-btn').forEach(btn => {
                            btn.classList.remove('active');
                            const extension = btn.dataset.ext;

                            if (extension) {
                                // Ê£ÄÊü•ÂΩìÂâçÊñá‰ª∂ÂêçÊòØÂê¶‰ª•Ê≠§Êâ©Â±ïÂêçÁªìÂ∞æ
                                if (currentFileName.toLowerCase().endsWith(extension.toLowerCase())) {
                                    btn.classList.add('active');
                                }
                            } else {
                                // Êó†Êâ©Â±ïÂêçÊåâÈíÆ
                                if (!currentFileName.includes('.') && currentFileName.length > 0) {
                                    btn.classList.add('active');
                                    this.userSelectedNoExtension = true;
                                }
                            }
                        });

                        // Â¶ÇÊûúÁî®Êà∑ÁÇπÂáª‰∫Ü"Êó†Êâ©Â±ïÂêç"ÊåâÈíÆÔºå‰∏çË¶ÅÊîπÂèòÁä∂ÊÄÅ
                        if (this.userSelectedNoExtension === true) {
                            // Â¶ÇÊûúÁî®Êà∑ÊâãÂä®ËæìÂÖ•‰∫ÜÊâ©Â±ïÂêçÔºåÂàôÊõ¥Êñ∞Áä∂ÊÄÅ
                            if (currentFileName.includes('.')) {
                                this.userSelectedNoExtension = false;
                            }
                            return;
                        }

                        // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÊâãÂä®Âà†Èô§‰∫ÜÊâ©Â±ïÂêç
                        // Â¶ÇÊûúÊñá‰ª∂Âêç‰ª•ÁÇπÁªìÂ∞æÔºåËØ¥ÊòéÁî®Êà∑Ê≠£Âú®ËæìÂÖ•ÊàñÂà†Èô§Êâ©Â±ïÂêçÔºå‰øùÊåÅÊó†Êâ©Â±ïÂêçÁä∂ÊÄÅ
                        if (currentFileName.endsWith('.')) {
                            return; // ‰øùÊåÅÂΩìÂâçÁä∂ÊÄÅ
                        }

                        const hasExtension = currentFileName.includes('.');

                        // Â¶ÇÊûúÁî®Êà∑ËæìÂÖ•ÁöÑÊñá‰ª∂ÂêçÊ≤°ÊúâÊâ©Â±ïÂêç‰∏îÈïøÂ∫¶>0ÔºåÂèØËÉΩÊÉ≥Ë¶ÅÊó†Êâ©Â±ïÂêç
                        // ‰ΩÜ‰∏çÁ´ãÂç≥ËÆæÁΩÆÁä∂ÊÄÅÔºåËÆ©Áî®Êà∑ÈÄöËøáÊåâÈíÆÊòéÁ°ÆÈÄâÊã©
                        if (!hasExtension && currentFileName.length > 0) {
                            // ‰∏çËá™Âä®ËÆæÁΩÆÔºåÁ≠âÂæÖÁî®Êà∑ÊòéÁ°ÆÈÄâÊã©
                            return;
                        } else if (hasExtension) {
                            this.userSelectedNoExtension = false;
                        }
                    });

                    // ÂõûËΩ¶ÈîÆÁ°ÆËÆ§‰øùÂ≠ò
                    this.fileNameInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.confirmSave();
                        }
                    });
                }

                // ÂÅèÂ•ΩËÆæÁΩÆÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                if (this.preferencesModalClose) this.preferencesModalClose.addEventListener('click', () => this.hidePreferencesModal());
                if (this.preferencesModal) this.preferencesModal.addEventListener('click', (e) => {
                    if (e.target === this.preferencesModal) this.hidePreferencesModal();
                });

                // Êü•ÊâæÊõøÊç¢ÂºπÁ™ó‰∫ã‰ª∂
                if (this.findReplaceModalClose) this.findReplaceModalClose.addEventListener('click', () => this.hideFindReplaceModal());
                if (this.findReplaceCloseBtn) this.findReplaceCloseBtn.addEventListener('click', () => this.hideFindReplaceModal());
                if (this.findReplaceModal) this.findReplaceModal.addEventListener('click', (e) => {
                    if (e.target === this.findReplaceModal) this.hideFindReplaceModal();
                });

                // Êü•ÊâæÊõøÊç¢ÂäüËÉΩ‰∫ã‰ª∂
                if (this.findReplaceFindPrevBtn) this.findReplaceFindPrevBtn.addEventListener('click', () => this.findReplaceFindPrev());
                if (this.findReplaceFindBtn) this.findReplaceFindBtn.addEventListener('click', () => this.findReplaceFind());
                if (this.findReplaceReplaceBtn) this.findReplaceReplaceBtn.addEventListener('click', () => this.findReplaceReplace());
                if (this.findReplaceReplaceAllBtn) this.findReplaceReplaceAllBtn.addEventListener('click', () => this.findReplaceReplaceAll());

                // ÊñáÊú¨Ê∏ÖÁêÜÂäüËÉΩ‰∫ã‰ª∂ÔºàÂºπÁ™ó‰∏≠ÁöÑÊåâÈíÆÔºâ
                const copyAllBtn = document.getElementById('copyAllBtn');
                const clearBtn = document.getElementById('clearBtn');
                const removeEmptyLinesBtn = document.getElementById('removeEmptyLinesBtn');
                const removeSpacesBtn = document.getElementById('removeSpacesBtn');
                const removeBlankCharsBtn = document.getElementById('removeBlankCharsBtn');
                const removeTabsBtn = document.getElementById('removeTabsBtn');
                const normalizeLinesBtn = document.getElementById('normalizeLinesBtn');
                const cleanAllBtn = document.getElementById('cleanAllBtn');
                
                if (copyAllBtn) copyAllBtn.addEventListener('click', () => this.copyAll());
                if (clearBtn) clearBtn.addEventListener('click', () => this.clearDocument());
                if (removeEmptyLinesBtn) removeEmptyLinesBtn.addEventListener('click', () => this.removeEmptyLines());
                if (removeSpacesBtn) removeSpacesBtn.addEventListener('click', () => this.removeSpaces());
                if (removeBlankCharsBtn) removeBlankCharsBtn.addEventListener('click', () => this.removeBlankChars());
                if (removeTabsBtn) removeTabsBtn.addEventListener('click', () => this.removeTabs());
                if (normalizeLinesBtn) normalizeLinesBtn.addEventListener('click', () => this.normalizeLines());
                if (cleanAllBtn) cleanAllBtn.addEventListener('click', () => this.cleanAll());

                // ÂõûËΩ¶ÈîÆÊü•ÊâæÔºåShift+ÂõûËΩ¶ÊõøÊç¢
                if (this.findReplaceSearchInput) this.findReplaceSearchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (e.shiftKey) {
                            this.findReplaceReplace();
                        } else {
                            this.findReplaceFind();
                        }
                    }
                });

                // ÁõëÂê¨Êü•ÊâæÂÜÖÂÆπÂèòÂåñÔºåÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅ
                if (this.findReplaceSearchInput) this.findReplaceSearchInput.addEventListener('input', (e) => {
                    // ÂΩìÊü•ÊâæÂÜÖÂÆπÂèëÁîüÂèòÂåñÊó∂ÔºåÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅÂíåÁºìÂ≠ò
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    this.lastSearchText = null;
                    this.lastTextLength = null;
                    this.lastSearchOptions = null;
                    this.hasShownFirstResult = false;
                });

                // ÁõëÂê¨Êü•ÊâæÈÄâÈ°πÂèòÂåñÔºåÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅ
                if (this.findReplaceCaseSensitive) this.findReplaceCaseSensitive.addEventListener('change', (e) => {
                    // ÂΩìÊü•ÊâæÈÄâÈ°πÂèëÁîüÂèòÂåñÊó∂ÔºåÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅÂíåÁºìÂ≠ò
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    this.lastSearchText = null;
                    this.lastTextLength = null;
                    this.lastSearchOptions = null;
                    this.hasShownFirstResult = false;
                });

                if (this.findReplaceWholeWord) this.findReplaceWholeWord.addEventListener('change', (e) => {
                    // ÂΩìÊü•ÊâæÈÄâÈ°πÂèëÁîüÂèòÂåñÊó∂ÔºåÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅÂíåÁºìÂ≠ò
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    this.lastSearchText = null;
                    this.lastTextLength = null;
                    this.lastSearchOptions = null;
                    this.hasShownFirstResult = false;
                });

                if (this.findReplaceReplaceInput) this.findReplaceReplaceInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.findReplaceReplace();
                    }
                });

                // Â∏ÆÂä©Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                if (this.helpModalClose) this.helpModalClose.addEventListener('click', () => this.hideHelpModal());
                if (this.helpModalOkBtn) this.helpModalOkBtn.addEventListener('click', () => this.hideHelpModal());
                if (this.helpModal) this.helpModal.addEventListener('click', (e) => {
                    if (e.target === this.helpModal) this.hideHelpModal();
                });

                // EmojiÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                if (this.emojiModalClose) this.emojiModalClose.addEventListener('click', () => this.hideEmojiModal());
                if (this.emojiModal) this.emojiModal.addEventListener('click', (e) => {
                    if (e.target === this.emojiModal) this.hideEmojiModal();
                });

                // EmojiÊêúÁ¥¢ÂäüËÉΩ
                if (this.emojiSearchInput) {
                    this.emojiSearchInput.addEventListener('input', (e) => this.searchEmojis(e.target.value));
                }

                // EmojiÂàÜÁ±ªÂàáÊç¢
                document.querySelectorAll('.emoji-category').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const category = e.currentTarget.dataset.category;
                        this.switchEmojiCategory(category);
                    });
                });

                // ÈîÆÁõòÂø´Êç∑ÈîÆ
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key.toLowerCase()) {
                            case 'n': if (this.newDocument) { e.preventDefault(); this.newDocument(); } break;
                            case 'o': if (this.openFile) { e.preventDefault(); this.openFile(); } break;
                            case 's': if (this.saveFile) { e.preventDefault(); this.saveFile(); } break;
                            case 'f': if (this.showFindReplaceModal) { e.preventDefault(); this.showFindReplaceModal(); } break;
                            case 'h': if (this.showFindReplaceModal) { 
                                e.preventDefault(); 
                                this.showFindReplaceModal(); 
                                setTimeout(() => {
                                    if (this.findReplaceReplaceInput) this.findReplaceReplaceInput.focus(); 
                                }, 100); 
                            } break;
                            case 'z': if (this.undo) { e.preventDefault(); this.undo(); } break;
                            case 'y': if (this.redo) { e.preventDefault(); this.redo(); } break;
                            case 'a': if (this.editor) { e.preventDefault(); this.editor.select(); } break;
                        }
                    }

                    // F11 ÈîÆÂàáÊç¢ÂÖ®Â±èÔºà‰ªÖÂú®ÂêØÁî®Êó∂Ôºâ
                    if (e.key === 'F11' && this.toggleFullscreen) {
                        const fullscreenEnabled = this.enableFullscreen && this.enableFullscreen.checked;
                        if (fullscreenEnabled) {
                            e.preventDefault();
                            this.toggleFullscreen();
                        }
                    }

                    // F3 / Shift+F3 ÈîÆÊü•Êâæ
                    if (e.key === 'F3') {
                        if (this.findReplaceModal && this.findReplaceModal.classList.contains('show')) {
                            if (e.shiftKey) {
                                // Shift+F3 Êü•Êâæ‰∏ä‰∏Ä‰∏™
                                this.findReplaceFindPrev();
                            } else {
                                // F3 Êü•Êâæ‰∏ã‰∏Ä‰∏™
                                this.findReplaceFind();
                            }
                        }
                        e.preventDefault();
                    }

                    // ESC ÈîÆÂÖ≥Èó≠ÂºπÁ™óÂíåÈÄÄÂá∫ÂÖ®Â±è
                    if (e.key === 'Escape') {
                        if (this.findReplaceModal && this.findReplaceModal.classList.contains('show')) {
                            this.hideFindReplaceModal();
                        } else if (this.messageModal && this.messageModal.classList.contains('show')) {
                            this.hideModal();
                        } else if (this.preferencesModal && this.preferencesModal.classList.contains('show')) {
                            this.hidePreferencesModal();
                        } else if (this.helpModal && this.helpModal.classList.contains('show')) {
                            this.hideHelpModal();
                        } else if (this.saveModal && this.saveModal.classList.contains('show')) {
                            this.hideSaveModal();
                        } else if (this.emojiModal && this.emojiModal.classList.contains('show')) {
                            this.hideEmojiModal();
                        }
                        // Âú®ÂÖ®Â±èÊ®°Âºè‰∏ãÔºåESC ‰πüÂèØ‰ª•ÈÄÄÂá∫ÂÖ®Â±è
                        if (this.toggleFullscreen) {
                            const fullscreenEnabled = this.enableFullscreen && this.enableFullscreen.checked;
                            if (fullscreenEnabled && (document.fullscreenElement || document.body.classList.contains('fullscreen'))) {
                                this.toggleFullscreen();
                            }
                        }
                    }
                });

                // ÁõëÂê¨ÂÖ®Â±èÁä∂ÊÄÅÂèòÂåñ
                document.addEventListener('fullscreenchange', () => {
                    const isFullscreen = !!document.fullscreenElement;
                    if (!isFullscreen && this.body) {
                        document.body.classList.remove('fullscreen');
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = false;
                        }
                    } else if (isFullscreen) {
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = true;
                        }
                    }
                });

                // ÁõëÂê¨ÂÖ®Â±èÈîôËØØ
                document.addEventListener('fullscreenerror', (e) => {
                    console.warn('ÂÖ®Â±èÊìç‰ΩúÂá∫Èîô:', e);
                });

                // ËÆæÁΩÆÈ°πÂÆûÊó∂‰øùÂ≠òÂíåÁîüÊïà
                console.log('üéß Adding preference listeners');
                if (this.addPreferenceListeners) this.addPreferenceListeners();

                // Èò≤Ê≠¢È°µÈù¢Âà∑Êñ∞Êó∂‰∏¢Â§±Êï∞ÊçÆ
                window.addEventListener('beforeunload', (e) => {
                    if (this.editor && this.editor.value.trim()) {
                        e.preventDefault();
                        e.returnValue = '';
                    }
                });
            }

            initTheme() {
                const savedTheme = localStorage.getItem('notepad-theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                this.updateThemeIcon();
            }

            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('notepad-theme', newTheme);
                this.updateThemeIcon();
            }

            updateThemeIcon() {
                const theme = document.documentElement.getAttribute('data-theme');
                const isDark = theme === 'dark';

                this.themeBtn.innerHTML = isDark ?
                    `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg><span>‰∏ªÈ¢ò</span>` :
                    `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg><span>‰∏ªÈ¢ò</span>`;
            }

            initHistory() {
                this.history = [''];
                this.historyIndex = 0;
                this.maxHistorySize = 50;
                this.updateHistoryButtons();
            }

            saveHistory() {
                const currentValue = this.editor.value;

                if (this.history[this.historyIndex] !== currentValue) {
                    this.history = this.history.slice(0, this.historyIndex + 1);
                    this.history.push(currentValue);

                    if (this.history.length > this.maxHistorySize) {
                        this.history.shift();
                    } else {
                        this.historyIndex++;
                    }
                }

                this.updateHistoryButtons();
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.editor.value = this.history[this.historyIndex];
                    this.updateStats();
                    this.updateHistoryButtons();
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.editor.value = this.history[this.historyIndex];
                    this.updateStats();
                    this.updateHistoryButtons();
                }
            }

            updateHistoryButtons() {
                this.undoBtn.style.opacity = this.historyIndex > 0 ? '1' : '0.5';
                this.redoBtn.style.opacity = this.historyIndex < this.history.length - 1 ? '1' : '0.5';
            }

            initSettings() {
                const wordWrap = localStorage.getItem('notepad-word-wrap') === 'true';

                // ËÆæÁΩÆÂõæÊ†áÊñπÂêë
                // this.toggleIcon.style.transform = collapsed ? 'rotate(0deg)' : 'rotate(180deg)'; // Removed as element no longer exists

                this.editor.style.whiteSpace = wordWrap ? 'pre-wrap' : 'pre';
            }

            // toggleSettings functionality removed as settings panel no longer exists
            // toggleSettingsPosition functionality removed as settings panel no longer exists

          
            toggleWordWrap() {
                const currentState = this.editor.style.whiteSpace === 'pre-wrap';
                const newState = !currentState;

                if (newState) {
                    this.editor.style.whiteSpace = 'pre-wrap';
                    this.editor.style.wordWrap = 'break-word';
                    this.editor.style.overflowWrap = 'break-word';
                } else {
                    this.editor.style.whiteSpace = 'pre';
                    this.editor.style.wordWrap = 'normal';
                    this.editor.style.overflowWrap = 'normal';
                }

                localStorage.setItem('notepad-word-wrap', newState);
                // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                if (this.autoWordWrap) {
                    this.autoWordWrap.checked = newState;
                }
                this.showMessage('Ëá™Âä®Êç¢Ë°å', newState ? 'Â∑≤ÂêØÁî®Ëá™Âä®Êç¢Ë°å' : 'Â∑≤Á¶ÅÁî®Ëá™Âä®Êç¢Ë°å');
            }

            updateStats() {
                const text = this.editor.value;
                const charCount = text.length;

                // ÊîπËøõÁöÑËØçÊï∞ÁªüËÆ°ÔºöÁªüËÆ°Ëã±ÊñáÂçïËØçÂíå‰∏≠ÊñáÂ≠óÁ¨¶
                let wordCount = 0;
                if (text.trim()) {
                    // ÁªüËÆ°Ëã±ÊñáÂçïËØçÔºàËøûÁª≠ÁöÑÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅÈÉ®ÂàÜÊ†áÁÇπÔºâ
                    const englishWords = text.match(/\b\w+(?:'\w+)?\b/g) || [];
                    wordCount += englishWords.length;

                    // ÁªüËÆ°‰∏≠ÊñáÂ≠óÁ¨¶ÔºàÂåÖÊã¨Ê±âÂ≠ó„ÄÅ‰∏≠ÊñáÊ†áÁÇπÔºâ
                    const chineseChars = text.match(/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/g) || [];
                    wordCount += chineseChars.length;
                }

                const lineCount = text ? text.split('\n').length : 0;

                this.charCount.textContent = `${charCount} Â≠ó`;
                this.wordCount.textContent = `${wordCount} ËØç`;
                this.lineCount.textContent = `${lineCount} Ë°å`;

                this.updateSelectedCount();
            }

            updateColumnPosition() {
                const cursorPos = this.editor.selectionStart;
                const text = this.editor.value;
                const textBeforeCursor = text.substring(0, cursorPos);

                // ËÆ°ÁÆóË°åÂè∑Ôºà1-basedÔºâ
                const lines = textBeforeCursor.split('\n');
                const line = lines.length;

                // ËÆ°ÁÆóÂàóÂè∑Ôºà1-basedÔºâ
                const column = lines[lines.length - 1].length + 1;

                this.colCount.textContent = `${line}|${column}`;
            }

            updateSelectedCount() {
                const selectionStart = this.editor.selectionStart;
                const selectionEnd = this.editor.selectionEnd;
                const selectedText = this.editor.value.substring(selectionStart, selectionEnd);
                const selectedLength = selectedText.length;

                // Ê£ÄÊü•ËÆæÁΩÆËèúÂçï‰∏≠ÊòØÂê¶ÂêØÁî®‰∫ÜÈÄâ‰∏≠Â≠óÁ¨¶ÁªüËÆ°
                const showSelectedCountEnabled = this.showSelectedCount && this.showSelectedCount.checked !== false;
                
                if (selectedLength > 0 && showSelectedCountEnabled) {
                    this.selectedCount.textContent = `Â∑≤ÈÄâ ${selectedLength} Â≠óÁ¨¶`;
                    this.selectedCount.classList.remove('hidden');
                } else {
                    this.selectedCount.classList.add('hidden');
                }

                this.updateCursorPosition();
            }

            updateCursorPosition() {
                const cursorPos = this.editor.selectionStart;
                const totalLength = this.editor.value.length;

                if (totalLength === 0) {
                    this.positionPercent.textContent = '0%';
                    return;
                }

                const percentage = Math.round((cursorPos / totalLength) * 100);
                this.positionPercent.textContent = `${percentage}%`;
            }

            newDocument() {
                if (this.editor.value.trim()) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂàõÂª∫Êñ∞ÊñáÊ°£ÂêóÔºüÊú™‰øùÂ≠òÁöÑÊõ¥ÊîπÂ∞Ü‰∏¢Â§±„ÄÇ')) {
                        this.editor.value = '';
                        this.updateStats();
                        this.saveHistory();
                    }
                } else {
                    this.editor.value = '';
                    this.updateStats();
                    this.saveHistory();
                }
            }

            openFile() {
                this.fileInput.click();
            }

            saveFile() {
                this.showSaveModal();
            }

            showSaveModal() {
                const text = this.editor.value.trim();
                let defaultName = 'document';

                // Ê£ÄÊµãÂÜÖÂÆπÁ±ªÂûãÊù•Êèê‰æõÊô∫ËÉΩÈªòËÆ§Êñá‰ª∂Âêç
                if (text.startsWith('#') || text.includes('**') || text.includes('```')) {
                    defaultName = 'document.md'; // MarkdownÂÜÖÂÆπ
                } else if (text.includes('<!DOCTYPE') || text.includes('<html')) {
                    defaultName = 'index.html'; // HTMLÂÜÖÂÆπ
                } else if (text.includes('{') && text.includes('}')) {
                    defaultName = 'data.json'; // JSONÂÜÖÂÆπ
                } else if (text.includes('body {') || text.includes('/*')) {
                    defaultName = 'style.css'; // CSSÂÜÖÂÆπ
                } else {
                    defaultName = 'document.txt'; // ÈªòËÆ§ÊñáÊú¨Êñá‰ª∂
                }

                // ÈáçÁΩÆÊó†Êâ©Â±ïÂêçÈÄâÊã©Áä∂ÊÄÅÔºà‰ªÖÂú®Êú™ÊòéÁ°ÆÈÄâÊã©Êó∂Ôºâ
                if (typeof this.userSelectedNoExtension === 'undefined') {
                    this.userSelectedNoExtension = false;
                }

                this.fileNameInput.value = defaultName;
                this.fileNameInput.focus();
                // ÈÄâ‰∏≠Êñá‰ª∂ÂêçÔºà‰∏çÂåÖÊã¨Êâ©Â±ïÂêçÔºâÊñπ‰æøÁî®Êà∑‰øÆÊîπ
                const lastDotIndex = defaultName.lastIndexOf('.');
                if (lastDotIndex > 0) {
                    this.fileNameInput.setSelectionRange(0, lastDotIndex);
                }

                // ÂàùÂßãÂåñÊâ©Â±ïÂêçÊåâÈíÆÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
                setTimeout(() => {
                    document.querySelectorAll('.extension-btn').forEach(btn => {
                        btn.classList.remove('active');
                        const extension = btn.dataset.ext;

                        if (extension && defaultName.toLowerCase().endsWith(extension.toLowerCase())) {
                            btn.classList.add('active');
                        }
                    });
                }, 10);

                this.saveModal.classList.add('show');
            }

            hideSaveModal() {
                this.saveModal.classList.remove('show');
            }

            confirmSave() {
                const fileName = this.fileNameInput.value.trim();
                if (!fileName) {
                    this.showMessage('ÊèêÁ§∫', 'ËØ∑ËæìÂÖ•Êñá‰ª∂Âêç');
                    return;
                }

                const text = this.editor.value;

                // Ê∏ÖÁêÜÊñá‰ª∂ÂêçÔºåÁßªÈô§‰∏çÂÆâÂÖ®Â≠óÁ¨¶Ôºå‰øùÁïôÁî®Êà∑ËæìÂÖ•ÁöÑÂÆåÊï¥Ê†ºÂºè
                let cleanFileName = fileName.replace(/[<>:"/\\|?*]/g, '_').replace(/\s+/g, '_');

                // ‰∏çÊ∑ªÂä†‰ªª‰ΩïËá™Âä®ÈÄªËæëÔºåÁî®Êà∑ËæìÂÖ•‰ªÄ‰πàÂ∞±‰øùÂ≠ò‰ªÄ‰πà

                // Ê†πÊçÆÊâ©Â±ïÂêçËÆæÁΩÆMIMEÁ±ªÂûã
                let mimeType = 'application/octet-stream'; // ÈªòËÆ§‰ΩøÁî®‰∫åËøõÂà∂ÊµÅÁ±ªÂûãÔºåÈÅøÂÖçÊµèËßàÂô®Ëá™Âä®Ê∑ªÂä†Êâ©Â±ïÂêç
                const lastDotIndex = cleanFileName.lastIndexOf('.');
                const extension = lastDotIndex > 0 ? cleanFileName.substring(lastDotIndex).toLowerCase() : '';

                if (extension) {
                    // Âè™ÊúâÂΩìÊñá‰ª∂ÊúâÊâ©Â±ïÂêçÊó∂ÊâçËÆæÁΩÆÂÖ∑‰ΩìÁöÑMIMEÁ±ªÂûã
                    switch (extension) {
                        case '.html':
                        case '.htm':
                            mimeType = 'text/html;charset=utf-8';
                            break;
                        case '.css':
                            mimeType = 'text/css;charset=utf-8';
                            break;
                        case '.js':
                            mimeType = 'application/javascript;charset=utf-8';
                            break;
                        case '.json':
                            mimeType = 'application/json;charset=utf-8';
                            break;
                        case '.md':
                        case '.markdown':
                            mimeType = 'text/markdown;charset=utf-8';
                            break;
                        case '.xml':
                            mimeType = 'application/xml;charset=utf-8';
                            break;
                        case '.csv':
                            mimeType = 'text/csv;charset=utf-8';
                            break;
                        case '.txt':
                            mimeType = 'text/plain;charset=utf-8';
                            break;
                        default:
                            // ÂØπ‰∫éÊúâÊâ©Â±ïÂêç‰ΩÜ‰∏çÂåπÈÖçÂ∑≤Áü•Á±ªÂûãÁöÑÊñá‰ª∂Ôºå‰ΩøÁî®ÈÄöÁî®ÊñáÊú¨Á±ªÂûã
                            mimeType = 'text/plain;charset=utf-8';
                    }
                }
                // Â¶ÇÊûúÊñá‰ª∂Ê≤°ÊúâÊâ©Â±ïÂêçÔºå‰øùÊåÅ‰ΩøÁî® application/octet-streamÔºåËÆ©ÊµèËßàÂô®ÊåâÂéüÊñá‰ª∂Âêç‰øùÂ≠ò

                const blob = new Blob([text], { type: mimeType });
                const finalUrl = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = finalUrl;
                a.download = cleanFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                URL.revokeObjectURL(finalUrl);
                this.hideSaveModal();
                this.showMessage('‰øùÂ≠òÊàêÂäü', `Êñá‰ª∂ "${cleanFileName}" Â∑≤‰øùÂ≠òÂà∞‰∏ãËΩΩÊñá‰ª∂Â§π`);
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.editor.value = e.target.result;
                        this.updateStats();
                        this.saveHistory();
                        this.showMessage('ÊâìÂºÄÊàêÂäü', `Â∑≤ÊâìÂºÄÊñá‰ª∂: ${file.name}`);
                    };
                    reader.onerror = () => {
                        this.showMessage('ÊâìÂºÄÂ§±Ë¥•', 'ËØªÂèñÊñá‰ª∂Êó∂ÂèëÁîüÈîôËØØ');
                    };
                    reader.readAsText(file, 'UTF-8');
                }

                this.fileInput.value = '';
            }

            
            
            removeEmptyLines() {
                const text = this.editor.value;
                const originalLines = text.split('\n').length;
                const cleanedText = text.replace(/^\s*\n/gm, '').replace(/\n+$/, '');
                const newLines = cleanedText.split('\n').length;

                this.editor.value = cleanedText;
                this.updateStats();
                this.saveHistory();

                const removedLines = originalLines - newLines;
                this.showMessage('Ê∏ÖÁêÜÂÆåÊàê', `Â∑≤Âà†Èô§ ${removedLines} ‰∏™Á©∫Ë°å`);
            }

            removeSpaces() {
                const text = this.editor.value;
                const originalLength = text.length;

                const cleanedText = text
                    .replace(/^\s+|\s+$/gm, '')  // Ë°åÈ¶ñË°åÂ∞æÁ©∫Ê†º
                    .replace(/[ \t]+/g, ' ')      // Â§ö‰∏™Á©∫Ê†ºÂêàÂπ∂
                    .replace(/\n+/g, '\n')        // Â§ö‰∏™Êç¢Ë°åÁ¨¶ÂêàÂπ∂
                    .trim();                      // Êï¥‰ΩìÈ¶ñÂ∞æÁ©∫Ê†º

                this.editor.value = cleanedText;
                this.updateStats();
                this.saveHistory();

                const removedChars = originalLength - cleanedText.length;
                this.showMessage('Ê∏ÖÁêÜÂÆåÊàê', `Â∑≤Âà†Èô§ ${removedChars} ‰∏™Â§ö‰ΩôÂ≠óÁ¨¶`);
            }

            cleanAll() {
                const text = this.editor.value;
                const originalLength = text.length;

                const cleanedText = text
                    .replace(/^\s+|\s+$/gm, '')
                    .replace(/[ \t]+/g, ' ')
                    .replace(/^\s*\n/gm, '')
                    .replace(/\n+/g, '\n')
                    .replace(/\n$/, '')
                    .trim();

                this.editor.value = cleanedText;
                this.updateStats();
                this.saveHistory();

                const removedChars = originalLength - cleanedText.length;
                this.showMessage('Ê∏ÖÁêÜÂÆåÊàê', `Â∑≤Ê∏ÖÁêÜ ${removedChars} ‰∏™Â≠óÁ¨¶`);
            }

  
            copyAll() {
                this.editor.select();

                // ‰ΩøÁî®Áé∞‰ª£ÁöÑ Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(this.editor.value)
                        .then(() => {
                            this.showMessage('Â§çÂà∂ÊàêÂäü', 'ÂÖ®ÈÉ®ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                        })
                        .catch(() => {
                            this.fallbackCopy();
                        });
                } else {
                    this.fallbackCopy();
                }

                this.editor.setSelectionRange(0, 0);
            }

            fallbackCopy() {
                // È¶ñÂÖàÂ∞ùËØïÁõ¥Êé•Â§çÂà∂ÈÄâ‰∏≠ÁöÑÂÜÖÂÆπ
                try {
                    // Á°Æ‰øùÁºñËæëÂô®‰∏≠ÊúâÈÄâ‰∏≠ÁöÑÂÜÖÂÆπ
                    if (document.activeElement === this.editor && this.editor.selectionStart !== this.editor.selectionEnd) {
                        // Â¶ÇÊûúÁºñËæëÂô®Â∑≤ÁªèÊúâÈÄâ‰∏≠ÁöÑÂÜÖÂÆπÔºåÁõ¥Êé•Â§çÂà∂
                        const successful = document.execCommand('copy');
                        if (successful) {
                            this.showMessage('Â§çÂà∂ÊàêÂäü', 'ÂÖ®ÈÉ®ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                            return;
                        }
                    }
                } catch (err) {
                    // ÂøΩÁï•ÈîôËØØÂπ∂Â∞ùËØïÂ§áÁî®ÊñπÊ≥ï
                }

                // Â¶ÇÊûúÁõ¥Êé•Â§çÂà∂Â§±Ë¥•ÔºåÂàô‰ΩøÁî®textareaÊñπÊ≥ï
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = this.editor.value;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    textArea.style.width = '1px';
                    textArea.style.height = '1px';
                    textArea.style.padding = '0';
                    textArea.style.border = 'none';
                    textArea.style.outline = 'none';
                    textArea.style.boxShadow = 'none';
                    textArea.style.background = 'transparent';
                    document.body.appendChild(textArea);
                    
                    // Âú®ÁßªÂä®ËÆæÂ§á‰∏äÈúÄË¶ÅÂÖàËÅöÁÑ¶ÂÜçÈÄâÊã©
                    textArea.focus();
                    textArea.select();
                    
                    // Â∞ùËØï‰ΩøÁî®selection API (ÂØπ‰∫éËæÉÊñ∞ÁöÑÊµèËßàÂô®)
                    if (textArea.setSelectionRange) {
                        textArea.setSelectionRange(0, textArea.value.length);
                    }
                    
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.showMessage('Â§çÂà∂ÊàêÂäü', 'ÂÖ®ÈÉ®ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                    } else {
                        this.showMessage('Â§çÂà∂Â§±Ë¥•', 'ÊµèËßàÂô®‰∏çÊîØÊåÅËá™Âä®Â§çÂà∂ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                    }

                    document.body.removeChild(textArea);
                } catch (err) {
                    this.showMessage('Â§çÂà∂Â§±Ë¥•', 'ÊµèËßàÂô®‰∏çÊîØÊåÅËá™Âä®Â§çÂà∂ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                }
            }

            clearDocument() {
                if (this.editor.value.trim()) {
                    if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂÜÖÂÆπÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                        this.editor.value = '';
                        this.updateStats();
                        this.saveHistory();
                        this.showMessage('Ê∏ÖÁ©∫ÊàêÂäü', 'ÊñáÊ°£ÂÜÖÂÆπÂ∑≤Ê∏ÖÁ©∫');
                    }
                }
            }

      
            showModal(title, message) {
                this.modalTitle.textContent = title;
                this.modalMessage.textContent = message;
                this.messageModal.classList.add('show');
            }

            hideModal() {
                this.messageModal.classList.remove('show');
            }

            openPreferences() {
                this.preferencesModal.classList.add('show');
            }

            hidePreferencesModal() {
                this.preferencesModal.classList.remove('show');
            }

            showHelpModal() {
                this.helpModal.classList.add('show');
            }

            hideHelpModal() {
                this.helpModal.classList.remove('show');
            }

            // Êü•ÊâæÊõøÊç¢ÂºπÁ™óÊñπÊ≥ï
            showFindReplaceModal() {
                this.findReplaceModal.classList.add('show');

                // Â¶ÇÊûúÊúâÈÄâ‰∏≠ÊñáÊú¨ÔºåËá™Âä®Â°´ÂÖ•Êü•ÊâæÊ°Ü
                const selectedText = this.editor.value.substring(this.editor.selectionStart, this.editor.selectionEnd);
                if (selectedText) {
                    this.findReplaceSearchInput.value = selectedText;
                }

                // ËÅöÁÑ¶Âà∞Êü•ÊâæËæìÂÖ•Ê°ÜÂπ∂ÈÄâ‰∏≠ÊñáÊú¨
                this.findReplaceSearchInput.focus();
                this.findReplaceSearchInput.select();

                // ÂàùÂßãÂåñÊêúÁ¥¢Áä∂ÊÄÅÂíåÁºìÂ≠ò
                this.findReplaceResults = [];
                this.findReplaceIndex = -1;
                this.lastSearchText = null;
                this.lastTextLength = null;
                this.lastSearchOptions = null;
                this.hasShownFirstResult = false;
            }

            hideFindReplaceModal() {
                this.findReplaceModal.classList.remove('show');
            }

            // Êü•ÊâæÊõøÊç¢ÂäüËÉΩÊñπÊ≥ï
            findReplaceFind() {
                const searchText = this.findReplaceSearchInput.value.trim();
                if (!searchText) {
                    this.showMessage('ÊèêÁ§∫', 'ËØ∑ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÂÜÖÂÆπ');
                    return;
                }

                const text = this.editor.value;
                const options = {
                    caseSensitive: this.findReplaceCaseSensitive.checked,
                    wholeWord: this.findReplaceWholeWord.checked
                };

                // ‰ºòÂåñÔºöÂ¶ÇÊûúÂ∑≤ÊúâÊêúÁ¥¢ÁªìÊûú‰∏îÊêúÁ¥¢Êù°‰ª∂Êú™ÂèòÔºåÁõ¥Êé•‰ΩøÁî®Áé∞ÊúâÁªìÊûú
                if (this.findReplaceResults.length > 0) {
                    const currentOptions = {
                        caseSensitive: this.findReplaceCaseSensitive.checked,
                        wholeWord: this.findReplaceWholeWord.checked
                    };

                    // Ê£ÄÊü•ÊêúÁ¥¢Êù°‰ª∂ÊòØÂê¶ÂèòÂåñÔºàÁÆÄÂçïÊ£ÄÊü•ÊñáÊú¨ÈïøÂ∫¶ÂíåÊêúÁ¥¢ËØçÔºâ
                    const lastSearchText = this.lastSearchText || '';
                    const lastTextLength = this.lastTextLength || 0;

                    if (lastSearchText === searchText &&
                        lastTextLength === text.length &&
                        JSON.stringify(this.lastSearchOptions) === JSON.stringify(currentOptions)) {
                        // Áõ¥Êé•‰ΩøÁî®Áé∞ÊúâÊêúÁ¥¢ÁªìÊûúÔºåÊèêÈ´òÂìçÂ∫îÈÄüÂ∫¶
                        const matches = this.findReplaceResults;

                        // Êü•Êâæ‰∏ã‰∏Ä‰∏™
                        if (this.findReplaceIndex < matches.length - 1) {
                            this.findReplaceIndex++;
                        } else {
                            this.findReplaceIndex = 0; // Âæ™ÁéØÂà∞Á¨¨‰∏Ä‰∏™
                        }

                        const match = matches[this.findReplaceIndex];
                        this.selectAndScrollToMatch(match, text);

                        // Âè™Âú®È¶ñÊ¨°ÊêúÁ¥¢Êó∂ÊòæÁ§∫Ê∂àÊÅØÔºåÈÅøÂÖçÈ¢ëÁπÅÂºπÁ™ó
                        if (!this.hasShownFirstResult) {
                            const matchInfo = `ÊâæÂà∞ ${this.findReplaceIndex + 1}/${matches.length} ‰∏™ÂåπÈÖç`;
                            this.showMessage('Êü•ÊâæÁªìÊûú', matchInfo);
                            setTimeout(() => this.hideModal(), 1000);
                            this.hasShownFirstResult = true;
                        }
                        return;
                    }
                }

                // È¶ñÊ¨°ÊêúÁ¥¢ÊàñÊêúÁ¥¢Êù°‰ª∂ÂèòÂåñÊó∂ÔºåÈáçÊñ∞ÊêúÁ¥¢
                const regex = this.createFindReplaceRegex(searchText, options);
                const matches = [...text.matchAll(regex)];

                if (matches.length === 0) {
                    this.showMessage('Êü•ÊâæÁªìÊûú', 'Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊñáÊú¨');
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    return;
                }

                // ÁºìÂ≠òÊêúÁ¥¢Êù°‰ª∂
                this.lastSearchText = searchText;
                this.lastTextLength = text.length;
                this.lastSearchOptions = options;
                this.findReplaceResults = matches;
                this.hasShownFirstResult = true;

                // Êü•ÊâæÁ¨¨‰∏Ä‰∏™ÂåπÈÖç
                this.findReplaceIndex = 0;
                const match = matches[this.findReplaceIndex];
                this.selectAndScrollToMatch(match, text);

                const matchInfo = `ÊâæÂà∞ ${this.findReplaceIndex + 1}/${matches.length} ‰∏™ÂåπÈÖç`;
                this.showMessage('Êü•ÊâæÁªìÊûú', matchInfo);
                setTimeout(() => this.hideModal(), 1000);
            }

            // Êñ∞Â¢ûËæÖÂä©ÊñπÊ≥ïÔºöÈÄâ‰∏≠Âπ∂ÊªöÂä®Âà∞ÂåπÈÖç‰ΩçÁΩÆ
            selectAndScrollToMatch(match, text) {
                // Ê£ÄÊü•ÂåπÈÖçÁªìÊûúÊòØÂê¶ÊúâÊïà
                if (!match || typeof match.index !== 'number' || !match[0]) {
                    console.error('Invalid match object:', match);
                    return;
                }

                // Ê£ÄÊü•ÁºñËæëÂô®ÊòØÂê¶Â≠òÂú®
                if (!this.editor) {
                    console.error('Editor element not found');
                    return;
                }

                this.editor.focus();
                this.editor.setSelectionRange(match.index, match.index + match[0].length);

                // ‰ºòÂåñÊªöÂä®Ôºö‰ΩøÁî®Êõ¥Á≤æÁ°ÆÁöÑÊªöÂä®ËÆ°ÁÆó
                const lineHeight = parseInt(window.getComputedStyle(this.editor).lineHeight) || 20;
                const line = text.substring(0, match.index).split('\n').length - 1;
                const targetScrollTop = line * lineHeight;

                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊªöÂä®
                const editorRect = this.editor.getBoundingClientRect();
                const currentScrollTop = this.editor.scrollTop;
                const viewportHeight = editorRect.height;

                // Âè™ÊúâÂΩìÂåπÈÖçÈ°π‰∏çÂú®ËßÜÁ™óÂÜÖÊó∂ÊâçÊªöÂä®
                if (targetScrollTop < currentScrollTop ||
                    targetScrollTop > currentScrollTop + viewportHeight - lineHeight * 2) {
                    this.editor.scrollTop = targetScrollTop;
                }
            }

            findReplaceFindPrev() {
                const searchText = this.findReplaceSearchInput.value.trim();
                if (!searchText) {
                    this.showMessage('ÊèêÁ§∫', 'ËØ∑ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÂÜÖÂÆπ');
                    return;
                }

                const text = this.editor.value;
                const options = {
                    caseSensitive: this.findReplaceCaseSensitive.checked,
                    wholeWord: this.findReplaceWholeWord.checked
                };

                // ‰ºòÂåñÔºöÂ¶ÇÊûúÂ∑≤ÊúâÊêúÁ¥¢ÁªìÊûú‰∏îÊêúÁ¥¢Êù°‰ª∂Êú™ÂèòÔºåÁõ¥Êé•‰ΩøÁî®Áé∞ÊúâÁªìÊûú
                if (this.findReplaceResults.length > 0) {
                    const currentOptions = {
                        caseSensitive: this.findReplaceCaseSensitive.checked,
                        wholeWord: this.findReplaceWholeWord.checked
                    };

                    const lastSearchText = this.lastSearchText || '';
                    const lastTextLength = this.lastTextLength || 0;

                    if (lastSearchText === searchText &&
                        lastTextLength === text.length &&
                        JSON.stringify(this.lastSearchOptions) === JSON.stringify(currentOptions)) {
                        // Áõ¥Êé•‰ΩøÁî®Áé∞ÊúâÊêúÁ¥¢ÁªìÊûúÔºåÊèêÈ´òÂìçÂ∫îÈÄüÂ∫¶
                        const matches = this.findReplaceResults;

                        // Êü•Êâæ‰∏ä‰∏Ä‰∏™
                        if (this.findReplaceIndex > 0) {
                            this.findReplaceIndex--;
                        } else {
                            this.findReplaceIndex = matches.length - 1; // Âæ™ÁéØÂà∞ÊúÄÂêé‰∏Ä‰∏™
                        }

                        const match = matches[this.findReplaceIndex];
                        this.selectAndScrollToMatch(match, text);

                        // Âè™Âú®È¶ñÊ¨°ÊêúÁ¥¢Êó∂ÊòæÁ§∫Ê∂àÊÅØÔºåÈÅøÂÖçÈ¢ëÁπÅÂºπÁ™ó
                        if (!this.hasShownFirstResult) {
                            const matchInfo = `ÊâæÂà∞ ${this.findReplaceIndex + 1}/${matches.length} ‰∏™ÂåπÈÖç`;
                            this.showMessage('Êü•ÊâæÁªìÊûú', matchInfo);
                            setTimeout(() => this.hideModal(), 1000);
                            this.hasShownFirstResult = true;
                        }
                        return;
                    }
                }

                // È¶ñÊ¨°ÊêúÁ¥¢ÊàñÊêúÁ¥¢Êù°‰ª∂ÂèòÂåñÊó∂ÔºåÈáçÊñ∞ÊêúÁ¥¢
                const regex = this.createFindReplaceRegex(searchText, options);
                const matches = [...text.matchAll(regex)];

                if (matches.length === 0) {
                    this.showMessage('Êü•ÊâæÁªìÊûú', 'Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊñáÊú¨');
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    return;
                }

                // ÁºìÂ≠òÊêúÁ¥¢Êù°‰ª∂
                this.lastSearchText = searchText;
                this.lastTextLength = text.length;
                this.lastSearchOptions = options;
                this.findReplaceResults = matches;
                this.hasShownFirstResult = true;

                // Êü•ÊâæÊúÄÂêé‰∏Ä‰∏™ÂåπÈÖçÔºàÊü•Êâæ‰∏ä‰∏Ä‰∏™Êó∂‰ªéÊú´Â∞æÂºÄÂßãÔºâ
                this.findReplaceIndex = matches.length - 1;
                const match = matches[this.findReplaceIndex];
                this.selectAndScrollToMatch(match, text);

                const matchInfo = `ÊâæÂà∞ ${this.findReplaceIndex + 1}/${matches.length} ‰∏™ÂåπÈÖç`;
                this.showMessage('Êü•ÊâæÁªìÊûú', matchInfo);
                setTimeout(() => this.hideModal(), 1000);
            }

            findReplaceReplace() {
                if (this.findReplaceResults.length === 0) {
                    this.showMessage('ÊèêÁ§∫', 'ËØ∑ÂÖàËøõË°åÊü•Êâæ');
                    return;
                }

                if (this.findReplaceIndex < 0 || this.findReplaceIndex >= this.findReplaceResults.length) {
                    this.showMessage('ÊèêÁ§∫', 'Êü•ÊâæÁ¥¢ÂºïÈîôËØØÔºåËØ∑ÈáçÊñ∞ÊêúÁ¥¢');
                    return;
                }

                const replaceText = this.findReplaceReplaceInput.value;
                const currentMatch = this.findReplaceResults[this.findReplaceIndex];

                // Ê£ÄÊü•ÂåπÈÖçÁªìÊûúÊòØÂê¶ÊúâÊïà
                if (!currentMatch || typeof currentMatch.index !== 'number' || !currentMatch[0]) {
                    this.showMessage('ÈîôËØØ', 'ÂåπÈÖçÁªìÊûúÊó†ÊïàÔºåËØ∑ÈáçÊñ∞ÊêúÁ¥¢');
                    return;
                }

                const searchText = this.findReplaceSearchInput.value.trim();

                // ÊõøÊç¢ÂΩìÂâçÂåπÈÖç
                const text = this.editor.value;
                this.editor.value = text.substring(0, currentMatch.index) +
                                  replaceText +
                                  text.substring(currentMatch.index + currentMatch[0].length);

                // Êõ¥Êñ∞ÁªüËÆ°
                this.updateStats();
                this.saveHistory();

                // ËÆ°ÁÆóÊõøÊç¢ÂêéÂ∫îËØ•ÂÆö‰ΩçÂà∞Âì™‰∏™‰ΩçÁΩÆ
                const replacementLength = replaceText.length;
                const originalMatchLength = currentMatch[0].length;
                const lengthDiff = replacementLength - originalMatchLength;

                // ÈáçÊñ∞Êü•Êâæ‰ª•Êõ¥Êñ∞ÊâÄÊúâÂåπÈÖç‰ΩçÁΩÆ
                const options = {
                    caseSensitive: this.findReplaceCaseSensitive.checked,
                    wholeWord: this.findReplaceWholeWord.checked
                };

                const regex = this.createFindReplaceRegex(searchText, options);
                const newMatches = [...this.editor.value.matchAll(regex)];

                if (newMatches.length === 0) {
                    // ÊõøÊç¢ÂêéÊ≤°ÊúâÊõ¥Â§öÂåπÈÖç‰∫Ü
                    this.findReplaceResults = [];
                    this.findReplaceIndex = -1;
                    this.showMessage('ÊõøÊç¢ÂÆåÊàê', 'Ê≤°ÊúâÊõ¥Â§öÂåπÈÖçÈ°π‰∫Ü');
                    return;
                }

                this.findReplaceResults = newMatches;

                // Êô∫ËÉΩÂÆö‰Ωç‰∏ã‰∏Ä‰∏™ÂåπÈÖçÈ°π
                let nextIndex = 0;
                const replacementEndPos = currentMatch.index + replacementLength;

                // ÊâæÂà∞ÊõøÊç¢‰ΩçÁΩÆÂêéÁöÑÁ¨¨‰∏Ä‰∏™ÂåπÈÖç
                for (let i = 0; i < newMatches.length; i++) {
                    if (newMatches[i].index >= replacementEndPos) {
                        nextIndex = i;
                        break;
                    }
                }

                this.findReplaceIndex = nextIndex;
                const nextMatch = newMatches[this.findReplaceIndex];

                // ÈÄâÂÆö‰∏ã‰∏Ä‰∏™ÂåπÈÖç
                this.editor.focus();
                this.editor.setSelectionRange(nextMatch.index, nextMatch.index + nextMatch[0].length);

                // ÊªöÂä®Âà∞ÂèØËßÅÂå∫Âüü
                const line = this.editor.value.substring(0, nextMatch.index).split('\n').length - 1;
                this.editor.scrollTop = line * 20;

                // ÊòæÁ§∫ÊõøÊç¢‰ø°ÊÅØ
                const matchInfo = `Â∑≤ÊõøÊç¢ÔºåÂÆö‰ΩçÂà∞ ${this.findReplaceIndex + 1}/${newMatches.length} ‰∏™ÂåπÈÖç`;
                this.showMessage('ÊõøÊç¢ÊàêÂäü', matchInfo);
                setTimeout(() => this.hideModal(), 1500);
            }

            findReplaceReplaceAll() {
                const searchText = this.findReplaceSearchInput.value.trim();
                if (!searchText) {
                    this.showMessage('ÊèêÁ§∫', 'ËØ∑ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÂÜÖÂÆπ');
                    return;
                }

                const text = this.editor.value;
                const replaceText = this.findReplaceReplaceInput.value;
                const options = {
                    caseSensitive: this.findReplaceCaseSensitive.checked,
                    wholeWord: this.findReplaceWholeWord.checked
                };

                const regex = this.createFindReplaceRegex(searchText, options);

                // ‰ΩøÁî®matchAllÊù•Ëé∑ÂèñËØ¶ÁªÜÂåπÈÖç‰ø°ÊÅØÔºåÁ°Æ‰øù‰∏éÂÖ∂‰ªñÊñπÊ≥ï‰∏ÄËá¥
                const matches = [...text.matchAll(regex)];

                if (matches.length === 0) {
                    this.showMessage('ÊõøÊç¢ÁªìÊûú', 'Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊñáÊú¨');
                    return;
                }

                const newText = text.replace(regex, replaceText);
                this.editor.value = newText;
                this.updateStats();
                this.saveHistory();

                this.showMessage('ÊõøÊç¢ÁªìÊûú', `Â∑≤ÊõøÊç¢ ${matches.length} Â§ÑÊñáÊú¨`);

                // ÈáçÁΩÆÊêúÁ¥¢Áä∂ÊÄÅ
                this.findReplaceResults = [];
                this.findReplaceIndex = -1;
            }

            createFindReplaceRegex(searchText, options) {
                let pattern = searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

                if (options.wholeWord) {
                    // Ê£ÄÊü•ÊêúÁ¥¢ÊñáÊú¨ÊòØÂê¶ÂåÖÂê´‰∏≠ÊñáÂ≠óÁ¨¶
                    const hasChinese = /[\u4e00-\u9fff]/.test(searchText);

                    if (hasChinese) {
                        // ÂØπ‰∫é‰∏≠ÊñáÔºå‰ΩøÁî®Â≠óÁ¨¶ËæπÁïåËÄå‰∏çÊòØÂçïËØçËæπÁïå
                        pattern = `(?<!\\w)${pattern}(?!\\w)`;
                    } else {
                        // ÂØπ‰∫éËã±ÊñáÔºå‰ΩøÁî®‰º†ÁªüÁöÑÂçïËØçËæπÁïå
                        pattern = `\\b${pattern}\\b`;
                    }
                }

                const flags = options.caseSensitive ? 'g' : 'gi';
                return new RegExp(pattern, flags);
            }

            showMessage(title, message) {
                this.showModal(title, message);
                setTimeout(() => this.hideModal(), 2000);
            }

        
          
      
          
            loadPreferences() {
                console.log('üì• loadPreferences started');
                const saved = localStorage.getItem('notepad-preferences');
                console.log('üì¶ Saved preferences:', saved);
                let preferences;

                if (saved) {
                    try {
                        preferences = JSON.parse(saved);
                        console.log('‚úÖ Parsed preferences:', preferences);
                    } catch (e) {
                        console.error('ÂÅèÂ•ΩËÆæÁΩÆËß£ÊûêÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº', e);
                        preferences = null;
                    }
                }

                if (saved && preferences) {
                    // ÂÆâÂÖ®Âú∞Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅÔºå‰ΩøÁî®Á©∫ÂÄºÊ£ÄÊü•
                    const updateCheckbox = (element, value) => {
                        if (element) element.checked = value;
                    };

                    updateCheckbox(this.showWordCount, preferences.showWordCount !== false);
                    updateCheckbox(this.showCharCount, preferences.showCharCount !== false);
                    updateCheckbox(this.showLineCount, preferences.showLineCount !== false);
                    updateCheckbox(this.showColCount, preferences.showColCount !== false);
                    updateCheckbox(this.showSelectedCount, preferences.showSelectedCount !== false);
                    updateCheckbox(this.showPositionPercent, preferences.showPositionPercent !== false);
                    updateCheckbox(this.showDateTime, preferences.showDateTime !== false);
                    updateCheckbox(this.markdownMode, preferences.markdownMode === true);
                    updateCheckbox(this.autoWordWrap, preferences.autoWordWrap === true);
                    updateCheckbox(this.enableFullscreen, preferences.enableFullscreen === true);
                    updateCheckbox(this.showGrid, preferences.showGrid === true);
                    
                    // ËÆæÁΩÆÂ∫ïÈÉ®ËæπË∑ùÊªëÂùóÁöÑÂÄº
                    if (this.bottomMarginSlider) {
                        this.bottomMarginSlider.value = preferences.bottomMargin || 175;
                        if (this.bottomMarginValue) {
                            this.bottomMarginValue.textContent = this.bottomMarginSlider.value;
                        }
                    }
                } else {
                    // ÈªòËÆ§ÂÄº - Èô§markdownÂ∑•ÂÖ∑ÂíåÂÖ®Â±èÂ§ñÔºåÂÖ∂‰ªñÈÉΩÈÄâ‰∏≠
                    preferences = {
                        showWordCount: true,
                        showCharCount: true,
                        showLineCount: true,
                        showColCount: true,
                        showSelectedCount: true,
                        showPositionPercent: true,
                        showDateTime: true,
                        showGrid: true,              // ÁΩëÊ†ºËÉåÊôØÈªòËÆ§ÈÄâ‰∏≠
                        markdownMode: false,
                        autoWordWrap: false,
                        enableFullscreen: false,
                        bottomMargin: 175            // ÈªòËÆ§Â∫ïÈÉ®ËæπË∑ù‰∏∫175px
                    };

                    // ÂÆâÂÖ®Âú∞ËÆæÁΩÆÈªòËÆ§ÂÄº
                    const updateCheckbox = (element, value) => {
                        if (element) {
                            element.checked = value;
                        }
                    };

                    updateCheckbox(this.showWordCount, preferences.showWordCount);
                    updateCheckbox(this.showCharCount, preferences.showCharCount);
                    updateCheckbox(this.showLineCount, preferences.showLineCount);
                    updateCheckbox(this.showColCount, preferences.showColCount);
                    updateCheckbox(this.showSelectedCount, preferences.showSelectedCount);
                    updateCheckbox(this.showPositionPercent, preferences.showPositionPercent);
                    updateCheckbox(this.showDateTime, preferences.showDateTime);
                    updateCheckbox(this.showGrid, preferences.showGrid);
                    updateCheckbox(this.markdownMode, preferences.markdownMode);
                    updateCheckbox(this.autoWordWrap, preferences.autoWordWrap);
                    updateCheckbox(this.enableFullscreen, preferences.enableFullscreen);
                    
                    // ËÆæÁΩÆÂ∫ïÈÉ®ËæπË∑ùÊªëÂùóÁöÑÈªòËÆ§ÂÄº
                    if (this.bottomMarginSlider) {
                        this.bottomMarginSlider.value = preferences.bottomMargin;
                        if (this.bottomMarginValue) {
                            this.bottomMarginValue.textContent = this.bottomMarginSlider.value;
                        }
                    }
                }

                this.applyPreferences(preferences);
                this.updateStats();
                this.updateCursorPosition();
                this.updateColumnPosition();

                // Á°Æ‰øùÊó∂Èó¥ÊòæÁ§∫Á´ãÂç≥Êõ¥Êñ∞
                if (preferences.showDateTime !== false) {
                    this.updateDateTime();
                    if (!this.timeUpdateInterval) {
                        this.startTimeUpdate();
                    }
                }
            }

            applyPreferences(preferences) {
                // Apply status bar item visibility using the original initialized element references
                const applyElementVisibility = (element, preferenceValue, logName) => {
                    if (element) {
                        // Log for debugging
                        console.log(`Setting ${logName} visibility: ${preferenceValue}`);

                        if (preferenceValue === false) {
                            // ‰ΩøÁî®Êõ¥Âº∫Âà∂ÁöÑÊñπÂºèÈöêËóèÂÖÉÁ¥†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè‰∏≠ÁöÑ !important
                            element.style.display = 'none';
                        } else {
                            // ÊÅ¢Â§çÊòæÁ§∫ÔºåÁßªÈô§ÈÄöËøá‰ª£Á†ÅÊ∑ªÂä†ÁöÑ display Ê†∑Âºè
                            element.style.display = '';
                            // Â¶ÇÊûú‰πãÂâçÊúâ hidden Á±ªÔºå‰πüÁßªÈô§ÂÆÉ
                            element.classList.remove('hidden');
                        }
                    } else {
                        console.warn(`Element for ${logName} not found`);
                    }
                };

                // Apply to each status bar element using original references
                applyElementVisibility(this.charCount, preferences.showCharCount, 'charCount');
                applyElementVisibility(this.wordCount, preferences.showWordCount, 'wordCount');
                applyElementVisibility(this.lineCount, preferences.showLineCount, 'lineCount');
                applyElementVisibility(this.selectedCount, preferences.showSelectedCount, 'selectedCount');
                applyElementVisibility(this.colCount, preferences.showColCount, 'colCount');
                applyElementVisibility(this.positionPercent, preferences.showPositionPercent, 'positionPercent');

                // Special handling for datetime display
                if (this.dateTimeDisplay) {
                    if (preferences.showDateTime === false) {
                        // ‰ΩøÁî®Êõ¥Âº∫Âà∂ÁöÑÊñπÂºèÈöêËóèÂÖÉÁ¥†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè‰∏≠ÁöÑ !important
                        this.dateTimeDisplay.style.display = 'none';
                        // ÂÅúÊ≠¢Êó∂Èó¥Êõ¥Êñ∞‰ª•ËäÇÁúÅËµÑÊ∫ê
                        if (this.timeUpdateInterval) {
                            clearInterval(this.timeUpdateInterval);
                            this.timeUpdateInterval = null;
                        }
                    } else {
                        // ÊÅ¢Â§çÊòæÁ§∫ÔºåÁßªÈô§ÈÄöËøá‰ª£Á†ÅÊ∑ªÂä†ÁöÑ display Ê†∑Âºè
                        this.dateTimeDisplay.style.display = '';
                        // Â¶ÇÊûú‰πãÂâçÊúâ hidden Á±ªÔºå‰πüÁßªÈô§ÂÆÉ
                        this.dateTimeDisplay.classList.remove('hidden');
                        // Á°Æ‰øùÊó∂Èó¥Êõ¥Êñ∞Â∑≤ÂêØÂä®
                        if (!this.timeUpdateInterval) {
                            this.startTimeUpdate();
                        }
                    }
                }

                // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®ÁöÑÁä∂ÊÄÅÊ†èÈ°πÁõÆÂèØËßÅÊÄßËÆæÁΩÆ
                this.updateStatusBarVisibilityInStorage(preferences);

                // Markdown mode
                if (preferences.markdownMode) {
                    if (this.markdownToolbar.classList.contains('collapsed')) {
                        this.markdownToolbar.classList.remove('collapsed');
                    }
                    document.body.classList.add('markdown-visible');
                } else {
                    if (!this.markdownToolbar.classList.contains('collapsed')) {
                        this.markdownToolbar.classList.add('collapsed');
                    }
                    document.body.classList.remove('markdown-visible');
                }

                // Auto word wrap functionality
                this.applyAutoWordWrap(preferences.autoWordWrap);
                // Update screen size after applying auto word wrap
                this.checkScreenSize();

                // Grid background display
                const editorWrapper = this.editor?.parentElement || document.querySelector('.editor-wrapper');

                if (editorWrapper) {
                    if (preferences.showGrid) {
                        editorWrapper.classList.add('show-grid');
                        // ÁßªÈô§ÁºñËæëÂô®ÂÖÉÁ¥†ÁöÑÂÜÖËÅîËÉåÊôØÊ†∑ÂºèÔºåËÆ©CSSÊ†∑ÂºèÁîüÊïà
                        if (this.editor) {
                            this.editor.style.backgroundImage = '';
                        }
                    } else {
                        editorWrapper.classList.remove('show-grid');
                        // ÊòéÁ°ÆËÆæÁΩÆÁºñËæëÂô®ËÉåÊôØ‰∏∫Êó†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè
                        if (this.editor) {
                            this.editor.style.backgroundImage = 'none';
                        }
                    }
                }

                // Fullscreen mode
                if (preferences.enableFullscreen) {
                    // ÂêØÁî®ÂÖ®Â±èÊ®°Âºè
                    if (!document.fullscreenElement && !document.body.classList.contains('fullscreen')) {
                        // Âè™ÊúâÂú®ÂΩìÂâç‰∏çÊòØÂÖ®Â±èÁä∂ÊÄÅÊó∂ÊâçËøõÂÖ•ÂÖ®Â±è
                        document.documentElement.requestFullscreen().catch((err) => {
                            console.warn('ËøõÂÖ•ÂÖ®Â±èÂ§±Ë¥•:', err);
                            // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÊ∑ªÂä†CSSÁ±ª
                            document.body.classList.add('fullscreen');
                        });
                    }
                } else {
                    // Á¶ÅÁî®ÂÖ®Â±èÊ®°Âºè
                    if (document.fullscreenElement) {
                        // Â¶ÇÊûúÂΩìÂâçÊòØÂÖ®Â±èÁä∂ÊÄÅÔºåÂàôÈÄÄÂá∫ÂÖ®Â±è
                        document.exitFullscreen().catch((err) => {
                            console.warn('ÈÄÄÂá∫ÂÖ®Â±èÂ§±Ë¥•:', err);
                            // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÁßªÈô§CSSÁ±ª
                            document.body.classList.remove('fullscreen');
                        });
                    } else {
                        // Â¶ÇÊûúÂΩìÂâç‰∏çÊòØÂÖ®Â±èÁä∂ÊÄÅÔºå‰ΩÜCSSÁ±ªÂ≠òÂú®ÔºåÂàôÁßªÈô§ÂÆÉ
                        document.body.classList.remove('fullscreen');
                    }
                }
            }

            // Â∫îÁî®ÊâÄÊúâÂÅèÂ•ΩËÆæÁΩÆÁöÑ‰æøÊç∑ÊñπÊ≥ï
            applyAllPreferences() {
                const saved = localStorage.getItem('notepad-preferences');
                let preferences;

                if (saved) {
                    try {
                        preferences = JSON.parse(saved);
                    } catch (e) {
                        preferences = {
                            showWordCount: true,
                            showCharCount: true,
                            showLineCount: true,
                            showColCount: true,
                            showSelectedCount: true,
                            showPositionPercent: true,
                            showDateTime: true,
                            showGrid: true,
                            markdownMode: false,
                            autoWordWrap: false,
                            enableFullscreen: false,
                            bottomMargin: 175
                        };
                    }
                } else {
                    preferences = {
                        showWordCount: true,
                        showCharCount: true,
                        showLineCount: true,
                        showColCount: true,
                        showSelectedCount: true,
                        showPositionPercent: true,
                        showDateTime: true,
                        showGrid: true,
                        markdownMode: false,
                        autoWordWrap: false,
                        enableFullscreen: false,
                        bottomMargin: 175
                    };
                }

                // Á°Æ‰øùÂú®Ë∞ÉÁî®ÂâçÊâÄÊúâÂÖÉÁ¥†ÈÉΩÂ∑≤ÂáÜÂ§áÂ•Ω
                setTimeout(() => {
                    this.applyPreferences(preferences);
                }, 50);
            }

            toggleMarkdownToolbar() {
                const isCollapsed = this.markdownToolbar.classList.contains('collapsed');
                this.markdownToolbar.classList.toggle('collapsed');

                if (isCollapsed) {
                    document.body.classList.add('markdown-visible');
                    // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                    if (this.markdownMode) {
                        this.markdownMode.checked = true;
                    }
                } else {
                    document.body.classList.remove('markdown-visible');
                    // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                    if (this.markdownMode) {
                        this.markdownMode.checked = false;
                    }
                }
            }

            applyAutoWordWrap(enable) {
                if (enable) {
                    this.editor.style.whiteSpace = 'pre-wrap';
                    this.editor.style.wordWrap = 'break-word';
                    this.editor.style.overflowWrap = 'break-word';
                    document.body.classList.add('auto-word-wrap');
                } else {
                    this.editor.style.whiteSpace = 'pre';
                    this.editor.style.wordWrap = 'normal';
                    this.editor.style.overflowWrap = 'normal';
                    document.body.classList.remove('auto-word-wrap');
                }

                // Êõ¥Êñ∞Ë°åÂè∑ÊòæÁ§∫‰ª•ÈÄÇÂ∫îÊñ∞ÁöÑÊç¢Ë°åÊ®°Âºè
            }

            checkScreenSize() {
                // Âè™Âú®ÂêØÁî®‰∫ÜautoWordWrapÈÄâÈ°πÊó∂ÊâçÊ£ÄÊü•Â±èÂπïÂ∞∫ÂØ∏
                if (!this.autoWordWrap || !this.autoWordWrap.checked) return;

                const screenWidth = window.innerWidth;
                const enableWrap = screenWidth <= 768; // Â∞èÂ±èÂπïËá™Âä®ÂêØÁî®Êç¢Ë°å

                if (enableWrap !== this.currentWrapState) {
                    this.currentWrapState = enableWrap;
                    this.applyAutoWordWrap(enableWrap);
                }

                      }

          
            handleMarkdownAction(action) {
                const start = this.editor.selectionStart;
                const end = this.editor.selectionEnd;
                const selectedText = this.editor.value.substring(start, end);
                let replacement = '';
                let newCursorPos = start;

                switch (action) {
                    // EmojiÂäüËÉΩ - ‰øùÁïô
                    case 'emoji':
                        this.showEmojiModal();
                        return; // Áõ¥Êé•ËøîÂõûÔºå‰∏çÊâßË°åÂêéÁª≠ÊèíÂÖ•Êìç‰Ωú

                    // Âü∫Á°ÄÊ†ºÂºè
                    case 'bold':
                        replacement = `**${selectedText || 'Á≤ó‰ΩìÊñáÊú¨'}**`;
                        newCursorPos = start + (selectedText ? replacement.length : 2);
                        break;
                    case 'italic':
                        replacement = `*${selectedText || 'Êñú‰ΩìÊñáÊú¨'}*`;
                        newCursorPos = start + (selectedText ? replacement.length : 1);
                        break;
                    case 'strikethrough':
                        replacement = `~~${selectedText || 'Âà†Èô§Á∫øÊñáÊú¨'}~~`;
                        newCursorPos = start + (selectedText ? replacement.length : 2);
                        break;

                    // Ê†áÈ¢ò
                    case 'h1':
                        replacement = `# ${selectedText || '‰∏ÄÁ∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'h2':
                        replacement = `## ${selectedText || '‰∫åÁ∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'h3':
                        replacement = `### ${selectedText || '‰∏âÁ∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'h4':
                        replacement = `#### ${selectedText || 'ÂõõÁ∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'h5':
                        replacement = `##### ${selectedText || '‰∫îÁ∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'h6':
                        replacement = `###### ${selectedText || 'ÂÖ≠Á∫ßÊ†áÈ¢ò'}`;
                        newCursorPos = start + replacement.length;
                        break;

                    // ÂºïÁî®Âíå‰ª£Á†Å
                    case 'quote':
                        replacement = `> ${selectedText || 'ÂºïÁî®ÊñáÊú¨'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'code':
                        replacement = `\`${selectedText || '‰ª£Á†Å'}\``;
                        newCursorPos = start + (selectedText ? replacement.length : 1);
                        break;
                    case 'codeblock':
                        replacement = `\`\`\`${selectedText ? '\n' + selectedText + '\n' : ''}\n\`\`\``;
                        newCursorPos = start + (selectedText ? replacement.length - 4 : 4);
                        break;

                    // ÂàóË°®
                    case 'ul':
                        replacement = `- ${selectedText || 'ÂàóË°®È°π'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'ol':
                        replacement = `1. ${selectedText || 'ÂàóË°®È°π'}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'indent':
                        replacement = `    ${selectedText || ''}`;
                        newCursorPos = start + replacement.length;
                        break;
                    case 'outdent':
                        if (selectedText) {
                            // Â¶ÇÊûúÊúâÈÄâ‰∏≠ÊñáÊú¨ÔºåÁßªÈô§ÊØèË°åÂºÄÂ§¥ÁöÑÁº©Ëøõ
                            replacement = selectedText.replace(/^[ \t]+/gm, function(match) {
                                // ÁßªÈô§ÂºÄÂ§¥ÁöÑÊúÄÂ§ö4‰∏™Á©∫Ê†ºÊàñ1‰∏™Âà∂Ë°®Á¨¶
                                if (match.startsWith('\t')) {
                                    // ÁßªÈô§‰∏Ä‰∏™Âà∂Ë°®Á¨¶
                                    return match.substring(1);
                                } else {
                                    // ÁßªÈô§ÊúÄÂ§ö4‰∏™Á©∫Ê†º
                                    const spacesToRemove = Math.min(4, match.length);
                                    return match.substring(spacesToRemove);
                                }
                            });
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÈÄâ‰∏≠ÊñáÊú¨ÔºåÂ§ÑÁêÜÂΩìÂâçË°åÁöÑÁº©Ëøõ
                            const text = this.editor.value;
                            const lines = text.split('\n');

                            // ËÆ°ÁÆóÂÖâÊ†áÂú®Á¨¨Âá†Ë°å
                            let totalChars = 0;
                            let currentLineIndex = 0;
                            for (let i = 0; i < lines.length; i++) {
                                if (totalChars + lines[i].length >= start) {
                                    currentLineIndex = i;
                                    break;
                                }
                                // Âä†‰∏äÂΩìÂâçË°åÁöÑÂ≠óÁ¨¶Êï∞ÂíåÊç¢Ë°åÁ¨¶
                                totalChars += lines[i].length + 1;
                            }

                            // Ëé∑ÂèñÂΩìÂâçË°åÂÜÖÂÆπ
                            const currentLine = lines[currentLineIndex];

                            // Ê£ÄÊü•ÂΩìÂâçË°åÊòØÂê¶ÊúâÁº©Ëøõ
                            const indentMatch = currentLine.match(/^[ \t]+/);
                            if (indentMatch) {
                                const indent = indentMatch[0];
                                let newIndent;

                                // ÁßªÈô§Áº©Ëøõ
                                if (indent.startsWith('\t')) {
                                    // ÁßªÈô§‰∏Ä‰∏™Âà∂Ë°®Á¨¶
                                    newIndent = indent.substring(1);
                                } else {
                                    // ÁßªÈô§ÊúÄÂ§ö4‰∏™Á©∫Ê†º
                                    const spacesToRemove = Math.min(4, indent.length);
                                    newIndent = indent.substring(spacesToRemove);
                                }

                                // ÊûÑÂª∫Êñ∞Ë°å
                                const newLine = newIndent + currentLine.substring(indent.length);
                                lines[currentLineIndex] = newLine;

                                // Êõ¥Êñ∞ÁºñËæëÂô®ÂÜÖÂÆπ
                                this.editor.value = lines.join('\n');

                                // Êõ¥Êñ∞ÂÖâÊ†á‰ΩçÁΩÆ
                                // ËÆ°ÁÆóÂΩìÂâçË°åÂú®ÊñáÊú¨‰∏≠ÁöÑËµ∑Âßã‰ΩçÁΩÆ
                                let lineStartPos = 0;
                                for (let i = 0; i < currentLineIndex; i++) {
                                    lineStartPos += lines[i].length + 1;
                                }

                                // Êñ∞ÂÖâÊ†á‰ΩçÁΩÆ = Ë°åËµ∑Âßã‰ΩçÁΩÆ + Êñ∞Ë°åÈïøÂ∫¶
                                newCursorPos = lineStartPos + newLine.length;

                                // Êõ¥Êñ∞ÁªüËÆ°ÂíåÂéÜÂè≤
                                this.updateStats();
                                this.saveHistory();

                                // ÈáçÊñ∞ËÅöÁÑ¶ÁºñËæëÂô®Âπ∂ËÆæÁΩÆÂÖâÊ†á‰ΩçÁΩÆ
                                this.editor.focus();
                                this.editor.setSelectionRange(newCursorPos, newCursorPos);
                                return; // Áõ¥Êé•ËøîÂõûÔºåÂõ†‰∏∫Êàë‰ª¨Â∑≤ÁªèÂ§ÑÁêÜ‰∫ÜÊâÄÊúâÊìç‰Ωú
                            } else {
                                // ÂΩìÂâçË°åÊ≤°ÊúâÁº©ËøõÔºå‰∏çËøõË°åÊìç‰Ωú
                                return; // Áõ¥Êé•ËøîÂõû
                            }
                        }
                        newCursorPos = start + replacement.length;
                        break;

                    // ÈìæÊé•ÂíåÂ™í‰Ωì
                    case 'link':
                        replacement = `[${selectedText || 'ÈìæÊé•ÊñáÊú¨'}](URL)`;
                        newCursorPos = start + (selectedText ? replacement.length - 4 : 1); // Position at URL
                        break;
                    case 'image':
                        replacement = `![${selectedText || 'ÂõæÁâáÊèèËø∞'}](ÂõæÁâáURL)`;
                        newCursorPos = start + (selectedText ? replacement.length - 5 : 2); // Position at URL
                        break;

                    // Ë°®Ê†ºÂíåÂàÜÈöî
                    case 'table':
                        this.showTableModal();
                        return; // Áõ¥Êé•ËøîÂõûÔºå‰∏çÊâßË°åÂêéÁª≠ÊèíÂÖ•Êìç‰Ωú
                    case 'hr':
                        replacement = '---\n';
                        newCursorPos = start + replacement.length;
                        break;

                    // ËÑöÊ≥®
                    case 'footnote':
                        const footnoteId = Math.floor(Math.random() * 1000);
                        replacement = `${selectedText || 'ÊñáÊú¨'}[^${footnoteId}]\n\n[^${footnoteId}]: ËÑöÊ≥®ÂÜÖÂÆπ`;
                        newCursorPos = start + replacement.length;
                        break;
                }

                this.editor.value = this.editor.value.substring(0, start) + replacement + this.editor.value.substring(end);
                this.editor.focus();
                this.editor.setSelectionRange(newCursorPos, newCursorPos);

                this.updateStats();
                this.saveHistory();
            }

            removeBlankChars() {
                const text = this.editor.value;
                const originalLength = text.length;

                // Âà†Èô§ÂêÑÁßçÁ©∫ÁôΩÂ≠óÁ¨¶‰ΩÜ‰øùÁïôÂçïËØçÈó¥ÁöÑÂçï‰∏™Á©∫Ê†º
                const cleanedText = text
                    .replace(/\s+/g, ' ') // Â§ö‰∏™Á©∫ÁôΩÂ≠óÁ¨¶ÔºàÂåÖÊã¨Á©∫Ê†º„ÄÅÂà∂Ë°®Á¨¶„ÄÅÊç¢Ë°åÁ¨¶Á≠âÔºâÂêàÂπ∂‰∏∫‰∏Ä‰∏™Á©∫Ê†º
                    .replace(/^[ ]+|[ ]+$/gm, '') // Âà†Èô§Ë°åÈ¶ñË°åÂ∞æÁ©∫Ê†º
                    .replace(/\n[ ]+\n/g, '\n\n') // Ê∏ÖÁêÜÂè™ÊúâÁ©∫Ê†ºÁöÑË°å
                    .replace(/[ ]+\n/g, '\n') // Âà†Èô§Ë°åÂ∞æÁ©∫Ê†º
                    .replace(/\n[ ]+/g, '\n'); // Âà†Èô§Ë°åÈ¶ñÁ©∫Ê†º

                this.editor.value = cleanedText;
                this.updateStats();
                this.saveHistory();

                const removedChars = originalLength - cleanedText.length;
                this.showMessage('Ê∏ÖÁêÜÂÆåÊàê', `Â∑≤Âà†Èô§ ${removedChars} ‰∏™Á©∫ÁôΩÂ≠óÁ¨¶`);
            }

            removeTabs() {
                const text = this.editor.value;
                const originalLength = text.length;

                // Âà†Èô§ÊâÄÊúâÂà∂Ë°®Á¨¶
                const cleanedText = text.replace(/\t/g, '');

                this.editor.value = cleanedText;
                this.updateStats();
                this.saveHistory();

                const removedTabs = originalLength - cleanedText.length;
                this.showMessage('Ê∏ÖÁêÜÂÆåÊàê', `Â∑≤Âà†Èô§ ${removedTabs} ‰∏™Âà∂Ë°®Á¨¶`);
            }

            normalizeLines() {
                const text = this.editor.value;

                // Áªü‰∏ÄÊç¢Ë°åÁ¨¶‰∏∫ \n Âπ∂Âà†Èô§Â§ö‰ΩôÁ©∫Ë°å
                const normalizedText = text
                    .replace(/\r\n/g, '\n') // Windows Êç¢Ë°åÁ¨¶ËΩ¨ Unix
                    .replace(/\r/g, '\n')   // Mac Êç¢Ë°åÁ¨¶ËΩ¨ Unix
                    .replace(/\n{3,}/g, '\n\n') // Â§ö‰∏™ËøûÁª≠Á©∫Ë°åÂêàÂπ∂‰∏∫‰∏§‰∏™
                    .replace(/^\n+|\n+$/g, ''); // ÂºÄÂ§¥ÂíåÁªìÂ∞æÁöÑÁ©∫Ë°å

                this.editor.value = normalizedText;
                this.updateStats();
                this.saveHistory();

                this.showMessage('ËßÑËåÉÂåñÂÆåÊàê', 'Êç¢Ë°åÁ¨¶Â∑≤ËßÑËåÉÂåñ');
            }

                // Á≤æÁ°ÆÂêåÊ≠•ÊªöÂä®‰ΩçÁΩÆ

            toggleFullscreen() {
                if (document.fullscreenElement) {
                    // ÈÄÄÂá∫ÂÖ®Â±è
                    document.exitFullscreen().then(() => {
                        document.body.classList.remove('fullscreen');
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = false;
                        }
                    }).catch((err) => {
                        console.error('ÈÄÄÂá∫ÂÖ®Â±èÂ§±Ë¥•:', err);
                        // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÁßªÈô§CSSÁ±ª
                        document.body.classList.remove('fullscreen');
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = false;
                        }
                    });
                } else {
                    // ËøõÂÖ•ÂÖ®Â±è
                    document.documentElement.requestFullscreen().then(() => {
                        document.body.classList.add('fullscreen');
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = true;
                        }
                    }).catch((err) => {
                        console.error('ËøõÂÖ•ÂÖ®Â±èÂ§±Ë¥•:', err);
                        // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÊ∑ªÂä†CSSÁ±ª
                        document.body.classList.add('fullscreen');
                        // ÂêåÊ≠•Êõ¥Êñ∞Â§çÈÄâÊ°ÜÁä∂ÊÄÅ
                        if (this.enableFullscreen) {
                            this.enableFullscreen.checked = true;
                        }
                    });
                }
            }

            // Ê∑ªÂä†ÂÅèÂ•ΩËÆæÁΩÆÂÆûÊó∂ÁõëÂê¨Âô®
            addPreferenceListeners() {
                console.log('üéß addPreferenceListeners started');
                // Ëé∑ÂèñÊâÄÊúâËÆæÁΩÆÈ°π
                const preferenceElements = [
                    this.showWordCount, this.showCharCount,
                    this.showLineCount, this.showColCount, this.showSelectedCount, this.showPositionPercent, this.showDateTime,
                    this.markdownMode, this.autoWordWrap, this.enableFullscreen,
                    this.showGrid
                ];

                console.log('üìã Preference elements found:', preferenceElements.map(el => el ? el.id : 'null'));

                // ‰∏∫ÊØè‰∏™ËÆæÁΩÆÈ°πÊ∑ªÂä†change‰∫ã‰ª∂ÁõëÂê¨Âô®
                preferenceElements.forEach((element, index) => {
                    if (element) {
                        console.log(`‚úÖ Adding listener to ${element.id}`);
                        element.addEventListener('change', () => {
                            console.log(`üîÑ Preference changed: ${element.id}`);
                            this.saveAndApplyPreferences();
                        });
                    } else {
                        console.log(`‚ùå Preference element ${index} is null`);
                    }
                });
                
                // ‰∏∫Â∫ïÈÉ®ËæπË∑ùÊªëÂùóÊ∑ªÂä†input‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÂÆûÊó∂Êõ¥Êñ∞Ôºâ
                if (this.bottomMarginSlider) {
                    this.bottomMarginSlider.addEventListener('input', () => {
                        // ÂÆûÊó∂Êõ¥Êñ∞ÊòæÁ§∫ÂÄº
                        if (this.bottomMarginValue) {
                            this.bottomMarginValue.textContent = this.bottomMarginSlider.value;
                        }
                        // ÂÆûÊó∂Ë∞ÉÊï¥ÁºñËæëÂô®Â∫ïÈÉ®ËæπË∑ù
                        this.adjustEditorPadding();
                    });
                    
                    // ‰∏∫ÊªëÂùóÊ∑ªÂä†change‰∫ã‰ª∂ÁõëÂê¨Âô®Ôºà‰øùÂ≠òËÆæÁΩÆÔºâ
                    this.bottomMarginSlider.addEventListener('change', () => {
                        console.log(`üîÑ Bottom margin changed: ${this.bottomMarginSlider.value}`);
                        this.saveAndApplyPreferences();
                    });
                }
                
                console.log('‚úÖ addPreferenceListeners completed');
            }

            // ‰øùÂ≠òÂπ∂Â∫îÁî®ÂÅèÂ•ΩËÆæÁΩÆÔºàÊñ∞ÁöÑÁÆÄÂåñÊñπÊ≥ïÔºâ
            saveAndApplyPreferences() {
                const preferences = {
                    showWordCount: this.showWordCount.checked,
                    showCharCount: this.showCharCount.checked,
                    showLineCount: this.showLineCount.checked,
                    showColCount: this.showColCount.checked,
                    showSelectedCount: this.showSelectedCount.checked,
                    showPositionPercent: this.showPositionPercent.checked,
                    showDateTime: this.showDateTime.checked,
                    markdownMode: this.markdownMode.checked,
                    autoWordWrap: this.autoWordWrap.checked,
                    enableFullscreen: this.enableFullscreen.checked,
                    showGrid: this.showGrid.checked,
                    bottomMargin: this.bottomMarginSlider ? this.bottomMarginSlider.value : 175
                };

                // Á´ãÂç≥‰øùÂ≠òÂà∞localStorage
                localStorage.setItem('notepad-preferences', JSON.stringify(preferences));

                // Â∫îÁî®ËÆæÁΩÆ‰ΩÜ‰∏çÈáçÂ§çÊõ¥Êñ∞Áä∂ÊÄÅÊ†èÂèØËßÅÊÄßÂ≠òÂÇ®ÔºàÈÅøÂÖçÂæ™ÁéØÔºâ
                this.applyPreferencesWithoutStatusBarUpdate(preferences);
            }

            // Â∫îÁî®ÂÅèÂ•ΩËÆæÁΩÆ‰ΩÜ‰∏çÊõ¥Êñ∞Áä∂ÊÄÅÊ†èÂèØËßÅÊÄßÂ≠òÂÇ®ÔºàÈÅøÂÖçÂæ™ÁéØË∞ÉÁî®Ôºâ
            applyPreferencesWithoutStatusBarUpdate(preferences) {
                // Apply status bar item visibility using the original initialized element references
                const applyElementVisibility = (element, preferenceValue, logName) => {
                    if (element) {
                        // Log for debugging
                        console.log(`Setting ${logName} visibility: ${preferenceValue}`);

                        if (preferenceValue === false) {
                            // ‰ΩøÁî®Êõ¥Âº∫Âà∂ÁöÑÊñπÂºèÈöêËóèÂÖÉÁ¥†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè‰∏≠ÁöÑ !important
                            element.style.display = 'none';
                        } else {
                            // ÊÅ¢Â§çÊòæÁ§∫ÔºåÁßªÈô§ÈÄöËøá‰ª£Á†ÅÊ∑ªÂä†ÁöÑ display Ê†∑Âºè
                            element.style.display = '';
                            // Â¶ÇÊûú‰πãÂâçÊúâ hidden Á±ªÔºå‰πüÁßªÈô§ÂÆÉ
                            element.classList.remove('hidden');
                        }
                    } else {
                        console.warn(`Element for ${logName} not found`);
                    }
                };

                // Apply to each status bar element using original references
                applyElementVisibility(this.charCount, preferences.showCharCount, 'charCount');
                applyElementVisibility(this.wordCount, preferences.showWordCount, 'wordCount');
                applyElementVisibility(this.lineCount, preferences.showLineCount, 'lineCount');
                applyElementVisibility(this.selectedCount, preferences.showSelectedCount, 'selectedCount');
                applyElementVisibility(this.colCount, preferences.showColCount, 'colCount');
                applyElementVisibility(this.positionPercent, preferences.showPositionPercent, 'positionPercent');

                // Special handling for datetime display
                if (this.dateTimeDisplay) {
                    if (preferences.showDateTime === false) {
                        // ‰ΩøÁî®Êõ¥Âº∫Âà∂ÁöÑÊñπÂºèÈöêËóèÂÖÉÁ¥†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè‰∏≠ÁöÑ !important
                        this.dateTimeDisplay.style.display = 'none';
                        // ÂÅúÊ≠¢Êó∂Èó¥Êõ¥Êñ∞‰ª•ËäÇÁúÅËµÑÊ∫ê
                        if (this.timeUpdateInterval) {
                            clearInterval(this.timeUpdateInterval);
                            this.timeUpdateInterval = null;
                        }
                    } else {
                        // ÊÅ¢Â§çÊòæÁ§∫ÔºåÁßªÈô§ÈÄöËøá‰ª£Á†ÅÊ∑ªÂä†ÁöÑ display Ê†∑Âºè
                        this.dateTimeDisplay.style.display = '';
                        // Â¶ÇÊûú‰πãÂâçÊúâ hidden Á±ªÔºå‰πüÁßªÈô§ÂÆÉ
                        this.dateTimeDisplay.classList.remove('hidden');
                        // Á°Æ‰øùÊó∂Èó¥Êõ¥Êñ∞Â∑≤ÂêØÂä®
                        if (!this.timeUpdateInterval) {
                            this.startTimeUpdate();
                        }
                    }
                }

                // Markdown mode
                if (preferences.markdownMode) {
                    if (this.markdownToolbar.classList.contains('collapsed')) {
                        this.markdownToolbar.classList.remove('collapsed');
                    }
                    document.body.classList.add('markdown-visible');
                } else {
                    if (!this.markdownToolbar.classList.contains('collapsed')) {
                        this.markdownToolbar.classList.add('collapsed');
                    }
                    document.body.classList.remove('markdown-visible');
                }

                // Auto word wrap functionality
                this.applyAutoWordWrap(preferences.autoWordWrap);
                // Update screen size after applying auto word wrap
                this.checkScreenSize();

                // Grid background display
                const editorWrapper = this.editor?.parentElement || document.querySelector('.editor-wrapper');

                if (editorWrapper) {
                    if (preferences.showGrid) {
                        editorWrapper.classList.add('show-grid');
                        // ÁßªÈô§ÁºñËæëÂô®ÂÖÉÁ¥†ÁöÑÂÜÖËÅîËÉåÊôØÊ†∑ÂºèÔºåËÆ©CSSÊ†∑ÂºèÁîüÊïà
                        if (this.editor) {
                            this.editor.style.backgroundImage = '';
                        }
                    } else {
                        editorWrapper.classList.remove('show-grid');
                        // ÊòéÁ°ÆËÆæÁΩÆÁºñËæëÂô®ËÉåÊôØ‰∏∫Êó†ÔºåË¶ÜÁõñÂÜÖËÅîÊ†∑Âºè
                        if (this.editor) {
                            this.editor.style.backgroundImage = 'none';
                        }
                    }
                }

                // Fullscreen mode
                if (preferences.enableFullscreen) {
                    // ÂêØÁî®ÂÖ®Â±èÊ®°Âºè
                    if (!document.fullscreenElement && !document.body.classList.contains('fullscreen')) {
                        // Âè™ÊúâÂú®ÂΩìÂâç‰∏çÊòØÂÖ®Â±èÁä∂ÊÄÅÊó∂ÊâçËøõÂÖ•ÂÖ®Â±è
                        document.documentElement.requestFullscreen().catch((err) => {
                            console.warn('ËøõÂÖ•ÂÖ®Â±èÂ§±Ë¥•:', err);
                            // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÊ∑ªÂä†CSSÁ±ª
                            document.body.classList.add('fullscreen');
                        });
                    }
                } else {
                    // Á¶ÅÁî®ÂÖ®Â±èÊ®°Âºè
                    if (document.fullscreenElement) {
                        // Â¶ÇÊûúÂΩìÂâçÊòØÂÖ®Â±èÁä∂ÊÄÅÔºåÂàôÈÄÄÂá∫ÂÖ®Â±è
                        document.exitFullscreen().catch((err) => {
                            console.warn('ÈÄÄÂá∫ÂÖ®Â±èÂ§±Ë¥•:', err);
                            // Âç≥‰ΩøÊµèËßàÂô®ÂÖ®Â±èAPIÂ§±Ë¥•Ôºå‰πüË¶ÅÁßªÈô§CSSÁ±ª
                            document.body.classList.remove('fullscreen');
                        });
                    } else {
                        // Â¶ÇÊûúÂΩìÂâç‰∏çÊòØÂÖ®Â±èÁä∂ÊÄÅÔºå‰ΩÜCSSÁ±ªÂ≠òÂú®ÔºåÂàôÁßªÈô§ÂÆÉ
                        document.body.classList.remove('fullscreen');
                    }
                }
            }



            updateDateTime() {
                if (this.dateTimeDisplay) {
                    const now = new Date();
                    const time = now.toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    const date = now.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    });
                    this.dateTimeDisplay.textContent = `${date} ${time}`;
                }
            }

            startTimeUpdate() {
                if (this.dateTimeDisplay) {
                    // Â¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®ÂÆöÊó∂Âô®ÔºåÂÖàÊ∏ÖÈô§ÂÆÉ
                    if (this.timeUpdateInterval) {
                        clearInterval(this.timeUpdateInterval);
                    }
                    // Á´ãÂç≥Êõ¥Êñ∞‰∏ÄÊ¨°
                    this.updateDateTime();
                    // ÊØèÁßíÊõ¥Êñ∞Êó∂Èó¥
                    this.timeUpdateInterval = setInterval(() => {
                        this.updateDateTime();
                    }, 1000);
                }
            }

            // EmojiÈÄâÊã©Âô®Áõ∏ÂÖ≥ÊñπÊ≥ï
            initEmojiData() {
                // EmojiÊï∞ÊçÆÂàÜÁ±ª
                this.emojiCategories = {
                    smileys: {
                        name: 'Â∏∏Áî®',
                        emojis: ['üòÄ', 'üòÅ', 'üòÇ', 'ü§£', 'üòÉ', 'üòÑ', 'üòÖ', 'üòÜ', 'üòâ', 'üòä', 'üòã', 'üòé', 'üòç', 'üòò', 'ü•∞', 'üòó', 'üòô', 'üòö', 'üôÇ', 'ü§ó', 'ü§©', 'ü§î', 'ü§®', 'üòê', 'üòë', 'üò∂', 'üôÑ', 'üòè', 'üò£', 'üò•', 'üòÆ', 'ü§ê', 'üòØ', 'üò™', 'üò´', 'üò¥', 'üòå', 'üòõ', 'üòú', 'üòù', 'ü§§', 'üòí', 'üòì', 'üòî', 'üòï', 'üôÉ', 'ü§ë', 'üò≤', '‚òπÔ∏è', 'üôÅ', 'üòñ', 'üòû', 'üòü', 'üò§', 'üò¢', 'üò≠', 'üò¶', 'üòß', 'üò®', 'üò©', 'ü§Ø', 'üò¨', 'üò∞', 'üò±', 'ü•µ', 'ü•∂', 'üò≥', 'ü•∫', 'üòµ', 'üò°', 'üò†', 'ü§¨', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 'ü•±', 'ü•¥', 'üòé', 'ü§ì', 'üßê', 'üòï', 'üòü', 'üôÅ', '‚òπÔ∏è', 'üòÆ', 'üòØ', 'üò≤', 'üò≥', 'ü•∫', 'üò¶', 'üòß', 'üò®', 'üò∞', 'üò•', 'üò¢', 'üò≠', 'üò±', 'üòñ', 'üò£', 'üòû', 'üòì', 'üò©', 'üò´', 'ü•±', 'üò§', 'üò°', 'üò†', 'ü§¨', 'üòà', 'üëø', 'üíÄ', '‚ò†Ô∏è', 'üí©', 'ü§°', 'üëπ', 'üë∫', 'üëª', 'üëΩ', 'üëæ', 'ü§ñ', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üëç', 'üëé', 'üëå', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üëá', '‚òùÔ∏è', '‚úã', 'ü§ö', 'üñê', 'üññ', 'üëã', 'ü§è', '‚úçÔ∏è', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè']
                    },
                    people: {
                        name: '‰∫∫Áâ©',
                        emojis: ['üë∂', 'üëß', 'üßí', 'üë¶', 'üë©', 'üßë', 'üë±', 'üë®', 'üßî', 'üë±‚Äç‚ôÄÔ∏è', 'üë±‚Äç‚ôÇÔ∏è', 'üßì', 'üë¥', 'üëµ', 'üôç', 'üôç‚Äç‚ôÄÔ∏è', 'üôç‚Äç‚ôÇÔ∏è', 'üôé', 'üôé‚Äç‚ôÄÔ∏è', 'üôé‚Äç‚ôÇÔ∏è', 'üôÖ', 'üôÖ‚Äç‚ôÄÔ∏è', 'üôÖ‚Äç‚ôÇÔ∏è', 'üôÜ', 'üôÜ‚Äç‚ôÄÔ∏è', 'üôÜ‚Äç‚ôÇÔ∏è', 'üíÅ', 'üíÅ‚Äç‚ôÄÔ∏è', 'üíÅ‚Äç‚ôÇÔ∏è', 'üôã', 'üôã‚Äç‚ôÄÔ∏è', 'üôã‚Äç‚ôÇÔ∏è', 'üßè', 'üßè‚Äç‚ôÄÔ∏è', 'üßè‚Äç‚ôÇÔ∏è', 'üôá', 'üôá‚Äç‚ôÄÔ∏è', 'üôá‚Äç‚ôÇÔ∏è', 'ü§¶', 'ü§¶‚Äç‚ôÄÔ∏è', 'ü§¶‚Äç‚ôÇÔ∏è', 'ü§∑', 'ü§∑‚Äç‚ôÄÔ∏è', 'ü§∑‚Äç‚ôÇÔ∏è', 'üßë‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üßë‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'üßë‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äçüè´', 'üßë‚Äç‚öñÔ∏è', 'üë®‚Äç‚öñÔ∏è', 'üë©‚Äç‚öñÔ∏è', 'üßë‚Äçüåæ', 'üë®‚Äçüåæ', 'üë©‚Äçüåæ', 'üßë‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüç≥', 'üßë‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüîß', 'üßë‚Äçüè≠', 'üë®‚Äçüè≠', 'üë©‚Äçüè≠', 'üßë‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üßë‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüî¨', 'üßë‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚Äçüíª', 'üßë‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüé§', 'üßë‚Äçüé®', 'üë®‚Äçüé®', 'üë©‚Äçüé®', 'üßë‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è', 'üë©‚Äç‚úàÔ∏è', 'üßë‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚ÄçüöÄ', 'üßë‚Äçüöí', 'üë®‚Äçüöí', 'üë©‚Äçüöí', 'üëÆ', 'üëÆ‚Äç‚ôÄÔ∏è', 'üëÆ‚Äç‚ôÇÔ∏è', 'üïµÔ∏è', 'üïµÔ∏è‚Äç‚ôÄÔ∏è', 'üïµÔ∏è‚Äç‚ôÇÔ∏è', 'üíÇ', 'üíÇ‚Äç‚ôÄÔ∏è', 'üíÇ‚Äç‚ôÇÔ∏è', 'ü•∑', 'üë∑', 'üë∑‚Äç‚ôÄÔ∏è', 'üë∑‚Äç‚ôÇÔ∏è', 'ü§¥', 'üë∏', 'üë≥', 'üë≥‚Äç‚ôÄÔ∏è', 'üë≥‚Äç‚ôÇÔ∏è', 'üë≤', 'üßï', 'ü§µ', 'ü§µ‚Äç‚ôÄÔ∏è', 'ü§µ‚Äç‚ôÇÔ∏è', 'üë∞', 'üë∞‚Äç‚ôÄÔ∏è', 'üë∞‚Äç‚ôÇÔ∏è', 'ü§∞', 'ü§±', 'üë©‚Äçüçº', 'üë®‚Äçüçº', 'üßë‚Äçüçº', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'üßë‚Äçüéì', 'üë©‚Äçüè´', 'üë®‚Äçüè´', 'üßë‚Äçüè´', 'üë©‚Äçüåæ', 'üë®‚Äçüåæ', 'üßë‚Äçüåæ', 'üë©‚Äçüç≥', 'üë®‚Äçüç≥', 'üßë‚Äçüç≥', 'üë©‚Äçüîß', 'üë®‚Äçüîß', 'üßë‚Äçüîß', 'üë©‚Äçüè≠', 'üë®‚Äçüè≠', 'üßë‚Äçüè≠', 'üë©‚Äçüíº', 'üë®‚Äçüíº', 'üßë‚Äçüíº', 'üë©‚Äçüíª', 'üë®‚Äçüíª', 'üßë‚Äçüíª', 'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üßë‚Äçüé§', 'üë©‚Äçüé®', 'üë®‚Äçüé®', 'üßë‚Äçüé®', 'üë©‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è', 'üßë‚Äç‚úàÔ∏è', 'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üßë‚ÄçüöÄ', 'üë©‚Äçüöí', 'üë®‚Äçüöí', 'üßë‚Äçüöí']
                    },
                    animals: {
                        name: 'Âä®Áâ©',
                        emojis: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üêª‚Äç‚ùÑÔ∏è', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü¶ü', 'ü¶ó', 'üï∑', 'üï∏', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'ü¶£', 'üêò', 'ü¶õ', 'ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï', 'üê©', 'ü¶à', 'ü¶ê', 'ü¶ë', 'üêÄ', 'üêÅ', 'üêøÔ∏è', 'ü¶î', 'üêá', 'üêÅ', 'üêÄ', 'ü¶´', 'ü¶¶', 'ü¶•']
                    },
                    food: {
                        name: 'È£üÁâ©',
                        emojis: ['üçé', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'ü´ê', 'üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶', 'ü•¨', 'ü•í', 'üå∂Ô∏è', 'ü´ë', 'üåΩ', 'ü•ï', 'ü´í', 'üßÑ', 'üßÖ', 'ü•î', 'üç†', 'ü•ê', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥', 'üßà', 'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü´ì', 'ü•™', 'ü•ô', 'üßÜ', 'üåÆ', 'üåØ', 'ü´î', 'ü•ó', 'ü•ò', 'ü´ï', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üç©', 'üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', '‚òï', 'ü´ñ', 'üçµ', 'üç∂', 'üçæ', 'üç∑', 'üç∏', 'üçπ', 'üç∫', 'üçª', 'ü•Ç', 'ü•É', 'ü•§', 'üßã', 'üßÉ', 'üßâ', 'üßä', 'ü•¢', 'üçΩÔ∏è', 'üç¥', 'ü•Ñ', 'üî™', 'üè∫']
                    },
                    activities: {
                        name: 'Ê¥ªÂä®',
                        emojis: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü•Ö', '‚õ≥', 'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõ∑', '‚õ∏Ô∏è', 'ü•å', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'ü™Ç', 'üèãÔ∏è', 'ü§º', 'ü§∏', 'ü§∫', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üö¥', 'üöµ', 'üé™', 'üé≠', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'ü™ò', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'ü™ó', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥', 'üéÆ', 'üé∞', 'üß©']
                    },
                    travel: {
                        name: 'ÊóÖË°å',
                        emojis: ['üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèéÔ∏è', 'üöì', 'üöë', 'üöí', 'üöê', 'üõª', 'üöö', 'üöõ', 'üöú', 'üèçÔ∏è', 'üõµ', 'üö≤', 'üõ¥', 'üõπ', 'üõº', 'üöÅ', 'üõ∏', 'üöÄ', '‚úàÔ∏è', 'üõ©Ô∏è', 'üõ´', 'üõ¨', 'ü™Ç', 'üí∫', 'üöÇ', 'üöÜ', 'üöÑ', 'üöÖ', 'üöà', 'üöù', 'üöû', 'üöã', 'üöå', 'üöç', 'üöé', 'üöê', 'üöë', 'üöí', 'üöì', 'üöî', 'üöï', 'üöñ', 'üöó', 'üöò', 'üöô', 'üõª', 'üöö', 'üöõ', 'üöú', 'üèéÔ∏è', 'üèçÔ∏è', 'üõµ', 'üö≤', 'üõ¥', 'üõπ', 'üõº', 'üö°', 'üö†', 'üöü', 'üöÉ', 'üöã', 'üöû', 'üöù', 'üöÑ', 'üöÖ', 'üöà', 'üöÇ', 'üöÜ', 'üöá', 'üöä', 'üöâ', 'üöÅ', 'üõ∏', 'üöÄ', '‚úàÔ∏è', 'üõ©Ô∏è', 'üõ´', 'üõ¨', 'ü™Ç', 'üí∫', '‚öì', '‚õµ', 'üõ∂', 'üö§', 'üõ≥Ô∏è', '‚õ¥Ô∏è', 'üõ•Ô∏è', 'üö¢', '‚öì', 'ü™ù', '‚õΩ', 'üöß', 'üö¶', 'üö•', 'üö®', 'üöè', 'üó∫Ô∏è', 'üóø', 'üóΩ', 'üóº', 'üè∞', 'üèØ', 'üèüÔ∏è', 'üé°', 'üé¢', 'üé†', '‚õ≤', '‚õ∫', 'üè†', 'üè°', 'üèòÔ∏è', 'üèöÔ∏è', 'üèóÔ∏è', 'üè≠', 'üè¢', 'üè¨', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®', 'üè™', 'üè´', 'üè©', 'üíí', 'üèõÔ∏è', '‚õ™', 'üïå', 'üïç', 'üõï', 'üïã', '‚õ©Ô∏è', 'üõ§Ô∏è', 'üõ£Ô∏è', 'üóæ', 'üéë', 'üèûÔ∏è', 'üåÖ', 'üåÑ', 'üå†', 'üéá', 'üéÜ', 'üåá', 'üåÜ', 'üèôÔ∏è', 'üåÉ', 'üåå', 'üåâ', 'üåÅ']
                    },
                    objects: {
                        name: 'Áâ©ÂìÅ',
                        emojis: ['‚åö', 'üì±', 'üì≤', 'üíª', '‚å®Ô∏è', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è', 'üñ≤Ô∏è', 'üïπÔ∏è', 'üóúÔ∏è', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üìº', 'üì∑', 'üì∏', 'üìπ', 'üé•', 'üìΩÔ∏è', 'üéûÔ∏è', 'üìû', '‚òéÔ∏è', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéôÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', 'üß≠', '‚è±Ô∏è', '‚è≤Ô∏è', '‚è∞', 'üï∞Ô∏è', '‚åõ', '‚è≥', 'üì°', 'üîã', 'üîå', 'üí°', 'üî¶', 'üïØÔ∏è', 'ü™î', 'üßØ', 'üõ¢Ô∏è', 'üí∏', 'üíµ', 'üí¥', 'üí∂', 'üí∑', 'üí∞', 'üí≥', 'üíé', '‚öñÔ∏è', 'üß∞', 'üîß', 'üî®', '‚öíÔ∏è', 'üõ†Ô∏è', '‚õèÔ∏è', 'üî©', '‚öôÔ∏è', 'üß±', '‚õìÔ∏è', 'üß≤', 'üî´', 'üí£', 'üß®', 'ü™ì', 'üî™', 'üó°Ô∏è', '‚öîÔ∏è', 'üõ°Ô∏è', 'üö¨', '‚ö∞Ô∏è', '‚ö±Ô∏è', 'üè∫', 'üîÆ', 'üìø', 'üßø', 'üíà', '‚öóÔ∏è', 'üî≠', 'üî¨', 'üï≥Ô∏è', 'ü©π', 'ü©∫', 'üíä', 'üíâ', 'ü©∏', 'üß¨', 'ü¶†', 'üß´', 'üß™', 'üå°Ô∏è', 'üßπ', 'üß∫', 'üßª', 'üöΩ', 'üö∞', 'üöø', 'üõÅ', 'üõÄ', 'üßº', 'ü™í', 'üßΩ', 'üß¥', 'üõéÔ∏è', 'üîë', 'üóùÔ∏è', 'üö™', 'ü™ë', 'üõãÔ∏è', 'üõèÔ∏è', 'üõå', 'üß∏', 'üñºÔ∏è', 'üõçÔ∏è', 'üéÅ', 'üéà', 'üéè', 'üéÄ', 'üéä', 'üéâ', 'üéé', 'üèÆ', 'üéê', 'üßß', '‚úâÔ∏è', 'üì©', 'üì®', 'üìß', 'üíå', 'üì•', 'üì§', 'üì¶', 'üè∑Ô∏è', 'üì™', 'üì´', 'üì¨', 'üì≠', 'üìÆ', 'üìØ', 'üìú', 'üìÉ', 'üìÑ', 'üìë', 'üßæ', 'üìä', 'üìà', 'üìâ', 'üóíÔ∏è', 'üóìÔ∏è', 'üìÜ', 'üìÖ', 'üóëÔ∏è', 'üìá', 'üóÉÔ∏è', 'üó≥Ô∏è', 'üóÑÔ∏è', 'üìã', 'üìÅ', 'üìÇ', 'üóÇÔ∏è', 'üóûÔ∏è', 'üì∞', 'üìì', 'üìî', 'üìí', 'üìï', 'üìó', 'üìò', 'üìô', 'üìö', 'üìñ', 'üîñ', 'üß∑', 'üîó', 'üìé', 'üñáÔ∏è', 'üìê', 'üìè', 'üßÆ', 'üìå', 'üìç', '‚úÇÔ∏è', 'üñäÔ∏è', 'üñãÔ∏è', '‚úíÔ∏è', 'üñåÔ∏è', 'üñçÔ∏è', 'üìù', '‚úèÔ∏è', 'üîç', 'üîé', 'üîè', 'üîê', 'üîí', 'üîì']
                    },
                    symbols: {
                        name: 'Á¨¶Âè∑',
                        emojis: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üëç', 'üëé', 'üëå', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üëá', '‚òùÔ∏è', '‚úã', 'ü§ö', 'üñê', 'üññ', 'üëã', 'ü§è', '‚úçÔ∏è', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', '‚òÆÔ∏è', '‚úùÔ∏è', '‚ò™Ô∏è', 'üïâÔ∏è', '‚ò∏Ô∏è', '‚ú°Ô∏è', 'üîØ', 'üïé', '‚òØÔ∏è', '‚ò¶Ô∏è', 'üõê', '‚õé', '‚ôà', '‚ôâ', '‚ôä', '‚ôã', '‚ôå', '‚ôç', '‚ôé', '‚ôè', '‚ôê', '‚ôë', '‚ôí', '‚ôì', 'üÜî', '‚öõÔ∏è', 'üâë', '‚ò¢Ô∏è', '‚ò£Ô∏è', 'üì¥', 'üì≥', 'üà∂', 'üàö', 'üà∏', 'üà∫', 'üà∑Ô∏è', '‚ú¥Ô∏è', 'üÜö', 'üíÆ', 'üâê', '„äôÔ∏è', '„äóÔ∏è', 'üà¥', 'üàµ', 'üàπ', 'üà≤', 'üÖ∞Ô∏è', 'üÖ±Ô∏è', 'üÜé', 'üÜë', 'üÖæÔ∏è', 'üÜò', '‚ùå', '‚≠ï', 'üõë', '‚õî', 'üìõ', 'üö´', 'üíØ', 'üí¢', '‚ô®Ô∏è', 'üö∑', 'üöØ', 'üö≥', 'üö±', 'üîû', 'üìµ', 'üö≠', '‚ùó', '‚ùï', '‚ùì', '‚ùî', '‚ÄºÔ∏è', '‚ÅâÔ∏è', 'üîÖ', 'üîÜ', '„ÄΩÔ∏è', '‚ö†Ô∏è', 'üö∏', 'üî±', '‚öúÔ∏è', 'üî∞', '‚ôªÔ∏è', '‚úÖ', 'üàØ', 'üíπ', '‚ùáÔ∏è', '‚ú≥Ô∏è', '‚ùé', 'üåê', 'üí†', '‚ìÇÔ∏è', 'üåÄ', 'üí§', 'üèß', 'üöæ', '‚ôø', 'üÖøÔ∏è', 'üà≥', 'üàÇÔ∏è', 'üõÇ', 'üõÉ', 'üõÑ', 'üõÖ', 'üöπ', 'üö∫', 'üöº', 'üöª', 'üöÆ', 'üé¶', 'üì∂', 'üàÅ', 'üî£', '‚ÑπÔ∏è', 'üî§', 'üî°', 'üî†', 'üÜñ', 'üó£Ô∏è', 'üë§', 'üë•', 'ü´Ç', 'üë£', 'üöÄ', 'üõ∞Ô∏è', 'üõ∏', 'üõéÔ∏è', 'üß≥', '‚åõ', '‚è≥', '‚åö', '‚è∞', '‚è±Ô∏è', '‚è≤Ô∏è', 'üå°Ô∏è', 'üó∫Ô∏è', 'üß≠', 'üéÉ', 'üéÑ', 'üéÜ', 'üéá', 'üß®', '‚ú®', 'üéà', 'üéâ', 'üéä', 'üéã', 'üéç', 'üéé', 'üéè', 'üéê', 'üéë', 'üßß', 'üéóÔ∏è', 'üéüÔ∏è', 'üé´', 'üéñÔ∏è', 'üèÜ', 'üèÖ', 'ü•á', 'ü•à', 'ü•â', '‚öΩ', '‚öæ', 'ü•é', 'üèÄ', 'üèê', 'üèà', 'üèâ', 'üéæ', 'ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü•Ö', '‚õ≥', 'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõ∑', '‚õ∏Ô∏è', 'ü•å', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'ü™Ç', 'üèãÔ∏è', 'ü§º', 'ü§∏', 'ü§∫', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üö¥', 'üöµ', 'üé™', 'ü§π', 'üé≠', 'ü©∞', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'ü™ò', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'ü™ó', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥', 'üéÆ', 'üé∞', 'üß©']
                    },
                    flags: {
                        name: 'ÂõΩÊóó',
                        emojis: ['üè≥Ô∏è', 'üè¥', 'üèÅ', 'üö©', 'üè≥Ô∏è‚Äçüåà', 'üè≥Ô∏è‚Äç‚ößÔ∏è', 'üè¥‚Äç‚ò†Ô∏è', 'üè¥‚Äç‚ò†Ô∏è', 'üá¶üá®', 'üá¶üá©', 'üá¶üá™', 'üá¶üá´', 'üá¶üá¨', 'üá¶üáÆ', 'üá¶üá±', 'üá¶üá≤', 'üá¶üá¥', 'üá¶üá∂', 'üá¶üá∑', 'üá¶üá∏', 'üá¶üáπ', 'üá¶üá∫', 'üá¶üáº', 'üá¶üáΩ', 'üá¶üáø', 'üáßüá¶', 'üáßüáß', 'üáßüá©', 'üáßüá™', 'üáßüá´', 'üáßüá¨', 'üáßüá≠', 'üáßüáÆ', 'üáßüáØ', 'üáßüá±', 'üáßüá≤', 'üáßüá≥', 'üáßüá¥', 'üáßüá∂', 'üáßüá∑', 'üáßüá∏', 'üáßüáπ', 'üáßüáª', 'üáßüáº', 'üáßüáæ', 'üáßüáø', 'üá®üá¶', 'üá®üá®', 'üá®üá©', 'üá®üá´', 'üá®üá¨', 'üá®üá≠', 'üá®üáÆ', 'üá®üá∞', 'üá®üá±', 'üá®üá≤', 'üá®üá≥', 'üá®üá¥', 'üá®üáµ', 'üá®üá∑', 'üá®üá∫', 'üá®üáª', 'üá®üáº', 'üá®üáΩ', 'üá®üáæ', 'üá®üáø', 'üá©üá™', 'üá©üá¨', 'üá©üáØ', 'üá©üá∞', 'üá©üá≤', 'üá©üá¥', 'üá©üáø', 'üá™üá¶', 'üá™üá®', 'üá™üá™', 'üá™üá¨', 'üá™üá≠', 'üá™üá∑', 'üá™üá∏', 'üá™üáπ', 'üá™üá∫', 'üá´üáÆ', 'üá´üáØ', 'üá´üá∞', 'üá´üá≤', 'üá´üá¥', 'üá´üá∑', 'üá¨üá¶', 'üá¨üáß', 'üá¨üá©', 'üá¨üá™', 'üá¨üá´', 'üá¨üá¨', 'üá¨üá≠', 'üá¨üáÆ', 'üá¨üá±', 'üá¨üá≤', 'üá¨üá≥', 'üá¨üáµ', 'üá¨üá∂', 'üá¨üá∑', 'üá¨üá∏', 'üá¨üáπ', 'üá¨üá∫', 'üá¨üáº', 'üá¨üáæ', 'üá≠üá∞', 'üá≠üá≤', 'üá≠üá≥', 'üá≠üá∑', 'üá≠üáπ', 'üá≠üá∫', 'üáÆüá®', 'üáÆüá©', 'üáÆüá™', 'üáÆüá±', 'üáÆüá≤', 'üáÆüá≥', 'üáÆüá¥', 'üáÆüá∂', 'üáÆüá∑', 'üáÆüá∏', 'üáÆüáπ', 'üáØüá™', 'üáØüá≤', 'üáØüá¥', 'üáØüáµ', 'üá∞üá™', 'üá∞üá¨', 'üá∞üá≠', 'üá∞üáÆ', 'üá∞üá≤', 'üá∞üá≥', 'üá∞üáµ', 'üá∞üá∑', 'üá∞üáº', 'üá∞üáæ', 'üá∞üáø', 'üá±üá¶', 'üá±üáß', 'üá±üá®', 'üá±üáÆ', 'üá±üá∞', 'üá±üá∑', 'üá±üá∏', 'üá±üáπ', 'üá±üá∫', 'üá±üáª', 'üá±üáæ', 'üá≤üá¶', 'üá≤üá®', 'üá≤üá©', 'üá≤üá™', 'üá≤üá´', 'üá≤üá¨', 'üá≤üá≠', 'üá≤üá∞', 'üá≤üá±', 'üá≤üá≤', 'üá≤üá≥', 'üá≤üá¥', 'üá≤üáµ', 'üá≤üá∂', 'üá≤üá∑', 'üá≤üá∏', 'üá≤üáπ', 'üá≤üá∫', 'üá≤üáª', 'üá≤üáº', 'üá≤üáΩ', 'üá≤üáæ', 'üá≤üáø', 'üá≥üá¶', 'üá≥üá®', 'üá≥üá™', 'üá≥üá´', 'üá≥üá¨', 'üá≥üáÆ', 'üá≥üá±', 'üá≥üá¥', 'üá≥üáµ', 'üá≥üá∑', 'üá≥üá∫', 'üá≥üáø', 'üá¥üá≤', 'üáµüá¶', 'üáµüá™', 'üáµüá´', 'üáµüá¨', 'üáµüá≠', 'üáµüá∞', 'üáµüá±', 'üáµüá≤', 'üáµüá≥', 'üáµüá∑', 'üáµüá∏', 'üáµüáπ', 'üáµüáº', 'üáµüáæ', 'üá∂üá¶', 'üá∑üá™', 'üá∑üá¥', 'üá∑üá∏', 'üá∑üá∫', 'üá∑üáº', 'üá∏üá¶', 'üá∏üáß', 'üá∏üá®', 'üá∏üá©', 'üá∏üá™', 'üá∏üá¨', 'üá∏üá≠', 'üá∏üáÆ', 'üá∏üáØ', 'üá∏üá∞', 'üá∏üá±', 'üá∏üá≤', 'üá∏üá≥', 'üá∏üá¥', 'üá∏üá∑', 'üá∏üá∏', 'üá∏üáπ', 'üá∏üáª', 'üá∏üáΩ', 'üá∏üáæ', 'üá∏üáø', 'üáπüá¶', 'üáπüá®', 'üáπüá©', 'üáπüá´', 'üáπüá¨', 'üáπüá≠', 'üáπüáØ', 'üáπüá∞', 'üáπüá±', 'üáπüá≤', 'üáπüá≥', 'üáπüá¥', 'üáπüá∑', 'üáπüáπ', 'üáπüáª', 'üáπüáº', 'üáπüáø', 'üá∫üá¶', 'üá∫üá¨', 'üá∫üá≤', 'üá∫üá≥', 'üá∫üá∏', 'üá∫üáæ', 'üá∫üáø', 'üáªüá¶', 'üáªüá®', 'üáªüá™', 'üáªüá¨', 'üáªüáÆ', 'üáªüá≥', 'üáªüá∫', 'üáºüá´', 'üáºüá∏', 'üáΩüá∞', 'üáæüá™', 'üáæüáπ', 'üáøüá¶', 'üáøüá≤', 'üáøüáº']
                    }
                };

                // ÊúÄËøë‰ΩøÁî®ÁöÑemoji
                this.recentEmojis = this.loadRecentEmojis();

                // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂàÜÁ±ª
                this.currentEmojiCategory = 'smileys';
            }

            // ÊòæÁ§∫emojiÈÄâÊã©Âô®
            showEmojiModal() {
                if (!this.emojiModal) return;

                // ÂàùÂßãÂåñemojiÊï∞ÊçÆÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÂàùÂßãÂåñÔºâ
                if (!this.emojiCategories) {
                    this.initEmojiData();
                }

                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                this.emojiModal.classList.add('show');

                // Âä†ËΩΩÂΩìÂâçÂàÜÁ±ªÁöÑemoji
                this.loadEmojiCategory(this.currentEmojiCategory);

                // Âä†ËΩΩÊúÄËøë‰ΩøÁî®ÁöÑemoji
                this.loadRecentEmojisGrid();

                // ËÅöÁÑ¶ÊêúÁ¥¢Ê°Ü
                if (this.emojiSearchInput) {
                    setTimeout(() => {
                        this.emojiSearchInput.focus();
                    }, 100);
                }
            }

            // ÈöêËóèemojiÈÄâÊã©Âô®
            hideEmojiModal() {
                if (this.emojiModal) {
                    this.emojiModal.classList.remove('show');
                }
            }

            // ÂàáÊç¢emojiÂàÜÁ±ª
            switchEmojiCategory(category) {
                this.currentEmojiCategory = category;

                // Êõ¥Êñ∞ÂàÜÁ±ªÊåâÈíÆÁä∂ÊÄÅ
                document.querySelectorAll('.emoji-category').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-category="${category}"]`).classList.add('active');

                // Âä†ËΩΩËØ•ÂàÜÁ±ªÁöÑemoji
                this.loadEmojiCategory(category);
            }

            // Âä†ËΩΩÊåáÂÆöÂàÜÁ±ªÁöÑemoji
            loadEmojiCategory(category) {
                if (!this.emojiGrid || !this.emojiCategories) return;

                const categoryData = this.emojiCategories[category];
                if (!categoryData) return;

                // Ê∏ÖÁ©∫ÂΩìÂâçÁΩëÊ†º
                this.emojiGrid.innerHTML = '';

                // Ê∑ªÂä†emojiÂà∞ÁΩëÊ†º
                categoryData.emojis.forEach(emoji => {
                    const emojiItem = document.createElement('div');
                    emojiItem.className = 'emoji-item';
                    emojiItem.textContent = emoji;
                    emojiItem.addEventListener('click', () => this.insertEmoji(emoji));
                    this.emojiGrid.appendChild(emojiItem);
                });
            }

            // ÊêúÁ¥¢emoji
            searchEmojis(query) {
                if (!this.emojiGrid || !this.emojiCategories) return;

                if (!query.trim()) {
                    // Â¶ÇÊûúÊêúÁ¥¢Ê°Ü‰∏∫Á©∫ÔºåÂä†ËΩΩÂΩìÂâçÂàÜÁ±ª
                    this.loadEmojiCategory(this.currentEmojiCategory);
                    return;
                }

                const searchTerm = query.toLowerCase();
                const results = [];

                // Âú®ÊâÄÊúâÂàÜÁ±ª‰∏≠ÊêúÁ¥¢
                Object.values(this.emojiCategories).forEach(category => {
                    category.emojis.forEach(emoji => {
                        // ËøôÈáåÂèØ‰ª•Ê†πÊçÆemojiÁöÑÂÖ≥ÈîÆËØçËøõË°åÊêúÁ¥¢
                        // ‰∏∫‰∫ÜÁÆÄÂçïÔºåÊàë‰ª¨Âè™ËøõË°åÂü∫Êú¨ÁöÑÊñáÊú¨ÂåπÈÖç
                        if (emoji.includes(searchTerm) ||
                            this.getEmojiKeywords(emoji).some(keyword =>
                                keyword.toLowerCase().includes(searchTerm))) {
                            results.push(emoji);
                        }
                    });
                });

                // ÂéªÈáçÂπ∂ÊòæÁ§∫ÁªìÊûú
                const uniqueResults = [...new Set(results)];
                this.displaySearchResults(uniqueResults);
            }

            // Ëé∑ÂèñemojiÁöÑÂÖ≥ÈîÆËØçÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
            getEmojiKeywords(emoji) {
                // ËøôÈáåÊòØ‰∏Ä‰∏™ÁÆÄÂåñÁöÑÂÖ≥ÈîÆËØçÊò†Â∞ÑÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠ÂèØ‰ª•Êõ¥ËØ¶ÁªÜ
                const keywordMap = {
                    'üòÄ': ['Á¨ëËÑ∏', 'ÂºÄÂøÉ', 'È´òÂÖ¥', 'happy', 'smile'],
                    'üòÅ': ['Â§ßÁ¨ë', 'ÂºÄÂøÉ', 'happy', 'laugh'],
                    'üòÇ': ['Á¨ëÂì≠', 'ÊêûÁ¨ë', 'Â§ßÁ¨ë', 'laugh', 'cry'],
                    'ü§£': ['ÊâìÊªöÁ¨ë', 'Á¨ëÊ≠ª', 'laugh', 'rolling'],
                    'üòÉ': ['ÂºÄÂøÉ', 'Á¨ëËÑ∏', 'happy', 'smile'],
                    'üòÑ': ['ÂºÄÂøÉ', 'Âø´‰πê', 'happy', 'joy'],
                    'üòÖ': ['Â∞¥Â∞¨', 'ÂÜ∑Á¨ë', 'awkward', 'nervous'],
                    'üòÜ': ['Â§ßÁ¨ë', 'ÂºÄÂøÉ', 'laugh', 'happy'],
                    'üòâ': ['Áú®Áúº', 'Ë∞ÉÊÉÖ', 'wink', 'flirt'],
                    'üòä': ['ÂæÆÁ¨ë', 'ÂºÄÂøÉ', 'smile', 'happy'],
                    'üòã': ['ÁæéÂë≥', 'Â•ΩÂêÉ', 'yummy', 'tasty'],
                    'üòé': ['ÈÖ∑', 'Â§™Èò≥Èïú', 'cool', 'sunglasses'],
                    'üòç': ['Áà±ÂøÉÁúº', 'ÂñúÊ¨¢', 'love', 'heart'],
                    'üòò': ['‰∫≤Âêª', 'È£ûÂêª', 'kiss', 'love'],
                    'ü•∞': ['ÂèØÁà±', 'ÂñúÊ¨¢', 'love', 'cute'],
                    'üòó': ['‰∫≤Âêª', 'kiss'],
                    'üòô': ['‰∫≤Âêª', 'kiss'],
                    'üòö': ['‰∫≤Âêª', 'kiss'],
                    'üôÇ': ['ÂæÆÁ¨ë', 'smile'],
                    'ü§ó': ['Êã•Êä±', 'hug'],
                    'ü§©': ['ÊòüÊòüÁúº', 'Â¥áÊãú', 'wow', 'amazing'],
                    'ü§î': ['ÊÄùËÄÉ', 'ÊÉ≥ÊÉ≥', 'thinking', 'hmm'],
                    'ü§®': ['ÊÄÄÁñë', 'Ë¥®Áñë', 'skeptical', 'doubt'],
                    'üòê': ['Èù¢Êó†Ë°®ÊÉÖ', 'Êó†ËØ≠', 'neutral', 'blank'],
                    'üòë': ['Êó†ËØ≠', 'Êó†Â•à', 'expressionless'],
                    'üò∂': ['Ê≤âÈªò', '‰∏çËØ¥ËØù', 'silent', 'quiet'],
                    'üôÑ': ['ÁøªÁôΩÁúº', 'Êó†ËØ≠', 'eyeroll'],
                    'üòè': ['ÂæóÊÑè', 'ÂùèÁ¨ë', 'smirk'],
                    'üò£': ['ÁóõËã¶', 'ÈöæÂèó', 'pain'],
                    'üò•': ['Â§±Êúõ', 'ÈöæËøá', 'disappointed', 'sad'],
                    'üòÆ': ['ÊÉäËÆ∂', 'Âìá', 'surprised', 'wow'],
                    'ü§ê': ['Èó≠Âò¥', 'ÂÆâÈùô', 'quiet', 'silent'],
                    'üòØ': ['ÊÉäËÆ∂', 'ÊÑèÂ§ñ', 'surprised'],
                    'üò™': ['Âõ∞', 'ÊÉ≥Áù°', 'sleepy', 'tired'],
                    'üò´': ['Áñ≤ÊÉ´', 'Á¥Ø', 'tired', 'exhausted'],
                    'üò¥': ['Áù°Ëßâ', 'Âõ∞', 'sleeping', 'sleepy'],
                    'üòå': ['ÊîæÊùæ', 'ËΩªÊùæ', 'relaxed', 'relief'],
                    'üòõ': ['ÂêêËàåÂ§¥', 'Ë∞ÉÁöÆ', 'cheeky'],
                    'üòú': ['Ë∞ÉÁöÆ', 'Áú®Áúº', 'cheeky', 'wink'],
                    'üòù': ['ÂêêËàåÂ§¥', 'ÊêûÊÄ™', 'silly'],
                    'ü§§': ['ÊµÅÂè£Ê∞¥', 'ÁæéÂë≥', 'drool'],
                    'üòí': ['ÈÑôËßÜ', '‰∏çÂ±ë', 'annoyed'],
                    'üòì': ['Ê≤Æ‰∏ß', 'Â§±Êúõ', 'sad', 'disappointed'],
                    'üòî': ['Â§±ËêΩ', 'ÈöæËøá', 'sad', 'depressed'],
                    'üòï': ['Âõ∞ÊÉë', '‰∏çÊòéÁôΩ', 'confused'],
                    'üôÉ': ['ÂÄíÁ´ã', 'ÊêûÁ¨ë', 'upside-down'],
                    'ü§ë': ['ÊúâÈí±', 'ÂèëË¥¢', 'money', 'rich'],
                    'üò≤': ['ÈúáÊÉä', 'ÊÉäËÆ∂', 'shocked', 'surprised'],
                    '‚òπÔ∏è': ['‰∏çÂºÄÂøÉ', 'ÈöæËøá', 'sad', 'unhappy'],
                    'üôÅ': ['‰∏çÂºÄÂøÉ', 'ÈöæËøá', 'sad'],
                    'üòñ': ['Á∫†Áªì', 'ÈöæÂèó', 'conflicted'],
                    'üòû': ['Â§±Êúõ', 'ÈöæËøá', 'disappointed', 'sad'],
                    'üòü': ['ÊãÖÂøÉ', 'ÂøßËôë', 'worried', 'concerned'],
                    'üò§': ['ÁîüÊ∞î', 'ÊÑ§ÊÄí', 'angry', 'mad'],
                    'üò¢': ['Âì≠', '‰º§ÂøÉ', 'crying', 'sad'],
                    'üò≠': ['Â§ßÂì≠', '‰º§ÂøÉ', 'crying', 'very sad'],
                    'üò¶': ['ÂÆ≥ÊÄï', 'Á¥ßÂº†', 'scared', 'nervous'],
                    'üòß': ['ÊÅêÊÉß', 'ÊÉäÊÅê', 'fear', 'scared'],
                    'üò®': ['ÂÆ≥ÊÄï', 'ÊÅêÊÉß', 'scared', 'afraid'],
                    'üò©': ['Áñ≤ÊÉ´', 'ÂéåÂÄ¶', 'exhausted', 'tired'],
                    'ü§Ø': ['ÈúáÊÉä', 'Â§¥ÁàÜ', 'mind-blowing'],
                    'üò¨': ['Â∞¥Â∞¨', 'Á¥ßÂº†', 'awkward', 'nervous'],
                    'üò∞': ['Á¥ßÂº†', 'Âá∫Ê±ó', 'nervous', 'sweating'],
                    'üò±': ['ÊÉäÊÅê', 'ÂÆ≥ÊÄï', 'horrified', 'scared'],
                    'ü•µ': ['ÁÉ≠', 'ÂèëÁÉß', 'hot', 'fever'],
                    'ü•∂': ['ÂÜ∑', 'ÂÜ∞ÂÜª', 'cold', 'freezing'],
                    'üò≥': ['ËÑ∏Á∫¢', 'ÂÆ≥Áæû', 'embarrassed', 'shy'],
                    'ü•∫': ['ÂèØÊÄú', 'ÊííÂ®á', 'pleading', 'puppy eyes'],
                    'üòµ': ['Â§¥Êôï', 'Âõ∞ÊÉë', 'dizzy', 'confused'],
                    'üò°': ['ÊÑ§ÊÄí', 'ÁîüÊ∞î', 'angry', 'mad'],
                    'üò†': ['ÁîüÊ∞î', 'ÊÑ§ÊÄí', 'angry'],
                    'ü§¨': ['ÊÑ§ÊÄí', 'ÂííÈ™Ç', 'angry', 'swearing'],
                    'üò∑': ['ÁîüÁóÖ', 'Âè£ÁΩ©', 'sick', 'mask'],
                    'ü§í': ['ÂèëÁÉß', 'ÁîüÁóÖ', 'fever', 'sick'],
                    'ü§ï': ['Âèó‰º§', 'ÂåÖÊâé', 'injured', 'hurt'],
                    'ü§¢': ['ÊÅ∂ÂøÉ', 'ÊÉ≥Âêê', 'nausea', 'sick'],
                    'ü§Æ': ['ÂëïÂêê', 'ÊÅ∂ÂøÉ', 'vomiting', 'sick'],
                    'ü§ß': ['ÊâìÂñ∑Âöè', 'ÊÑüÂÜí', 'sneezing', 'cold'],
                    'ü•±': ['ÊâìÂìàÊ¨†', 'Âõ∞', 'yawning', 'sleepy'],
                    'ü•¥': ['Â§¥Êôï', 'ÈÜâ', 'dizzy', 'drunk'],
                    'üòé': ['ÈÖ∑', 'Â§™Èò≥Èïú', 'cool', 'sunglasses'],
                    'ü§ì': ['‰π¶ÂëÜÂ≠ê', 'ÁúºÈïú', 'nerd', 'glasses'],
                    'üßê': ['Á†îÁ©∂', '‰æ¶Êé¢', 'investigating', 'detective'],
                    '‚ù§Ô∏è': ['Áà±ÂøÉ', 'ÂñúÊ¨¢', 'love', 'heart'],
                    'üß°': ['Ê©ôËâ≤ÂøÉ', 'love', 'heart'],
                    'üíõ': ['ÈªÑÂøÉ', 'love', 'heart'],
                    'üíö': ['ÁªøÂøÉ', 'love', 'heart'],
                    'üíô': ['ËìùÂøÉ', 'love', 'heart'],
                    'üíú': ['Á¥´ÂøÉ', 'love', 'heart'],
                    'üñ§': ['ÈªëÂøÉ', 'love', 'heart'],
                    'ü§ç': ['ÁôΩÂøÉ', 'love', 'heart'],
                    'ü§é': ['Ê£ïÂøÉ', 'love', 'heart'],
                    'üíî': ['ÂøÉÁ¢é', 'ÂàÜÊâã', 'broken heart', 'sad'],
                    '‚ù£Ô∏è': ['ÊÑüÂèπÂøÉ', 'love', 'heart'],
                    'üíï': ['ÂèåÂøÉ', 'love', 'hearts'],
                    'üíû': ['ÊóãËΩ¨ÂøÉ', 'love', 'hearts'],
                    'üíì': ['ÂøÉË∑≥', 'love', 'heartbeat'],
                    'üíó': ['Â¢ûÈïøÂøÉ', 'love', 'heart'],
                    'üíñ': ['Èó™‰∫ÆÂøÉ', 'love', 'heart'],
                    'üíò': ['‰∏òÊØîÁâπÂøÉ', 'love', 'heart'],
                    'üíù': ['‰∏ùÂ∏¶ÂøÉ', 'love', 'heart'],
                    'üëç': ['Ëµû', 'Â•Ω', 'thumbs up', 'like'],
                    'üëé': ['Ë∏©', '‰∏çÂ•Ω', 'thumbs down', 'dislike'],
                    'üëå': ['OK', 'Â•ΩÁöÑ', 'OK', 'good'],
                    '‚úåÔ∏è': ['ËÉúÂà©', 'ÂíåÂπ≥', 'victory', 'peace'],
                    'ü§û': ['ÊâãÊåá‰∫§Âèâ', 'Á•àÁ•∑', 'fingers crossed', 'hope'],
                    'ü§ü': ['ÊàëÁà±‰Ω†ÊâãÂäø', 'love you', 'I love you'],
                    'ü§ò': ['ÊëáÊªöÊâãÂäø', 'rock', 'rock on'],
                    'ü§ô': ['ÊâìÁîµËØùÊâãÂäø', 'call me'],
                    'üëà': ['Â∑¶Êåá', 'ÊåáÂêëÂ∑¶', 'left finger'],
                    'üëâ': ['Âè≥Êåá', 'ÊåáÂêëÂè≥', 'right finger'],
                    'üëÜ': ['‰∏äÊåá', 'ÊåáÂêë‰∏ä', 'up finger'],
                    'üëá': ['‰∏ãÊåá', 'ÊåáÂêë‰∏ã', 'down finger'],
                    '‚òùÔ∏è': ['È£üÊåá', '‰∏Ä', 'one finger', 'point up'],
                    '‚úã': ['‰∏æÊâã', 'Êâã', 'hand', 'stop'],
                    'ü§ö': ['ÊâãËÉå', 'back of hand'],
                    'üñê': ['Âº†ÂºÄÊâã', 'open hand'],
                    'üññ': ['Áì¶ËÇØ‰∏æÊâãÁ§º', 'Vulcan salute'],
                    'üëã': ['Êå•Êâã', 'ÂÜçËßÅ', 'wave', 'goodbye'],
                    'ü§è': ['Â∞èÊãáÊåá', 'Â∞è', 'small finger'],
                    '‚úçÔ∏è': ['ÂÜô', 'ÂÜôÂ≠ó', 'writing'],
                    'üëè': ['ÈºìÊéå', 'ÈºìÊéå', 'clap', 'applause'],
                    'üôå': ['‰∏æÊâã', 'Â∫ÜÁ•ù', 'hands up', 'celebrate'],
                    'üëê': ['Âº†ÂºÄÂèåÊâã', 'open hands'],
                    'ü§≤': ['ÊâãÊéåÂêë‰∏ä', 'palms up'],
                    'ü§ù': ['Êè°Êâã', 'Âêà‰Ωú', 'handshake', 'agreement'],
                    'üôè': ['Á•àÁ•∑', 'ÊÑüË∞¢', 'prayer', 'thanks']
                };
                return keywordMap[emoji] || [];
            }

            // ÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûú
            displaySearchResults(emojis) {
                if (!this.emojiGrid) return;

                // Ê∏ÖÁ©∫ÁΩëÊ†º
                this.emojiGrid.innerHTML = '';

                // ÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûú
                emojis.forEach(emoji => {
                    const emojiItem = document.createElement('div');
                    emojiItem.className = 'emoji-item';
                    emojiItem.textContent = emoji;
                    emojiItem.addEventListener('click', () => this.insertEmoji(emoji));
                    this.emojiGrid.appendChild(emojiItem);
                });
            }

            // Âä†ËΩΩÊúÄËøë‰ΩøÁî®ÁöÑemojiÁΩëÊ†º
            loadRecentEmojisGrid() {
                if (!this.emojiRecentGrid || !this.recentEmojis) return;

                // Ê∏ÖÁ©∫ÁΩëÊ†º
                this.emojiRecentGrid.innerHTML = '';

                // ÊòæÁ§∫ÊúÄËøë‰ΩøÁî®ÁöÑemoji
                this.recentEmojis.forEach(emoji => {
                    const emojiItem = document.createElement('div');
                    emojiItem.className = 'emoji-item';
                    emojiItem.textContent = emoji;
                    emojiItem.addEventListener('click', () => this.insertEmoji(emoji));
                    this.emojiRecentGrid.appendChild(emojiItem);
                });
            }

            // ÊèíÂÖ•emojiÂà∞ÁºñËæëÂô®
            insertEmoji(emoji) {
                if (!this.editor) return;

                const start = this.editor.selectionStart;
                const end = this.editor.selectionEnd;
                const selectedText = this.editor.value.substring(start, end);

                // ÊõøÊç¢ÈÄâ‰∏≠ÊñáÊú¨ÊàñÂú®ÂÖâÊ†á‰ΩçÁΩÆÊèíÂÖ•emoji
                const newText = this.editor.value.substring(0, start) + emoji + this.editor.value.substring(end);
                this.editor.value = newText;

                // ËÆæÁΩÆÂÖâÊ†á‰ΩçÁΩÆ
                const newCursorPos = start + emoji.length;
                this.editor.focus();
                this.editor.setSelectionRange(newCursorPos, newCursorPos);

                // Ê∑ªÂä†Âà∞ÊúÄËøë‰ΩøÁî®ÁöÑemoji
                this.addToRecentEmojis(emoji);

                // Êõ¥Êñ∞ÁªüËÆ°ÂíåÂéÜÂè≤
                this.updateStats();
                this.saveHistory();

                // ÂÖ≥Èó≠emojiÈÄâÊã©Âô®
                this.hideEmojiModal();
            }

            // Ê∑ªÂä†emojiÂà∞ÊúÄËøë‰ΩøÁî®ÂàóË°®
            addToRecentEmojis(emoji) {
                // ÂàùÂßãÂåñÊúÄËøë‰ΩøÁî®ÂàóË°®ÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÔºâ
                if (!this.recentEmojis) {
                    this.recentEmojis = [];
                }

                // ÁßªÈô§Â∑≤Â≠òÂú®ÁöÑemojiÔºàÈÅøÂÖçÈáçÂ§çÔºâ
                this.recentEmojis = this.recentEmojis.filter(e => e !== emoji);

                // Ê∑ªÂä†Âà∞ÂºÄÂ§¥
                this.recentEmojis.unshift(emoji);

                // ‰øùÊåÅÊúÄÂ§ö50‰∏™
                if (this.recentEmojis.length > 50) {
                    this.recentEmojis = this.recentEmojis.slice(0, 50);
                }

                // ‰øùÂ≠òÂà∞localStorage
                this.saveRecentEmojis();
            }

            // ‰øùÂ≠òÊúÄËøë‰ΩøÁî®ÁöÑemoji
            saveRecentEmojis() {
                try {
                    localStorage.setItem('notepad-recent-emojis', JSON.stringify(this.recentEmojis));
                } catch (e) {
                    console.warn('Êó†Ê≥ï‰øùÂ≠òÊúÄËøë‰ΩøÁî®ÁöÑemoji:', e);
                }
            }

            // Âä†ËΩΩÊúÄËøë‰ΩøÁî®ÁöÑemoji
            loadRecentEmojis() {
                try {
                    const saved = localStorage.getItem('notepad-recent-emojis');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.warn('Êó†Ê≥ïÂä†ËΩΩÊúÄËøë‰ΩøÁî®ÁöÑemoji:', e);
                    return [];
                }
            }

            // Ê∑ªÂä†Ê∏ÖÁêÜÊñπÊ≥ï
            destroy() {
                if (this.timeUpdateInterval) {
                    clearInterval(this.timeUpdateInterval);
                    this.timeUpdateInterval = null;
                }
                if (this.resizeTimeout) {
                    clearTimeout(this.resizeTimeout);
                }
                        }

            // Ë∞ÉÊï¥ÁºñËæëÂô®Â∫ïÈÉ®ÂÜÖËæπË∑ù
            adjustEditorPadding() {
                // Ëé∑ÂèñÂ∫ïÈÉ®ËæπË∑ùÂÄºÔºà‰ºòÂÖà‰ΩøÁî®ÊªëÂùóÂÄºÔºåÂê¶Âàô‰ΩøÁî®ÈªòËÆ§ÂÄº175Ôºâ
                let bottomMargin = 175;
                if (this.bottomMarginSlider) {
                    bottomMargin = parseInt(this.bottomMarginSlider.value) || 175;
                }

                // ËÆæÁΩÆÁºñËæëÂô®ÂÆπÂô®ÁöÑÂ∫ïÈÉ®ËæπË∑ù
                const editorContainer = document.querySelector('.editor-container');
                if (editorContainer) {
                    editorContainer.style.marginBottom = `${bottomMargin}px`;
                }

                // Â¶ÇÊûúÊúâÁºñËæëÂô®Áà∂ÂÖÉÁ¥†ÔºåËÆæÁΩÆÂÖ∂Â∫ïÈÉ®ÂÜÖËæπË∑ù‰∏∫0
                if (this.editor && this.editor.parentElement) {
                    this.editor.parentElement.style.paddingBottom = '0px';
                }
            }

            // Ë°®Ê†ºÂØπËØùÊ°ÜÁõ∏ÂÖ≥ÊñπÊ≥ï
            showTableModal() {
                const modal = document.getElementById('tableModal');
                if (!modal) return;

                // ËÆæÁΩÆÈªòËÆ§ÂÄº
                const rowsInput = document.getElementById('tableRows');
                const colsInput = document.getElementById('tableCols');
                const headerCheckbox = document.getElementById('tableHeader');

                if (rowsInput) rowsInput.value = 3;
                if (colsInput) colsInput.value = 3;
                if (headerCheckbox) headerCheckbox.checked = true;

                // Êõ¥Êñ∞È¢ÑËßà
                this.updateTablePreview();

                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                modal.classList.add('active');

                // ËÅöÁÑ¶Âà∞Ë°åÊï∞ËæìÂÖ•Ê°Ü
                setTimeout(() => {
                    if (rowsInput) rowsInput.focus();
                }, 100);
            }

            hideTableModal() {
                const modal = document.getElementById('tableModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            generateTableMarkdown(rows, cols, includeHeader) {
                if (rows < 1 || cols < 1) return '';

                let table = '';

                // ÁîüÊàêË°®Â§¥ÔºàÂ¶ÇÊûúÂåÖÂê´Ê†áÈ¢òË°åÔºâ
                if (includeHeader && rows >= 1) {
                    let headerRow = '|';
                    let separatorRow = '|';

                    for (let j = 0; j < cols; j++) {
                        headerRow += ` Ê†áÈ¢ò${j + 1} |`;
                        separatorRow += '---|';
                    }

                    table += headerRow + '\n' + separatorRow + '\n';

                    // ÁîüÊàêÊï∞ÊçÆË°åÔºàÂâ©‰ΩôË°åÊï∞Ôºâ
                    for (let i = 1; i < rows; i++) {
                        let dataRow = '|';
                        for (let j = 0; j < cols; j++) {
                            dataRow += ` Êï∞ÊçÆ${i}-${j + 1} |`;
                        }
                        table += dataRow + '\n';
                    }
                } else {
                    // ‰∏çÂåÖÂê´Ê†áÈ¢òË°åÔºåÂÖ®ÈÉ®‰∏∫Êï∞ÊçÆË°å
                    for (let i = 0; i < rows; i++) {
                        let dataRow = '|';
                        for (let j = 0; j < cols; j++) {
                            dataRow += ` Êï∞ÊçÆ${i + 1}-${j + 1} |`;
                        }
                        table += dataRow + '\n';
                    }
                }

                return table;
            }

            updateTablePreview() {
                const rowsInput = document.getElementById('tableRows');
                const colsInput = document.getElementById('tableCols');
                const headerCheckbox = document.getElementById('tableHeader');
                const preview = document.getElementById('tablePreview');

                if (!rowsInput || !colsInput || !headerCheckbox || !preview) return;

                const rows = parseInt(rowsInput.value) || 3;
                const cols = parseInt(colsInput.value) || 3;
                const includeHeader = headerCheckbox.checked;

                // ÈôêÂà∂Ë°åÂàóÊï∞
                if (rows > 20) rowsInput.value = 20;
                if (cols > 10) colsInput.value = 10;
                if (rows < 1) rowsInput.value = 1;
                if (cols < 1) colsInput.value = 1;

                const tableMarkdown = this.generateTableMarkdown(rows, cols, includeHeader);

                // ÈôêÂà∂È¢ÑËßàÊòæÁ§∫ÁöÑË°åÊï∞
                const lines = tableMarkdown.split('\n');
                const maxPreviewLines = 10;
                let previewText = lines.slice(0, maxPreviewLines).join('\n');

                if (lines.length > maxPreviewLines) {
                    previewText += '\n... (Êõ¥Â§öË°å)';
                }

                preview.textContent = previewText;
            }

            insertTableFromModal() {
                const rowsInput = document.getElementById('tableRows');
                const colsInput = document.getElementById('tableCols');
                const headerCheckbox = document.getElementById('tableHeader');

                if (!rowsInput || !colsInput || !headerCheckbox) return;

                const rows = parseInt(rowsInput.value) || 3;
                const cols = parseInt(colsInput.value) || 3;
                const includeHeader = headerCheckbox.checked;

                const tableMarkdown = this.generateTableMarkdown(rows, cols, includeHeader);

                // Ëé∑ÂèñÂÖâÊ†á‰ΩçÁΩÆÂπ∂ÊèíÂÖ•Ë°®Ê†º
                const start = this.editor.selectionStart;
                const end = this.editor.selectionEnd;

                this.editor.value = this.editor.value.substring(0, start) +
                                  tableMarkdown +
                                  this.editor.value.substring(end);

                // ËÆæÁΩÆÂÖâÊ†á‰ΩçÁΩÆÂà∞Ë°®Ê†ºÂêé
                const newCursorPos = start + tableMarkdown.length;
                this.editor.focus();
                this.editor.setSelectionRange(newCursorPos, newCursorPos);

                // Êõ¥Êñ∞ÁªüËÆ°ÂíåÂéÜÂè≤
                this.updateStats();
                this.saveHistory();

                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                this.hideTableModal();
            }

            // Â∏ÆÂä©Ê®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥ÊñπÊ≥ï
            showHelpModal() {
                const modal = document.getElementById('helpModal');
                if (modal) {
                    modal.classList.add('active');
                }
            }

            hideHelpModal() {
                const modal = document.getElementById('helpModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // Áä∂ÊÄÅÊ†èÈ°πÁõÆÈöêËóèÂäüËÉΩÔºà‰ªÖÊîØÊåÅÈöêËóèÔºâ
            hideStatusItem(element) {
                if (!element) return;

                // ‰ΩøÁî® getComputedStyle Ëé∑ÂèñÂáÜÁ°ÆÁöÑÊòæÁ§∫Áä∂ÊÄÅ
                const computedStyle = window.getComputedStyle(element);
                const isVisible = computedStyle.display !== 'none';

                if (isVisible) {
                    // ÈöêËóèÂÖÉÁ¥†
                    element.style.display = 'none';
                    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                    const itemId = element.id;
                    if (itemId) {
                        localStorage.setItem(`status_${itemId}_visible`, 'false');
                    }

                    // ÂêåÊ≠•Êõ¥Êñ∞ÂÅèÂ•ΩËÆæÁΩÆ‰∏≠ÁöÑÂØπÂ∫îÂ§çÈÄâÊ°Ü
                    this.syncPreferenceWithStatusItem(itemId, false);

                    // Êèê‰æõËßÜËßâÂèçÈ¶à
                    this.showTemporaryMessage(element, 'Â∑≤ÈöêËóè');
                }
            }

            // ÊòæÁ§∫‰∏¥Êó∂Ê∂àÊÅØ
            showTemporaryMessage(element, message) {
                if (!element) return;

                const originalText = element.textContent;
                const originalTitle = element.title;

                // ‰∏¥Êó∂ÊòæÁ§∫Ê∂àÊÅØ
                element.textContent = message;
                element.style.backgroundColor = 'var(--accent-color)';
                element.style.color = 'white';
                element.style.fontWeight = 'bold';

                // 500msÂêéÊÅ¢Â§ç
                setTimeout(() => {
                    element.textContent = originalText;
                    element.style.backgroundColor = '';
                    element.style.color = '';
                    element.style.fontWeight = '';
                    element.title = originalTitle;
                }, 500);
            }

            // ÊÅ¢Â§çÁä∂ÊÄÅÊ†èÈ°πÁõÆÂèØËßÅÊÄßËÆæÁΩÆ
            restoreStatusBarVisibility() {
                const statusItems = [
                    'charCount', 'wordCount', 'lineCount', 'selectedCount',
                    'colCount', 'positionPercent', 'dateTimeDisplay'
                ];

                statusItems.forEach(itemId => {
                    const element = document.getElementById(itemId);
                    if (element) {
                        const savedState = localStorage.getItem(`status_${itemId}_visible`);
                        if (savedState === 'false') {
                            element.style.display = 'none';
                        } else {
                            element.style.display = 'inline-block';
                        }
                        
                        // Âú®ÊÅ¢Â§çÂèØËßÅÊÄßÂêéÂêåÊ≠•Êõ¥Êñ∞ÂÅèÂ•ΩËÆæÁΩÆ‰∏≠ÁöÑÂØπÂ∫îÂ§çÈÄâÊ°Ü
                        // ‰ΩøÁî® setTimeout Á°Æ‰øù DOM Â∑≤ÁªèÊõ¥Êñ∞
                        setTimeout(() => {
                            const isVisible = element.style.display !== 'none';
                            this.syncPreferenceWithStatusItem(itemId, isVisible);
                        }, 0);
                    }
                });
            }

            // ÂêåÊ≠•Áä∂ÊÄÅÊ†èÈ°πÁõÆ‰∏éÂÅèÂ•ΩËÆæÁΩÆ
            syncPreferenceWithStatusItem(itemId, isVisible) {
                // Ê†πÊçÆitemIdÊò†Â∞ÑÂà∞ÂØπÂ∫îÁöÑÂÅèÂ•ΩËÆæÁΩÆÈ°π
                const preferenceMap = {
                    'charCount': 'showCharCount',
                    'wordCount': 'showWordCount',
                    'lineCount': 'showLineCount',
                    'selectedCount': 'showSelectedCount',
                    'colCount': 'showColCount',
                    'positionPercent': 'showPositionPercent',
                    'dateTimeDisplay': 'showDateTime'
                };

                const preferenceKey = preferenceMap[itemId];
                if (preferenceKey && this[preferenceKey]) {
                    // Êõ¥Êñ∞ÂÅèÂ•ΩËÆæÁΩÆÂ§çÈÄâÊ°ÜÁöÑÁä∂ÊÄÅ
                    this[preferenceKey].checked = isVisible;
                    
                    // Âè™‰øùÂ≠òÂÅèÂ•ΩËÆæÁΩÆÔºå‰∏çÁ´ãÂç≥Â∫îÁî®ÔºåÈÅøÂÖçÂæ™ÁéØË∞ÉÁî®
                    const preferences = {
                        showWordCount: this.showWordCount.checked,
                        showCharCount: this.showCharCount.checked,
                        showLineCount: this.showLineCount.checked,
                        showColCount: this.showColCount.checked,
                        showSelectedCount: this.showSelectedCount.checked,
                        showPositionPercent: this.showPositionPercent.checked,
                        showDateTime: this.showDateTime.checked,
                        markdownMode: this.markdownMode.checked,
                        autoWordWrap: this.autoWordWrap.checked,
                        enableFullscreen: this.enableFullscreen.checked,
                        showGrid: this.showGrid.checked,
                        bottomMargin: this.bottomMarginSlider ? this.bottomMarginSlider.value : 175
                    };
                    
                    // Á´ãÂç≥‰øùÂ≠òÂà∞localStorage
                    localStorage.setItem('notepad-preferences', JSON.stringify(preferences));
                }
            }

            // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®ÁöÑÁä∂ÊÄÅÊ†èÈ°πÁõÆÂèØËßÅÊÄßËÆæÁΩÆ
            updateStatusBarVisibilityInStorage(preferences) {
                const statusItems = [
                    { id: 'charCount', visible: preferences.showCharCount !== false },
                    { id: 'wordCount', visible: preferences.showWordCount !== false },
                    { id: 'lineCount', visible: preferences.showLineCount !== false },
                    { id: 'selectedCount', visible: preferences.showSelectedCount !== false },
                    { id: 'colCount', visible: preferences.showColCount !== false },
                    { id: 'positionPercent', visible: preferences.showPositionPercent !== false },
                    { id: 'dateTimeDisplay', visible: preferences.showDateTime !== false }
                ];

                statusItems.forEach(item => {
                    localStorage.setItem(`status_${item.id}_visible`, item.visible);
                });
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            window.notepadApp = new Notepad();
        });
    </script>
</body>
</html>
